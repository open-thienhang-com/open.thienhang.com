"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[9711],{9711:($,C,s)=>{s.r(C),s.d(C,{OccupancyComponent:()=>L});var y=s(2881),O=s(9417),I=s(5207),P=s(1141),M=s(491),D=s(8150),v=s(8559),f=s(6221),b=s(6150),k=s(7722),E=s(5716),F=s(935),h=s(5779),w=s(5545),t=s(1360);const T=()=>[10,25,50];function A(r,u){if(1&r&&(t.j41(0,"p-card",14)(1,"div",15),t.nrm(2,"p-chart",16),t.k0s()()),2&r){const e=t.XpG();t.R7$(2),t.Y8G("data",e.occupancyChartData)("options",e.occupancyChartOptions)}}function j(r,u){1&r&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"Apartment"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Booked Days"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Total Days"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Occupancy Rate"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Revenue"),t.k0s()())}function B(r,u){if(1&r&&(t.j41(0,"tr")(1,"td")(2,"span",22),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"span",23),t.EFF(6),t.k0s()(),t.j41(7,"td")(8,"span",24),t.EFF(9),t.k0s()(),t.j41(10,"td")(11,"div",25)(12,"div",26),t.nrm(13,"div",27),t.k0s(),t.nrm(14,"p-badge",28),t.nI1(15,"number"),t.k0s()(),t.j41(16,"td")(17,"span",29),t.EFF(18),t.nI1(19,"currency"),t.k0s()()()),2&r){const e=u.$implicit,c=t.XpG(2);t.R7$(3),t.JRh(e.apartment_name),t.R7$(3),t.JRh(e.bookedDays),t.R7$(3),t.JRh(e.totalDays),t.R7$(4),t.xc7("width",e.occupancyRate,"%"),t.Y8G("ngClass","bg-"+c.getOccupancySeverity(e.occupancyRate)),t.R7$(),t.Y8G("value",t.i5U(15,9,e.occupancyRate,"1.1-1%"))("severity",c.getOccupancySeverity(e.occupancyRate)),t.R7$(4),t.JRh(t.bMT(19,12,e.revenue))}}function x(r,u){1&r&&(t.j41(0,"tr")(1,"td",30)(2,"div",31),t.nrm(3,"i",32),t.j41(4,"p"),t.EFF(5,"No occupancy data available"),t.k0s()()()())}function S(r,u){if(1&r&&(t.j41(0,"p-card",17)(1,"p-table",18),t.DNE(2,j,11,0,"ng-template",19)(3,B,20,14,"ng-template",20)(4,x,6,0,"ng-template",21),t.k0s()()),2&r){const e=t.XpG();t.R7$(),t.Y8G("value",e.apartmentOccupancyData)("paginator",!0)("rows",10)("rowsPerPageOptions",t.lJ4(5,T))("showCurrentPageReport",!0)}}function U(r,u){1&r&&(t.j41(0,"div",33),t.nrm(1,"p-skeleton",34),t.k0s())}let L=(()=>{class r{hotelService;messageService;bookings=[];apartments=[];loading=!1;selectedPeriod="month";periodOptions=[{label:"Last 7 Days",value:"week"},{label:"Last 30 Days",value:"month"},{label:"Last 3 Months",value:"quarter"},{label:"Last Year",value:"year"}];occupancyChartData;occupancyChartOptions;apartmentOccupancyData=[];overallOccupancyRate=0;totalBookedDays=0;totalAvailableDays=0;averageOccupancyRate=0;constructor(e,c){this.hotelService=e,this.messageService=c}ngOnInit(){this.loadData()}loadData(){this.loading=!0,Promise.all([this.hotelService.getBookings().toPromise(),this.hotelService.getApartments().toPromise()]).then(([e,c])=>{this.bookings=e?.data||[],this.apartments=c?.data||[],this.processOccupancyData(),this.loading=!1}).catch(()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load occupancy data"}),this.loading=!1})}processOccupancyData(){const e=this.getFilteredBookings();this.calculateOverallOccupancy(e),this.buildChartData(e),this.buildApartmentOccupancy(e)}getFilteredBookings(){const e=new Date;let c=new Date;switch(this.selectedPeriod){case"week":c.setDate(e.getDate()-7);break;case"month":c.setDate(e.getDate()-30);break;case"quarter":c.setMonth(e.getMonth()-3);break;case"year":c.setFullYear(e.getFullYear()-1)}return this.bookings.filter(n=>{const a=new Date(n.check_in),o=new Date(n.check_out);return a<=e&&o>=c&&"canceled"!==n.booking_status})}calculateOverallOccupancy(e){const c=this.getDaysInPeriod();this.totalAvailableDays=this.apartments.length*c;const a=new Map;e.forEach(o=>{const p=new Date(o.check_in),d=new Date(o.check_out),l=new Date(p);for(;l<=d;){const m=l.toISOString().split("T")[0];a.has(m)||a.set(m,new Set),a.get(m).add(o.apartment_id),l.setDate(l.getDate()+1)}}),this.totalBookedDays=Array.from(a.values()).reduce((o,p)=>o+p.size,0),this.overallOccupancyRate=this.totalAvailableDays>0?this.totalBookedDays/this.totalAvailableDays*100:0}getDaysInPeriod(){switch(this.selectedPeriod){case"week":return 7;case"month":default:return 30;case"quarter":return 90;case"year":return 365}}buildChartData(e){const c=this.getDaysInPeriod(),n=new Date,a=new Date;a.setDate(n.getDate()-c);const o=new Map,p=new Date(a);for(;p<=n;){const i=p.toISOString().split("T")[0];o.set(i,{booked:0,total:this.apartments.length}),p.setDate(p.getDate()+1)}e.forEach(i=>{const g=new Date(i.check_in),K=new Date(i.check_out),_=new Date(g);for(;_<=K&&_<=n;){const W=_.toISOString().split("T")[0],R=o.get(W);R&&R.booked++,_.setDate(_.getDate()+1)}});const d=Array.from(o.keys()).sort(),l=d.map(i=>{const g=o.get(i);return g.total>0?g.booked/g.total*100:0}),m=d.map(i=>o.get(i).booked);this.occupancyChartData={labels:d.map(i=>new Date(i).toLocaleDateString("en-US","year"===this.selectedPeriod?{month:"short",year:"numeric"}:{month:"short",day:"numeric"})),datasets:[{label:"Occupancy Rate (%)",data:l,fill:!0,backgroundColor:"rgba(34, 197, 94, 0.2)",borderColor:"rgb(34, 197, 94)",tension:.4,yAxisID:"y"},{label:"Booked Apartments",data:m,fill:!1,backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgb(59, 130, 246)",tension:.4,yAxisID:"y1"}]},this.occupancyChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Occupancy Rate Trend"}},scales:{y:{type:"linear",display:!0,position:"left",min:0,max:100,title:{display:!0,text:"Occupancy Rate (%)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Number of Booked Apartments"},grid:{drawOnChartArea:!1}}}}}buildApartmentOccupancy(e){const c=this.getDaysInPeriod(),n=new Map;e.forEach(a=>{const o=new Date(a.check_in),p=new Date(a.check_out),d=Math.ceil((p.getTime()-o.getTime())/864e5)+1,l=n.get(a.apartment_id)||{bookedDays:0,revenue:0};n.set(a.apartment_id,{bookedDays:l.bookedDays+d,revenue:l.revenue+(a.total_price||0)})}),this.apartmentOccupancyData=Array.from(n.entries()).map(([a,o])=>({apartment_id:a,apartment_name:this.getApartmentName(a),totalDays:c,bookedDays:o.bookedDays,occupancyRate:o.bookedDays/c*100,revenue:o.revenue})).sort((a,o)=>o.occupancyRate-a.occupancyRate),this.apartmentOccupancyData.length>0&&(this.averageOccupancyRate=this.apartmentOccupancyData.reduce((a,o)=>a+o.occupancyRate,0)/this.apartmentOccupancyData.length)}onPeriodChange(){this.processOccupancyData()}getApartmentName(e){const c=this.apartments.find(n=>(n.id||n._id)===e);return c?c.title:e}getOccupancySeverity(e){return e>=80?"success":e>=60?"info":e>=40?"warning":"danger"}static \u0275fac=function(c){return new(c||r)(t.rXU(w.g),t.rXU(h.bg))};static \u0275cmp=t.VBU({type:r,selectors:[["app-hotel-occupancy"]],features:[t.Jv_([h.bg])],decls:43,vars:15,consts:[["loadingTemplate",""],[1,"occupancy-page"],[1,"page-header"],[1,"header-content"],[1,"subtitle"],[1,"header-actions"],["optionLabel","label","optionValue","value",1,"period-selector",3,"ngModelChange","onChange","options","ngModel"],["pButton","","type","button","label","Refresh","icon","pi pi-refresh",1,"p-button-secondary",3,"click"],[1,"summary-cards"],[1,"summary-stat"],[1,"stat-value"],[1,"stat-label"],["header","Occupancy Rate Trend",4,"ngIf","ngIfElse"],["header","Occupancy by Apartment",4,"ngIf"],["header","Occupancy Rate Trend"],[1,"chart-container"],["type","line",3,"data","options"],["header","Occupancy by Apartment"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} apartments","styleClass","p-datatable-sm",3,"value","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"apartment-name"],[1,"booked-days"],[1,"total-days"],[1,"occupancy-display"],[1,"occupancy-bar"],[1,"occupancy-fill",3,"ngClass"],[3,"value","severity"],[1,"revenue-amount"],["colspan","5",1,"text-center"],[1,"empty-state"],[1,"pi","pi-chart-bar"],[1,"loading-container"],["height","400px"]],template:function(c,n){if(1&c){const a=t.RV6();t.j41(0,"div",1),t.nrm(1,"p-toast"),t.j41(2,"div",2)(3,"div",3)(4,"div")(5,"h1"),t.EFF(6,"Occupancy Analytics"),t.k0s(),t.j41(7,"p",4),t.EFF(8,"Track apartment occupancy rates and utilization"),t.k0s()(),t.j41(9,"div",5)(10,"p-dropdown",6),t.mxI("ngModelChange",function(p){return t.eBV(a),t.DH7(n.selectedPeriod,p)||(n.selectedPeriod=p),t.Njj(p)}),t.bIt("onChange",function(){return t.eBV(a),t.Njj(n.onPeriodChange())}),t.k0s(),t.j41(11,"button",7),t.bIt("click",function(){return t.eBV(a),t.Njj(n.loadData())}),t.k0s()()()(),t.j41(12,"div",8)(13,"p-card")(14,"div",9)(15,"span",10),t.EFF(16),t.nI1(17,"number"),t.k0s(),t.j41(18,"span",11),t.EFF(19,"Overall Occupancy Rate"),t.k0s()()(),t.j41(20,"p-card")(21,"div",9)(22,"span",10),t.EFF(23),t.k0s(),t.j41(24,"span",11),t.EFF(25,"Total Booked Days"),t.k0s()()(),t.j41(26,"p-card")(27,"div",9)(28,"span",10),t.EFF(29),t.k0s(),t.j41(30,"span",11),t.EFF(31,"Total Available Days"),t.k0s()()(),t.j41(32,"p-card")(33,"div",9)(34,"span",10),t.EFF(35),t.nI1(36,"number"),t.k0s(),t.j41(37,"span",11),t.EFF(38,"Average Occupancy Rate"),t.k0s()()()(),t.DNE(39,A,3,2,"p-card",12)(40,S,5,6,"p-card",13)(41,U,2,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&c){const a=t.sdS(42);t.R7$(10),t.Y8G("options",n.periodOptions),t.R50("ngModel",n.selectedPeriod),t.R7$(6),t.SpI("",t.i5U(17,9,n.overallOccupancyRate,"1.1-1"),"%"),t.R7$(7),t.JRh(n.totalBookedDays),t.R7$(6),t.JRh(n.totalAvailableDays),t.R7$(6),t.SpI("",t.i5U(36,12,n.averageOccupancyRate,"1.1-1"),"%"),t.R7$(4),t.Y8G("ngIf",!n.loading)("ngIfElse",a),t.R7$(),t.Y8G("ngIf",!n.loading)}},dependencies:[y.MD,y.YU,y.bT,y.QX,y.oe,O.YN,O.BC,O.vS,I.iI,P.tm,P._f,h.Ei,M.Dw,M.Zp,D.kr,D.ms,v.Fr,v.X9,f.bG,f.XI,b.EJ,b.Ex,k.MB,k.y8,E.k2,E.EA,F.$C],styles:[".occupancy-page[_ngcontent-%COMP%]{padding:2rem}.occupancy-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;background:linear-gradient(135deg,var(--p-surface-0) 0%,rgba(var(--p-primary-500),.05) 100%);padding:2rem;border-radius:12px;border-bottom:2px solid rgba(var(--p-primary-500),.2)}.occupancy-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.occupancy-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:2rem;font-weight:700;color:var(--p-surface-900)}.occupancy-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.95rem;color:var(--p-surface-600)}.occupancy-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.occupancy-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .period-selector[_ngcontent-%COMP%]{min-width:180px}.occupancy-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;margin-bottom:2rem}.occupancy-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem}.occupancy-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--p-primary-600)}.occupancy-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--p-surface-600);margin-top:.5rem}.occupancy-page[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{height:400px;position:relative}.occupancy-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{padding:2rem}.occupancy-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{padding:3rem;text-align:center;color:var(--p-surface-600)}.occupancy-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem;color:var(--p-surface-400)}.occupancy-page[_ngcontent-%COMP%]   .apartment-name[_ngcontent-%COMP%]{font-weight:500}.occupancy-page[_ngcontent-%COMP%]   .booked-days[_ngcontent-%COMP%], .occupancy-page[_ngcontent-%COMP%]   .total-days[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-700)}.occupancy-page[_ngcontent-%COMP%]   .revenue-amount[_ngcontent-%COMP%]{font-weight:600;color:var(--p-primary-600)}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]   .occupancy-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:var(--p-surface-200);border-radius:4px;overflow:hidden}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]   .occupancy-bar[_ngcontent-%COMP%]   .occupancy-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s ease}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]   .occupancy-bar[_ngcontent-%COMP%]   .occupancy-fill.bg-success[_ngcontent-%COMP%]{background:var(--p-success-500)}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]   .occupancy-bar[_ngcontent-%COMP%]   .occupancy-fill.bg-info[_ngcontent-%COMP%]{background:var(--p-primary-500)}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]   .occupancy-bar[_ngcontent-%COMP%]   .occupancy-fill.bg-warning[_ngcontent-%COMP%]{background:var(--p-warning-500)}.occupancy-page[_ngcontent-%COMP%]   .occupancy-display[_ngcontent-%COMP%]   .occupancy-bar[_ngcontent-%COMP%]   .occupancy-fill.bg-danger[_ngcontent-%COMP%]{background:var(--p-danger-500)}"]})}return r})()}}]);