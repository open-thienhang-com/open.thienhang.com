"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[4381],{4381:(et,D,u)=>{u.r(D),u.d(D,{DatasetDetailComponent:()=>tt});var p=u(467),t=u(1360),g=u(2881),v=u(9417),h=u(5498),m=u(9377),k=u(1141),C=u(491),y=u(6502),E=u(1570),F=u(2242),_=u(7897),T=u(6221),x=u(8559),f=u(1910),M=u(8512);const S=["truckTypeCanvas"],w=["truckSupplierCanvas"],B=["hubRegionCanvas"],j=["hubTypeCanvas"],H=["demandOrderCanvas"],R=["demandSummaryCanvas"],I=["demandPickupTimeCanvas"],O=["demandDeliveryTimeCanvas"],A=["hubMap"];function L(o,l){1&o&&(t.j41(0,"div",11),t.nrm(1,"div",12),t.j41(2,"span",13),t.EFF(3,"\u0110ang t\u1ea3i chi ti\u1ebft..."),t.k0s()())}function P(o,l){if(1&o&&(t.j41(0,"div",14),t.qSk(),t.j41(1,"svg",15),t.nrm(2,"path",16),t.k0s(),t.joV(),t.j41(3,"h3",17),t.EFF(4,"L\u1ed7i t\u1ea3i d\u1eef li\u1ec7u"),t.k0s(),t.j41(5,"p",18),t.EFF(6),t.k0s()()),2&o){const e=t.XpG();t.R7$(6),t.JRh(e.error)}}function G(o,l){if(1&o&&(t.j41(0,"th",55),t.EFF(1),t.k0s()),2&o){const e=l.$implicit;t.R7$(),t.SpI(" ",e," ")}}function V(o,l){if(1&o&&(t.j41(0,"td",58),t.EFF(1),t.k0s()),2&o){const e=l.$implicit,i=t.XpG().$implicit,n=t.XpG(3);t.R7$(),t.SpI(" ",n.formatCellValue(i[e],e)," ")}}function N(o,l){if(1&o&&(t.j41(0,"tr",56),t.DNE(1,V,2,1,"td",57),t.k0s()),2&o){const e=l.$implicit,i=l.index,n=t.XpG(3);t.Y8G("ngClass",i%2==0?"bg-white":"bg-gray-50"),t.R7$(),t.Y8G("ngForOf",n.getDataKeys(e))}}function $(o,l){if(1&o&&(t.j41(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25)(4,"span",26),t.EFF(5,"T\u1ed5ng B\u01b0u C\u1ee5c"),t.k0s(),t.qSk(),t.j41(6,"svg",27),t.nrm(7,"path",28),t.k0s()(),t.joV(),t.j41(8,"div",29),t.EFF(9),t.k0s(),t.j41(10,"div",30),t.EFF(11,"b\u01b0u c\u1ee5c"),t.k0s()(),t.j41(12,"div",31)(13,"div",25)(14,"span",26),t.EFF(15,"T\u1ed5ng \u0110\u01a1n L\u1ea5y"),t.k0s(),t.qSk(),t.j41(16,"svg",27),t.nrm(17,"path",32),t.k0s()(),t.joV(),t.j41(18,"div",29),t.EFF(19),t.nI1(20,"number"),t.k0s(),t.j41(21,"div",30),t.EFF(22,"\u0111\u01a1n"),t.k0s()(),t.j41(23,"div",33)(24,"div",25)(25,"span",26),t.EFF(26,"T\u1ed5ng \u0110\u01a1n Giao"),t.k0s(),t.qSk(),t.j41(27,"svg",27),t.nrm(28,"path",34),t.k0s()(),t.joV(),t.j41(29,"div",29),t.EFF(30),t.nI1(31,"number"),t.k0s(),t.j41(32,"div",30),t.EFF(33,"\u0111\u01a1n"),t.k0s()(),t.j41(34,"div",35)(35,"div",25)(36,"span",26),t.EFF(37,"TB \u0110\u01a1n/B\u01b0u C\u1ee5c"),t.k0s(),t.qSk(),t.j41(38,"svg",27),t.nrm(39,"path",36),t.k0s()(),t.joV(),t.j41(40,"div",29),t.EFF(41),t.k0s(),t.j41(42,"div",30),t.EFF(43,"\u0111\u01a1n l\u1ea5y"),t.k0s()()(),t.j41(44,"div",37)(45,"div",38)(46,"h5",39),t.EFF(47,"T\u1ed5ng L\u1ea5y/Giao"),t.k0s(),t.nrm(48,"canvas",40,0),t.k0s(),t.j41(50,"div",38)(51,"h5",39),t.EFF(52,"Ph\xe2n b\u1ed5 L\u1ea5y theo khung gi\u1edd"),t.k0s(),t.nrm(53,"canvas",40,1),t.k0s(),t.j41(55,"div",38)(56,"h5",39),t.EFF(57,"Ph\xe2n b\u1ed5 Giao theo khung gi\u1edd"),t.k0s(),t.nrm(58,"canvas",40,2),t.k0s()(),t.j41(60,"div",41)(61,"div",42)(62,"h4",43),t.EFF(63,"Th\u1ed1ng k\xea L\u1ea5y/Giao theo B\u01b0u c\u1ee5c"),t.k0s()(),t.j41(64,"div",44),t.nrm(65,"canvas",45,3),t.k0s()(),t.j41(67,"div",46)(68,"div",42)(69,"div",47)(70,"h4",43),t.EFF(71,"D\u1eef li\u1ec7u Demand"),t.k0s(),t.j41(72,"span",48),t.EFF(73),t.k0s()()(),t.j41(74,"div",49)(75,"table",50)(76,"thead",51)(77,"tr"),t.DNE(78,G,2,1,"th",52),t.k0s()(),t.j41(79,"tbody",53),t.DNE(80,N,2,2,"tr",54),t.k0s()()()()()),2&o){const e=t.XpG(2);t.R7$(9),t.JRh(e.getDemandStats().totalWarehouses),t.R7$(10),t.JRh(t.bMT(20,7,e.getDemandStats().totalPickOrders)),t.R7$(11),t.JRh(t.bMT(31,9,e.getDemandStats().totalDeliverOrders)),t.R7$(11),t.JRh(e.getDemandStats().avgPickOrders),t.R7$(32),t.SpI("",e.dataset.data.length," b\u01b0u c\u1ee5c"),t.R7$(5),t.Y8G("ngForOf",e.getDataKeys(e.dataset.data[0])),t.R7$(2),t.Y8G("ngForOf",e.dataset.data)}}function z(o,l){if(1&o&&(t.j41(0,"tr",56)(1,"td",72),t.EFF(2),t.k0s(),t.j41(3,"td",58)(4,"span",73),t.EFF(5),t.k0s()(),t.j41(6,"td",58),t.EFF(7),t.k0s(),t.j41(8,"td",74),t.EFF(9),t.k0s(),t.j41(10,"td",75),t.EFF(11),t.k0s(),t.j41(12,"td",75),t.EFF(13),t.k0s(),t.j41(14,"td",75),t.EFF(15),t.k0s()()),2&o){const e=l.$implicit,i=l.index,n=t.XpG(3);t.Y8G("ngClass",i%2==0?"bg-white":"bg-orange-50/30"),t.R7$(2),t.SpI(" ",e["B\u01b0u c\u1ee5c"]||"N/A"," "),t.R7$(2),t.Y8G("ngClass",n.getTruckTypeBadgeClass(e["Lo\u1ea1i xe"])),t.R7$(),t.SpI(" ",e["Lo\u1ea1i xe"]||"N/A"," "),t.R7$(2),t.SpI(" ",e["Nh\xe0 cung c\u1ea5p"]||"N/A"," "),t.R7$(2),t.SpI(" ",e["T\u1ed5ng xe"]||0," "),t.R7$(2),t.SpI(" ",(e["Trung b\xecnh qu\u1ea3ng \u0111\u01b0\u1eddng"]||0).toFixed(1)," km "),t.R7$(2),t.SpI(" ",(e["Trung b\xecnh th\u1eddi gian"]||0).toFixed(1)," h "),t.R7$(2),t.SpI(" ",e["V\u1eadn t\u1ed1c trung b\xecnh"]?e["V\u1eadn t\u1ed1c trung b\xecnh"].toFixed(1)+" km/h":"N/A"," ")}}function U(o,l){if(1&o&&(t.j41(0,"div",22)(1,"div",23)(2,"div",31)(3,"div",25)(4,"span",26),t.EFF(5,"T\u1ed5ng B\u01b0u C\u1ee5c"),t.k0s(),t.qSk(),t.j41(6,"svg",27),t.nrm(7,"path",28),t.k0s()(),t.joV(),t.j41(8,"div",29),t.EFF(9),t.k0s(),t.j41(10,"div",30),t.EFF(11,"b\u01b0u c\u1ee5c"),t.k0s()(),t.j41(12,"div",24)(13,"div",25)(14,"span",26),t.EFF(15,"T\u1ed5ng Xe"),t.k0s(),t.qSk(),t.j41(16,"svg",27),t.nrm(17,"path",36),t.k0s()(),t.joV(),t.j41(18,"div",29),t.EFF(19),t.k0s(),t.j41(20,"div",30),t.EFF(21,"xe"),t.k0s()(),t.j41(22,"div",33)(23,"div",25)(24,"span",26),t.EFF(25,"TB Qu\u1ea3ng \u0110\u01b0\u1eddng"),t.k0s(),t.qSk(),t.j41(26,"svg",27),t.nrm(27,"path",59),t.k0s()(),t.joV(),t.j41(28,"div",29),t.EFF(29),t.k0s(),t.j41(30,"div",30),t.EFF(31,"km"),t.k0s()(),t.j41(32,"div",35)(33,"div",25)(34,"span",26),t.EFF(35,"TB V\u1eadn T\u1ed1c"),t.k0s(),t.qSk(),t.j41(36,"svg",27),t.nrm(37,"path",60),t.k0s()(),t.joV(),t.j41(38,"div",29),t.EFF(39),t.k0s(),t.j41(40,"div",30),t.EFF(41,"km/h"),t.k0s()()(),t.j41(42,"div",61)(43,"div",62)(44,"h5",63),t.EFF(45,"Ph\xe2n b\u1ed5 theo Lo\u1ea1i Xe"),t.k0s(),t.j41(46,"div",64),t.nrm(47,"canvas",null,4),t.k0s()(),t.j41(49,"div",62)(50,"h5",63),t.EFF(51,"Top Nh\xe0 Cung C\u1ea5p"),t.k0s(),t.j41(52,"div",64),t.nrm(53,"canvas",null,5),t.k0s()()(),t.j41(55,"div",65)(56,"div",66)(57,"div",47)(58,"h4",43),t.EFF(59,"Danh s\xe1ch Xe theo B\u01b0u C\u1ee5c"),t.k0s(),t.j41(60,"span",48),t.EFF(61),t.k0s()()(),t.j41(62,"div",49)(63,"table",67)(64,"thead",68)(65,"tr")(66,"th",69),t.EFF(67,"B\u01b0u C\u1ee5c"),t.k0s(),t.j41(68,"th",69),t.EFF(69,"Lo\u1ea1i Xe"),t.k0s(),t.j41(70,"th",69),t.EFF(71,"Nh\xe0 Cung C\u1ea5p"),t.k0s(),t.j41(72,"th",70),t.EFF(73,"T\u1ed5ng Xe"),t.k0s(),t.j41(74,"th",70),t.EFF(75,"TB Qu\u1ea3ng \u0110\u01b0\u1eddng"),t.k0s(),t.j41(76,"th",70),t.EFF(77,"TB Th\u1eddi Gian"),t.k0s(),t.j41(78,"th",70),t.EFF(79,"V\u1eadn T\u1ed1c TB"),t.k0s()()(),t.j41(80,"tbody",71),t.DNE(81,z,16,9,"tr",54),t.k0s()()()()()),2&o){const e=t.XpG(2);t.R7$(9),t.JRh(e.getTruckStats().totalWarehouses),t.R7$(10),t.JRh(e.getTruckStats().totalTrucks),t.R7$(10),t.JRh(e.getTruckStats().avgDistance),t.R7$(10),t.JRh(e.getTruckStats().avgSpeed),t.R7$(22),t.SpI("",e.dataset.data.length," nh\xf3m xe"),t.R7$(20),t.Y8G("ngForOf",e.dataset.data)}}function W(o,l){if(1&o&&(t.j41(0,"tr",56)(1,"td",79),t.EFF(2),t.k0s(),t.j41(3,"td",80),t.EFF(4),t.k0s(),t.j41(5,"td",72),t.EFF(6),t.k0s(),t.j41(7,"td",58),t.EFF(8),t.k0s(),t.j41(9,"td",58),t.EFF(10),t.k0s(),t.j41(11,"td",58)(12,"span",73),t.EFF(13),t.k0s()(),t.j41(14,"td",58)(15,"span",73),t.EFF(16),t.k0s()()()),2&o){const e=l.$implicit,i=l.index,n=t.XpG(3);t.Y8G("ngClass",i%2==0?"bg-white":"bg-orange-50/30"),t.R7$(2),t.SpI(" ",e.STT||i+1," "),t.R7$(2),t.SpI(" ",e["ID BC"]||""," "),t.R7$(2),t.SpI(" ",e["T\xean BC"]||""," "),t.R7$(2),t.SpI(" ",e["Qu\u1eadn/Huy\u1ec7n"]||""," "),t.R7$(2),t.SpI(" ",e.T\u1ec9nh||""," "),t.R7$(2),t.Y8G("ngClass",n.getRegionBadgeClass(e.V\u00f9ng)),t.R7$(),t.SpI(" ",e.V\u00f9ng||""," "),t.R7$(2),t.Y8G("ngClass",n.getHubTypeBadgeClass(e["Lo\u1ea1i BC"])),t.R7$(),t.SpI(" ",e["Lo\u1ea1i BC"]||""," ")}}function K(o,l){if(1&o&&(t.j41(0,"div",22)(1,"div",23)(2,"div",31)(3,"div",25)(4,"span",26),t.EFF(5,"T\u1ed5ng B\u01b0u C\u1ee5c"),t.k0s(),t.qSk(),t.j41(6,"svg",27),t.nrm(7,"path",28),t.k0s()(),t.joV(),t.j41(8,"div",29),t.EFF(9),t.k0s(),t.j41(10,"div",30),t.EFF(11,"b\u01b0u c\u1ee5c"),t.k0s()(),t.j41(12,"div",24)(13,"div",25)(14,"span",26),t.EFF(15,"C\u1ea3 L\u1ea5y & Giao"),t.k0s(),t.qSk(),t.j41(16,"svg",27),t.nrm(17,"path",76),t.k0s()(),t.joV(),t.j41(18,"div",29),t.EFF(19),t.k0s(),t.j41(20,"div",30),t.EFF(21),t.k0s()(),t.j41(22,"div",33)(23,"div",25)(24,"span",26),t.EFF(25,"Ch\u1ec9 Giao"),t.k0s(),t.qSk(),t.j41(26,"svg",27),t.nrm(27,"path",77),t.k0s()(),t.joV(),t.j41(28,"div",29),t.EFF(29),t.k0s(),t.j41(30,"div",30),t.EFF(31),t.k0s()(),t.j41(32,"div",35)(33,"div",25)(34,"span",26),t.EFF(35,"S\u1ed1 V\xf9ng"),t.k0s(),t.qSk(),t.j41(36,"svg",27),t.nrm(37,"path",78),t.k0s()(),t.joV(),t.j41(38,"div",29),t.EFF(39),t.k0s(),t.j41(40,"div",30),t.EFF(41,"v\xf9ng"),t.k0s()()(),t.j41(42,"div",61)(43,"div",62)(44,"h5",63),t.EFF(45,"Ph\xe2n b\u1ed5 theo V\xf9ng"),t.k0s(),t.j41(46,"div",64),t.nrm(47,"canvas",null,6),t.k0s()(),t.j41(49,"div",62)(50,"h5",63),t.EFF(51,"Ph\xe2n b\u1ed5 theo Lo\u1ea1i B\u01b0u C\u1ee5c"),t.k0s(),t.j41(52,"div",64),t.nrm(53,"canvas",null,7),t.k0s()()(),t.j41(55,"div",65)(56,"div",66)(57,"div",47)(58,"h4",43),t.EFF(59,"Danh s\xe1ch B\u01b0u C\u1ee5c"),t.k0s(),t.j41(60,"span",48),t.EFF(61),t.k0s()()(),t.j41(62,"div",49)(63,"table",67)(64,"thead",68)(65,"tr")(66,"th",69),t.EFF(67,"STT"),t.k0s(),t.j41(68,"th",69),t.EFF(69,"ID BC"),t.k0s(),t.j41(70,"th",69),t.EFF(71,"T\xean BC"),t.k0s(),t.j41(72,"th",69),t.EFF(73,"Qu\u1eadn/Huy\u1ec7n"),t.k0s(),t.j41(74,"th",69),t.EFF(75,"T\u1ec9nh"),t.k0s(),t.j41(76,"th",69),t.EFF(77,"V\xf9ng"),t.k0s(),t.j41(78,"th",69),t.EFF(79,"Lo\u1ea1i BC"),t.k0s()()(),t.j41(80,"tbody",71),t.DNE(81,W,17,10,"tr",54),t.k0s()()()()()),2&o){const e=t.XpG(2);t.R7$(9),t.JRh(e.getHubStats().totalWarehouses),t.R7$(10),t.JRh(e.getHubStats().fullService),t.R7$(2),t.SpI("",e.getHubStats().fullServicePercent,"%"),t.R7$(8),t.JRh(e.getHubStats().deliveryOnly),t.R7$(2),t.SpI("",e.getHubStats().deliveryOnlyPercent,"%"),t.R7$(8),t.JRh(e.getHubStats().totalRegions),t.R7$(22),t.SpI("",e.dataset.data.length," b\u01b0u c\u1ee5c"),t.R7$(20),t.Y8G("ngForOf",e.dataset.data)}}function X(o,l){if(1&o&&(t.j41(0,"th",55),t.EFF(1),t.k0s()),2&o){const e=l.$implicit;t.R7$(),t.SpI(" ",e," ")}}function Y(o,l){if(1&o&&(t.j41(0,"td",58),t.EFF(1),t.k0s()),2&o){const e=l.$implicit,i=t.XpG().$implicit;t.R7$(),t.SpI(" ",i[e]," ")}}function Q(o,l){if(1&o&&(t.j41(0,"tr",56),t.DNE(1,Y,2,1,"td",57),t.k0s()),2&o){const e=l.$implicit,i=l.index,n=t.XpG(3);t.Y8G("ngClass",i%2==0?"bg-white":"bg-gray-50"),t.R7$(),t.Y8G("ngForOf",n.getDataKeys(e))}}function J(o,l){if(1&o&&(t.j41(0,"div",22)(1,"div",81)(2,"h4",82),t.EFF(3,"D\u1eef li\u1ec7u Dataset"),t.k0s(),t.j41(4,"div",49)(5,"table",50)(6,"thead",51)(7,"tr"),t.DNE(8,X,2,1,"th",52),t.k0s()(),t.j41(9,"tbody",53),t.DNE(10,Q,2,2,"tr",54),t.k0s()()()()()),2&o){const e=t.XpG(2);t.R7$(8),t.Y8G("ngForOf",e.getDataKeys(e.dataset.data[0])),t.R7$(2),t.Y8G("ngForOf",e.dataset.data)}}function Z(o,l){if(1&o&&(t.j41(0,"div",83)(1,"h4",82),t.EFF(2,"Metadata"),t.k0s(),t.j41(3,"pre",84),t.EFF(4),t.nI1(5,"json"),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(4),t.JRh(t.bMT(5,1,e.dataset.metadata))}}function q(o,l){if(1&o&&(t.j41(0,"div",19),t.DNE(1,$,81,11,"div",20)(2,U,82,6,"div",20)(3,K,82,8,"div",20)(4,J,11,2,"div",20)(5,Z,6,3,"div",21),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("ngIf","demand"===e.dataset.type&&e.dataset.data&&e.dataset.data.length>0),t.R7$(),t.Y8G("ngIf","truck"===e.dataset.type&&e.dataset.data&&e.dataset.data.length>0),t.R7$(),t.Y8G("ngIf","hub"===e.dataset.type&&e.dataset.data&&e.dataset.data.length>0),t.R7$(),t.Y8G("ngIf",e.dataset.data&&e.dataset.data.length>0&&"truck"!==e.dataset.type&&"demand"!==e.dataset.type&&"hub"!==e.dataset.type),t.R7$(),t.Y8G("ngIf",e.dataset&&e.dataset.metadata)}}h.t1.register(...h.$L);let tt=(()=>{class o{route;router;datasetService;cdr;platformId;datasetIdInput=null;embedded=!1;datasetId=null;dataset=null;loading=!0;error=null;truckTypeChart=null;truckSupplierChart=null;hubRegionChart=null;hubTypeChart=null;demandOrderChart=null;demandSummaryChart=null;demandPickupTimeChart=null;demandDeliveryTimeChart=null;showHubSearchDialog=!1;selectedHubs=[];hubSearchFilters={region:"",warehouse:"",id:""};filteredHubs=[];allHubs=[];map=null;hubMarkers=[];lastMapWidth=0;showMetadata=!1;hubSearchQuery="";selectedHubDetail=null;get hubs(){return this.allHubs}truckTypeCanvas;truckSupplierCanvas;hubRegionCanvas;hubTypeCanvas;demandOrderCanvas;demandSummaryCanvas;demandPickupTimeCanvas;demandDeliveryTimeCanvas;hubMap;constructor(e,i,n,a,s){this.route=e,this.router=i,this.datasetService=n,this.cdr=a,this.platformId=s}ngOnInit(){this.datasetId=this.datasetIdInput||this.route.snapshot.paramMap.get("id"),this.datasetId?this.loadDataset():(this.error="Kh\xf4ng c\xf3 ID dataset \u0111\u1ec3 hi\u1ec3n th\u1ecb",this.loading=!1)}ngAfterViewInit(){}ngAfterViewChecked(){if((0,m.UE)(this.platformId)&&this.map&&this.hubMap?.nativeElement){const e=this.hubMap.nativeElement.getBoundingClientRect();e.width>0&&e.height>0&&e.width!==this.lastMapWidth&&(this.lastMapWidth=e.width,setTimeout(()=>{this.map&&(this.map.invalidateSize(),console.log("[DatasetDetail] Map size invalidated due to container resize"))},100))}}ngOnDestroy(){if(this.truckTypeChart&&this.truckTypeChart.destroy(),this.truckSupplierChart&&this.truckSupplierChart.destroy(),this.hubRegionChart&&this.hubRegionChart.destroy(),this.hubTypeChart&&this.hubTypeChart.destroy(),this.demandOrderChart&&this.demandOrderChart.destroy(),this.demandSummaryChart&&this.demandSummaryChart.destroy(),this.demandPickupTimeChart&&this.demandPickupTimeChart.destroy(),this.demandDeliveryTimeChart&&this.demandDeliveryTimeChart.destroy(),(0,m.UE)(this.platformId)&&this.map){console.log("[DatasetDetail] Cleaning up map instance");try{this.hubMarkers.forEach(e=>{this.map&&this.map.hasLayer(e)&&this.map.removeLayer(e)}),this.hubMarkers=[],this.map.remove(),this.map=null,console.log("[DatasetDetail] Map cleanup completed")}catch(e){console.error("[DatasetDetail] Error during map cleanup:",e),this.map=null}}}loadDataset(){this.datasetId&&(this.loading=!0,this.error=null,this.datasetService.getDataset(this.datasetId).subscribe({next:e=>{if(e.ok&&e.data&&e.data.data){const i=Array.isArray(e.data.data)?e.data.data[0]:e.data.data;this.dataset=i,setTimeout(()=>{this.initializeVisualizations()},100)}else this.error="Kh\xf4ng th\u1ec3 t\u1ea3i chi ti\u1ebft dataset";this.loading=!1,this.cdr.markForCheck()},error:e=>{this.error=e?.message||"L\u1ed7i khi t\u1ea3i dataset",this.loading=!1,this.cdr.markForCheck()}}))}initializeVisualizations(){!this.dataset||!this.dataset.data||("truck"===this.dataset.type?this.initializeTruckCharts():"hub"===this.dataset.type?(this.initializeHubCharts(),(0,m.UE)(this.platformId)&&(this.ensureMapReady().then(()=>{this.initializeMap().then(()=>{this.loadDefaultHubWarehouses()})}),this.initializeHubData())):"demand"===this.dataset.type&&this.initializeDemandCharts())}ensureMapReady(){var e=this;return(0,p.A)(function*(){return new Promise(i=>{const n=()=>{e.map?(console.log("[DatasetDetail] Map is ready"),i()):(console.log("[DatasetDetail] Waiting for map to be ready..."),setTimeout(n,100))};setTimeout(()=>{console.warn("[DatasetDetail] Map readiness check timed out"),i()},5e3),n()})})()}initializeHubCharts(){if(!this.dataset?.data)return void console.log("[DatasetDetail] No dataset data available for hub charts");if(typeof window>"u"||!window.document)return void console.log("[DatasetDetail] Skipping hub chart initialization in SSR environment");const e=this.dataset.data;console.log("[DatasetDetail] Initializing hub charts with data:",e),this.hubRegionChart&&this.hubRegionChart.destroy(),this.hubTypeChart&&this.hubTypeChart.destroy();const i=e.reduce((a,s)=>{const r=s.V\u00f9ng||"Unknown";return a[r]=(a[r]||0)+1,a},{});console.log("[DatasetDetail] Region counts:",i),this.hubRegionCanvas?.nativeElement?(this.hubRegionChart=new h.t1(this.hubRegionCanvas.nativeElement,{type:"doughnut",data:{labels:Object.keys(i),datasets:[{data:Object.values(i),backgroundColor:["#3B82F6","#10B981","#8B5CF6","#F59E0B","#EF4444"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}}}}}),console.log("[DatasetDetail] Hub region chart created successfully")):console.error("[DatasetDetail] Could not find hub region canvas element");const n=e.reduce((a,s)=>{const r=s["Lo\u1ea1i BC"]||"Unknown";return a[r]=(a[r]||0)+1,a},{});console.log("[DatasetDetail] Hub type counts:",n),this.hubTypeCanvas?.nativeElement?(this.hubTypeChart=new h.t1(this.hubTypeCanvas.nativeElement,{type:"bar",data:{labels:Object.keys(n),datasets:[{label:"S\u1ed1 l\u01b0\u1ee3ng b\u01b0u c\u1ee5c",data:Object.values(n),backgroundColor:"#F59E0B",borderColor:"#D97706",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{precision:0}}},plugins:{legend:{display:!1}}}}),console.log("[DatasetDetail] Hub type chart created successfully")):console.error("[DatasetDetail] Could not find hub type canvas element")}loadDefaultHubWarehouses(){console.log("[DatasetDetail] Loading default HNO warehouses for dataset type:",this.dataset?.type),this.datasetService.getWarehouses({region_shortname:"HCM",size:1e3,offset:0}).subscribe({next:e=>{if(console.log("[DatasetDetail] API response for HNO warehouses:",e),e.ok&&e.data){console.log("[DatasetDetail] Raw response.data:",e.data),console.log("[DatasetDetail] Type of response.data:",typeof e.data),console.log("[DatasetDetail] Is array?",Array.isArray(e.data));let i=[];const n=e.data;if(Array.isArray(n))i=n;else if(n&&Array.isArray(n.data))i=n.data;else if(n&&"object"==typeof n){const a=Object.values(n).filter(s=>Array.isArray(s));a.length>0&&(i=a[0])}console.log("[DatasetDetail] Extracted warehouses:",i),this.selectedHubs=i.map(a=>{console.log("[DatasetDetail] Transforming warehouse:",a),console.log("[DatasetDetail] Warehouse coordinates - lat:",a.latitude,"lng:",a.longitude);const s={"ID BC":a.warehouse_id?.toString()||a.id,"T\xean BC":a.warehouse_name||"Unknown",V\u00f9ng:a.region_shortname||"HNO",T\u1ec9nh:a.province_name||"Unknown","Qu\u1eadn/Huy\u1ec7n":a.district_name||"Unknown","Lo\u1ea1i BC":a.warehouse_type||"Unknown",Lat:parseFloat(a.latitude)||0,Lng:parseFloat(a.longitude)||0,originalData:a};return console.log("[DatasetDetail] Transformed hub:",s),s}),console.log("[DatasetDetail] Transformed selectedHubs:",this.selectedHubs),this.cdr.markForCheck(),this.ensureMapReady().then(()=>{this.map?this.updateMapMarkers():console.warn("[DatasetDetail] Map still not ready after waiting, markers will be updated when map initializes")}),console.log("[DatasetDetail] Loaded default HNO warehouses:",this.selectedHubs.length)}else console.warn("[DatasetDetail] Failed to load default HNO warehouses, using empty selection"),this.selectedHubs=[],this.cdr.markForCheck()},error:e=>{console.error("[DatasetDetail] Error loading default HNO warehouses:",e),this.selectedHubs=[],this.cdr.markForCheck()}})}initializeTruckCharts(){if(this.dataset?.data||(console.log("[DatasetDetail] No dataset data available for charts, using mock data"),this.dataset={...this.dataset,data:[{"B\u01b0u c\u1ee5c":"HCM001","Lo\u1ea1i xe":"GHN","Nh\xe0 cung c\u1ea5p":"Toyota","T\u1ed5ng xe":5,"Trung b\xecnh qu\u1ea3ng \u0111\u01b0\u1eddng":150.5,"Trung b\xecnh th\u1eddi gian":8.2,"V\u1eadn t\u1ed1c trung b\xecnh":18.4},{"B\u01b0u c\u1ee5c":"HCM002","Lo\u1ea1i xe":"NCC","Nh\xe0 cung c\u1ea5p":"Honda","T\u1ed5ng xe":3,"Trung b\xecnh qu\u1ea3ng \u0111\u01b0\u1eddng":120.3,"Trung b\xecnh th\u1eddi gian":6.8,"V\u1eadn t\u1ed1c trung b\xecnh":17.7},{"B\u01b0u c\u1ee5c":"HN001","Lo\u1ea1i xe":"GHN","Nh\xe0 cung c\u1ea5p":"Toyota","T\u1ed5ng xe":4,"Trung b\xecnh qu\u1ea3ng \u0111\u01b0\u1eddng":180.2,"Trung b\xecnh th\u1eddi gian":9.5,"V\u1eadn t\u1ed1c trung b\xecnh":18.9},{"B\u01b0u c\u1ee5c":"HN002","Lo\u1ea1i xe":"NCC","Nh\xe0 cung c\u1ea5p":"Honda","T\u1ed5ng xe":2,"Trung b\xecnh qu\u1ea3ng \u0111\u01b0\u1eddng":95.1,"Trung b\xecnh th\u1eddi gian":5.2,"V\u1eadn t\u1ed1c trung b\xecnh":18.3}]}),typeof window>"u"||!window.document)return void console.log("[DatasetDetail] Skipping truck chart initialization in SSR environment");const e=this.dataset.data;console.log("[DatasetDetail] Initializing truck charts with data:",e),this.truckTypeChart&&this.truckTypeChart.destroy(),this.truckSupplierChart&&this.truckSupplierChart.destroy();const i=e.reduce((s,r)=>{const d=r["Lo\u1ea1i xe"]||"Unknown";return s[d]=(s[d]||0)+(r["T\u1ed5ng xe"]||0),s},{});console.log("[DatasetDetail] Type counts:",i),this.truckTypeCanvas?.nativeElement?(this.truckTypeChart=new h.t1(this.truckTypeCanvas.nativeElement,{type:"doughnut",data:{labels:Object.keys(i),datasets:[{data:Object.values(i),backgroundColor:["#3B82F6","#10B981","#8B5CF6","#F59E0B"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}}}}}),console.log("[DatasetDetail] Truck type chart created successfully")):console.error("[DatasetDetail] Could not find truck type canvas element");const n=e.reduce((s,r)=>{const d=r["Nh\xe0 cung c\u1ea5p"]||"Unknown";return s[d]=(s[d]||0)+(r["T\u1ed5ng xe"]||0),s},{}),a=Object.entries(n).sort(([,s],[,r])=>r-s).slice(0,5);console.log("[DatasetDetail] Supplier counts:",n),console.log("[DatasetDetail] Top 5 suppliers:",a),this.truckSupplierCanvas?.nativeElement?(this.truckSupplierChart=new h.t1(this.truckSupplierCanvas.nativeElement,{type:"bar",data:{labels:a.map(([s])=>s),datasets:[{label:"S\u1ed1 l\u01b0\u1ee3ng xe",data:a.map(([,s])=>s),backgroundColor:"#F59E0B",borderColor:"#D97706",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{precision:0}}},plugins:{legend:{display:!1}}}}),console.log("[DatasetDetail] Truck supplier chart created successfully")):console.error("[DatasetDetail] Could not find truck supplier canvas element")}initializeDemandCharts(){if(console.log("[DatasetDetail] initializeDemandCharts called"),!this.dataset?.data)return void console.log("[DatasetDetail] No dataset data available for demand charts");if(typeof window>"u"||!window.document)return void console.log("[DatasetDetail] Skipping chart initialization in SSR environment");const e=this.dataset.data;if(console.log("[DatasetDetail] Initializing demand charts with data:",e),console.log("[DatasetDetail] Dataset type:",this.dataset.type),console.log("[DatasetDetail] Data length:",e.length),this.demandOrderChart&&this.demandOrderChart.destroy(),this.demandSummaryChart&&this.demandSummaryChart.destroy(),this.demandPickupTimeChart&&this.demandPickupTimeChart.destroy(),this.demandDeliveryTimeChart&&this.demandDeliveryTimeChart.destroy(),this.demandSummaryCanvas?.nativeElement){const i=e.reduce((a,s)=>a+(s["T\u1ed5ng L\u1ea5y"]||s.pick_order_count||0),0),n=e.reduce((a,s)=>a+(s["T\u1ed5ng Giao"]||s.deliver_order_count||0),0);this.demandSummaryChart=new h.t1(this.demandSummaryCanvas.nativeElement,{type:"doughnut",data:{labels:["T\u1ed5ng L\u1ea5y","T\u1ed5ng Giao"],datasets:[{data:[i,n],backgroundColor:["rgba(249, 115, 22, 0.8)","rgba(251, 146, 60, 0.8)"],borderColor:["rgba(249, 115, 22, 1)","rgba(251, 146, 60, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(a){const s=a.dataset.data.reduce((d,c)=>d+c,0),r=(a.parsed/s*100).toFixed(1);return a.label+": "+a.parsed.toLocaleString("vi-VN")+" ("+r+"%)"}}}}}}),console.log("[DatasetDetail] Demand summary chart created successfully")}if(this.demandPickupTimeCanvas?.nativeElement){const i=e.reduce((r,d)=>r+(d["L\u1ea5y S\xe1ng"]||0),0),n=e.reduce((r,d)=>r+(d["L\u1ea5y Tr\u01b0a"]||0),0),a=e.reduce((r,d)=>r+(d["L\u1ea5y Chi\u1ec1u"]||0),0),s=e.reduce((r,d)=>r+(d["L\u1ea5y T\u1ed1i"]||0),0);this.demandPickupTimeChart=new h.t1(this.demandPickupTimeCanvas.nativeElement,{type:"polarArea",data:{labels:["S\xe1ng","Tr\u01b0a","Chi\u1ec1u","T\u1ed1i"],datasets:[{data:[i,n,a,s],backgroundColor:["rgba(254, 215, 170, 0.7)","rgba(253, 186, 116, 0.7)","rgba(251, 146, 60, 0.7)","rgba(249, 115, 22, 0.7)"],borderColor:["rgba(254, 215, 170, 1)","rgba(253, 186, 116, 1)","rgba(251, 146, 60, 1)","rgba(249, 115, 22, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom"}}}}),console.log("[DatasetDetail] Demand pickup time chart created successfully")}if(this.demandDeliveryTimeCanvas?.nativeElement){const i=e.reduce((s,r)=>s+(r["Giao S\xe1ng"]||0),0),n=e.reduce((s,r)=>s+(r["Giao Tr\u01b0a"]||0),0),a=e.reduce((s,r)=>s+(r["Giao Chi\u1ec1u"]||0),0);this.demandDeliveryTimeChart=new h.t1(this.demandDeliveryTimeCanvas.nativeElement,{type:"polarArea",data:{labels:["S\xe1ng","Tr\u01b0a","Chi\u1ec1u"],datasets:[{data:[i,n,a],backgroundColor:["rgba(254, 215, 170, 0.7)","rgba(253, 186, 116, 0.7)","rgba(251, 146, 60, 0.7)"],borderColor:["rgba(254, 215, 170, 1)","rgba(253, 186, 116, 1)","rgba(251, 146, 60, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom"}}}}),console.log("[DatasetDetail] Demand delivery time chart created successfully")}if(this.demandOrderCanvas?.nativeElement){const i=e.map(s=>{const r=s.warehouse_name||s._id||s["B\u01b0u c\u1ee5c"]||"N/A";return r.length>20?r.substring(0,20)+"...":r}),n=e.map(s=>s["T\u1ed5ng L\u1ea5y"]||s.pick_order_count||0),a=e.map(s=>s["T\u1ed5ng Giao"]||s.deliver_order_count||0);console.log("[DatasetDetail] Creating demand order chart with labels:",i),console.log("[DatasetDetail] Pickup data:",n),console.log("[DatasetDetail] Delivery data:",a),this.demandOrderChart=new h.t1(this.demandOrderCanvas.nativeElement,{type:"bar",data:{labels:i,datasets:[{label:"T\u1ed5ng L\u1ea5y",data:n,backgroundColor:"rgba(249, 115, 22, 0.6)",borderColor:"rgba(249, 115, 22, 1)",borderWidth:2},{label:"T\u1ed5ng Giao",data:a,backgroundColor:"rgba(251, 146, 60, 0.6)",borderColor:"rgba(251, 146, 60, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0,ticks:{callback:function(s){return"number"==typeof s?s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toString():s}}}},plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(s){let r=s.dataset.label||"";return r&&(r+=": "),null!==s.parsed.y&&(r+=s.parsed.y.toLocaleString("vi-VN")),r}}}}}}),console.log("[DatasetDetail] Demand order chart created successfully")}}getHubStats(){if(!this.dataset?.data||"hub"!==this.dataset.type)return{};const e=this.dataset.data,i=e.length,n=e.filter(r=>"C\u1ea3 L\u1ea5y & Giao"===r["Lo\u1ea1i BC"]).length,a=e.filter(r=>"Ch\u1ec9 Giao"===r["Lo\u1ea1i BC"]).length,s=[...new Set(e.map(r=>r.V\u00f9ng))].length;return{totalWarehouses:i,fullService:n,fullServicePercent:i>0?(n/i*100).toFixed(1):"0",deliveryOnly:a,deliveryOnlyPercent:i>0?(a/i*100).toFixed(1):"0",totalRegions:s}}getTruckStats(){if(!this.dataset?.data||"truck"!==this.dataset.type)return{};const e=this.dataset.data,i=e.length,n=e.reduce((r,d)=>r+(d["T\u1ed5ng xe"]||0),0),a=e.reduce((r,d)=>r+(d["Trung b\xecnh qu\u1ea3ng \u0111\u01b0\u1eddng"]||0),0)/i,s=e.reduce((r,d)=>r+(d["V\u1eadn t\u1ed1c trung b\xecnh"]||0),0)/i;return{totalWarehouses:i,totalTrucks:n,avgDistance:isNaN(a)?0:a.toFixed(1),avgSpeed:isNaN(s)?0:s.toFixed(1)}}getDemandStats(){if(!this.dataset?.data||"demand"!==this.dataset.type)return{};const e=this.dataset.data,i=e.length,n=e.reduce((c,b)=>c+(b.pick_order_count||0),0),a=e.reduce((c,b)=>c+(b.deliver_order_count||0),0),r=n/i,d=a/i;return{totalWarehouses:i,totalPickOrders:n,totalDeliverOrders:a,totalOrders:n+a,avgPickOrders:isNaN(r)?0:r.toFixed(0),avgDeliverOrders:isNaN(d)?0:d.toFixed(0)}}goBack(){this.router.navigate(["/dataset"])}getQualityColorClass(e){return e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600"}getRegionBadgeClass(e){switch(e){case"NTB":return"bg-blue-100 text-blue-800";case"HCM":return"bg-green-100 text-green-800";case"HN":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}}getTruckTypeBadgeClass(e){switch(e){case"GHN":return"bg-blue-100 text-blue-800";case"NCC":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}getDataKeys(e){return e?Object.keys(e):[]}formatCellValue(e,i){return null==e?"":"number"==typeof e?e>1e6?(e/1e6).toFixed(1)+"M":e>1e3?(e/1e3).toFixed(1)+"K":e.toLocaleString("vi-VN",{maximumFractionDigits:2}):String(e)}openHubSearchDialog(){this.showHubSearchDialog=!0,this.initializeHubData(),this.filterHubs()}closeHubSearchDialog(){this.showHubSearchDialog=!1}initializeHubData(){this.datasetService.getWarehouses({region_shortname:"HCM",size:1e3,offset:0}).subscribe({next:e=>{e.ok&&e.data?(this.allHubs=e.data.map(i=>({"ID BC":i.warehouse_id?.toString()||i.id,"T\xean BC":i.warehouse_name||"Unknown",V\u00f9ng:i.region_shortname||"Unknown",T\u1ec9nh:i.province_name||"Unknown","Qu\u1eadn/Huy\u1ec7n":i.district_name||"Unknown","Lo\u1ea1i BC":i.warehouse_type||"Unknown","Kinh \u0111\u1ed9":i.longitude||0,"V\u0129 \u0111\u1ed9":i.latitude||0,originalData:i})),this.filterHubs()):(console.error("Failed to load warehouse data:",e),this.loadMockHubData())},error:e=>{console.error("Error loading warehouse data:",e),this.loadMockHubData()}})}loadMockHubData(){this.allHubs=[{"ID BC":"BC001","T\xean BC":"B\u01b0u c\u1ee5c H\xe0 N\u1ed9i 1",V\u00f9ng:"Mi\u1ec1n B\u1eafc",T\u1ec9nh:"H\xe0 N\u1ed9i","Qu\u1eadn/Huy\u1ec7n":"Ho\xe0n Ki\u1ebfm","Lo\u1ea1i BC":"Trung t\xe2m","Kinh \u0111\u1ed9":105.8342,"V\u0129 \u0111\u1ed9":21.0278},{"ID BC":"BC002","T\xean BC":"B\u01b0u c\u1ee5c H\xe0 N\u1ed9i 2",V\u00f9ng:"Mi\u1ec1n B\u1eafc",T\u1ec9nh:"H\xe0 N\u1ed9i","Qu\u1eadn/Huy\u1ec7n":"\u0110\u1ed1ng \u0110a","Lo\u1ea1i BC":"Ph\u1ee5 tr\u1ee3","Kinh \u0111\u1ed9":105.8242,"V\u0129 \u0111\u1ed9":21.0178},{"ID BC":"BC003","T\xean BC":"B\u01b0u c\u1ee5c TP.HCM 1",V\u00f9ng:"Mi\u1ec1n Nam",T\u1ec9nh:"TP.HCM","Qu\u1eadn/Huy\u1ec7n":"Qu\u1eadn 1","Lo\u1ea1i BC":"Trung t\xe2m","Kinh \u0111\u1ed9":106.6992,"V\u0129 \u0111\u1ed9":10.7769},{"ID BC":"BC004","T\xean BC":"B\u01b0u c\u1ee5c \u0110\xe0 N\u1eb5ng",V\u00f9ng:"Mi\u1ec1n Trung",T\u1ec9nh:"\u0110\xe0 N\u1eb5ng","Qu\u1eadn/Huy\u1ec7n":"H\u1ea3i Ch\xe2u","Lo\u1ea1i BC":"Ph\u1ee5 tr\u1ee3","Kinh \u0111\u1ed9":108.2208,"V\u0129 \u0111\u1ed9":16.0544},{"ID BC":"BC005","T\xean BC":"B\u01b0u c\u1ee5c C\u1ea7n Th\u01a1",V\u00f9ng:"Mi\u1ec1n Nam",T\u1ec9nh:"C\u1ea7n Th\u01a1","Qu\u1eadn/Huy\u1ec7n":"Ninh Ki\u1ec1u","Lo\u1ea1i BC":"Trung t\xe2m","Kinh \u0111\u1ed9":105.7852,"V\u0129 \u0111\u1ed9":10.0458}],this.filterHubs()}filterHubs(){this.filteredHubs=this.allHubs.filter(e=>{const i=!this.hubSearchFilters.region||e.V\u00f9ng===this.hubSearchFilters.region,n=!this.hubSearchFilters.warehouse||e["T\xean BC"].toLowerCase().includes(this.hubSearchFilters.warehouse.toLowerCase()),a=!this.hubSearchFilters.id||e["ID BC"].toLowerCase().includes(this.hubSearchFilters.id.toLowerCase()),s=!this.hubSearchQuery.trim()||e["T\xean BC"]&&e["T\xean BC"].toLowerCase().includes(this.hubSearchQuery.toLowerCase())||e["ID BC"]&&e["ID BC"].toLowerCase().includes(this.hubSearchQuery.toLowerCase())||e.V\u00f9ng&&e.V\u00f9ng.toLowerCase().includes(this.hubSearchQuery.toLowerCase());return i&&n&&a&&s})}searchHubs(){this.datasetService.getWarehouses({region_shortname:this.hubSearchFilters.region||"HCM",size:1e3,offset:0,search:this.hubSearchFilters.warehouse||this.hubSearchFilters.id||""}).subscribe({next:i=>{i.ok&&i.data&&(this.allHubs=i.data.map(n=>({"ID BC":n.warehouse_id?.toString()||n.id,"T\xean BC":n.warehouse_name||"Unknown",V\u00f9ng:n.region_shortname||"Unknown",T\u1ec9nh:n.province_name||"Unknown","Qu\u1eadn/Huy\u1ec7n":n.district_name||"Unknown","Lo\u1ea1i BC":n.warehouse_type||"Unknown","Kinh \u0111\u1ed9":n.longitude||0,"V\u0129 \u0111\u1ed9":n.latitude||0,originalData:n})),this.filterHubs())},error:i=>{console.error("Error searching warehouses:",i)}})}getUniqueRegions(){return[...new Set(this.allHubs.map(e=>e.V\u00f9ng))]}isHubSelected(e){return this.selectedHubs.some(i=>i["ID BC"]===e["ID BC"])}toggleHubSelection(e){const i=this.selectedHubs.findIndex(n=>n["ID BC"]===e["ID BC"]);i>-1?this.selectedHubs.splice(i,1):this.selectedHubs.push(e)}clearHubSelection(){this.selectedHubs=[]}selectAllHubs(){this.selectedHubs=[...this.allHubs],this.updateMapMarkers(),console.log("Selected all hubs:",this.selectedHubs.length)}confirmHubSelection(){var e=this;return(0,p.A)(function*(){e.closeHubSearchDialog(),yield e.updateMapMarkers(),console.log("Selected hubs:",e.selectedHubs)})()}removeHub(e){var i=this;return(0,p.A)(function*(){const n=i.selectedHubs.findIndex(a=>a["ID BC"]===e["ID BC"]);n>-1&&(i.selectedHubs.splice(n,1),yield i.updateMapMarkers())})()}getHubTypeBadgeClass(e){switch(e){case"Trung t\xe2m":return"bg-blue-100 text-blue-800";case"Ph\u1ee5 tr\u1ee3":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}initializeMap(){var e=this;return(0,p.A)(function*(){if((0,m.UE)(e.platformId))if(e.hubMap&&e.hubMap.nativeElement)if(e.map)console.log("[DatasetDetail] Map already initialized, skipping re-initialization");else{console.log("[DatasetDetail] Starting map initialization...");try{const n=yield u.e(8244).then(u.t.bind(u,8244,23));console.log("[DatasetDetail] Leaflet imported successfully");const a="/images/leaflet/",s=a+"marker-icon-2x.png",r=a+"marker-icon.png",d=a+"marker-shadow.png";if(n.Icon&&n.Icon.Default)n.Icon.Default.mergeOptions({iconRetinaUrl:s,iconUrl:r,shadowUrl:d,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});else if(n.icon){const c=n.icon({iconRetinaUrl:s,iconUrl:r,shadowUrl:d,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});n.Marker&&(n.Marker.prototype.options.icon=c)}e.map=n.map(e.hubMap.nativeElement,{center:[14.0583,108.2772],zoom:6,zoomControl:!0,scrollWheelZoom:!0}),console.log("[DatasetDetail] Map instance created and centered on Vietnam"),n.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,minZoom:3}).addTo(e.map),console.log("[DatasetDetail] OpenStreetMap tile layer added successfully"),setTimeout(()=>{e.map&&(e.map.invalidateSize(),console.log("[DatasetDetail] Map size invalidated after initialization"),e.map._loaded&&e.map.eachLayer(c=>{c.redraw&&c.redraw()}))},300),e.selectedHubs&&e.selectedHubs.length>0?(console.log("[DatasetDetail] Updating markers for existing hubs after map init"),setTimeout(()=>{e.map&&e.updateMapMarkers()},300)):console.log("[DatasetDetail] No hubs to display yet")}catch(i){console.error("[DatasetDetail] Error initializing map:",i),e.map=null}}else console.log("[DatasetDetail] Skipping map initialization - hubMap element not found or not ready");else console.log("[DatasetDetail] Skipping map initialization - not in browser")})()}updateMapMarkers(){var e=this;return(0,p.A)(function*(){if((0,m.UE)(e.platformId))if(e.map){console.log("[DatasetDetail] Starting map marker update process for",e.selectedHubs.length,"hubs");try{const i=yield u.e(8244).then(u.t.bind(u,8244,23));console.log("[DatasetDetail] Leaflet imported for marker update"),console.log("[DatasetDetail] Clearing",e.hubMarkers.length,"existing markers"),e.hubMarkers.forEach(a=>{e.map&&e.map.hasLayer(a)&&e.map.removeLayer(a)}),e.hubMarkers=[];let n=0;if(e.selectedHubs.forEach((a,s)=>{if(console.log("[DatasetDetail] Processing hub",s,a["T\xean BC"]),a.Lng&&a.Lat&&"number"==typeof a.Lat&&"number"==typeof a.Lng){const r=a.Lat,d=a.Lng;if(0!==r&&0!==d&&r>=-90&&r<=90&&d>=-180&&d<=180)try{const c=i.marker([r,d]).addTo(e.map).bindPopup('<div class="p-2 max-w-xs"><h3 class="font-semibold text-sm mb-1">'+(a["T\xean BC"]||"Unknown")+'</h3><p class="text-xs text-gray-600 mb-1">ID: '+(a["ID BC"]||"N/A")+'</p><p class="text-xs text-gray-600 mb-1">'+(a["Qu\u1eadn/Huy\u1ec7n"]||"")+", "+(a.T\u1ec9nh||"")+'</p><p class="text-xs text-gray-600">V\xf9ng: '+(a.V\u00f9ng||"N/A")+"</p></div>");e.hubMarkers.push(c),n++,console.log("[DatasetDetail] Added marker for",a["T\xean BC"])}catch(c){console.error("[DatasetDetail] Error creating marker for",a["T\xean BC"],c)}else console.warn("[DatasetDetail] Skipping hub",a["T\xean BC"],"- invalid coordinates:",{lat:r,lng:d})}else console.warn("[DatasetDetail] Skipping hub",a["T\xean BC"],"- missing coordinates:",{lat:a.Lat,lng:a.Lng})}),console.log("[DatasetDetail] Successfully added",n,"markers out of",e.selectedHubs.length,"hubs"),e.hubMarkers.length>0)try{const s=i.featureGroup(e.hubMarkers).getBounds();s.isValid()?(e.map.fitBounds(s.pad(.1)),console.log("[DatasetDetail] Fitted map bounds to show all markers")):console.warn("[DatasetDetail] Invalid bounds for markers, skipping fitBounds")}catch(a){console.error("[DatasetDetail] Error fitting map bounds:",a)}else console.log("[DatasetDetail] No valid markers to fit bounds")}catch(i){console.error("[DatasetDetail] Error updating map markers:",i)}}else console.log("[DatasetDetail] Skipping map marker update - map not initialized yet");else console.log("[DatasetDetail] Skipping map marker update - not in browser")})()}forceRefreshMarkers(){this.map&&this.selectedHubs.length>0?(console.log("[DatasetDetail] Force refreshing markers..."),this.updateMapMarkers()):console.warn("[DatasetDetail] Cannot refresh markers - map not ready or no hubs selected")}forceRefreshMap(){this.map?(console.log("[DatasetDetail] Force refreshing map display..."),this.map.invalidateSize(),setTimeout(()=>{this.map&&(this.map.eachLayer(e=>{e.redraw&&e.redraw()}),console.log("[DatasetDetail] Map layers redrawn"))},100)):console.warn("[DatasetDetail] Cannot refresh map - map not initialized")}editDataset(){this.datasetId&&this.router.navigate(["/datasets",this.datasetId,"edit"])}toggleMetadata(){this.showMetadata=!this.showMetadata}selectHubForDetail(e){this.selectedHubDetail=e}closeHubDetail(){this.selectedHubDetail=null}getHubInitials(e){const n=(e["T\xean BC"]||e.name||"").split(" ");return n.length>=2?(n[0].charAt(0)+n[1].charAt(0)).toUpperCase():1===n.length?n[0].substring(0,2).toUpperCase():"BC"}static \u0275fac=function(i){return new(i||o)(t.rXU(f.nX),t.rXU(f.Ix),t.rXU(M.q),t.rXU(t.gRc),t.rXU(t.Agw))};static \u0275cmp=t.VBU({type:o,selectors:[["app-dataset-detail"]],viewQuery:function(i,n){if(1&i&&(t.GBs(S,5),t.GBs(w,5),t.GBs(B,5),t.GBs(j,5),t.GBs(H,5),t.GBs(R,5),t.GBs(I,5),t.GBs(O,5),t.GBs(A,5)),2&i){let a;t.mGM(a=t.lsd())&&(n.truckTypeCanvas=a.first),t.mGM(a=t.lsd())&&(n.truckSupplierCanvas=a.first),t.mGM(a=t.lsd())&&(n.hubRegionCanvas=a.first),t.mGM(a=t.lsd())&&(n.hubTypeCanvas=a.first),t.mGM(a=t.lsd())&&(n.demandOrderCanvas=a.first),t.mGM(a=t.lsd())&&(n.demandSummaryCanvas=a.first),t.mGM(a=t.lsd())&&(n.demandPickupTimeCanvas=a.first),t.mGM(a=t.lsd())&&(n.demandDeliveryTimeCanvas=a.first),t.mGM(a=t.lsd())&&(n.hubMap=a.first)}},inputs:{datasetIdInput:"datasetIdInput",embedded:"embedded"},decls:5,vars:7,consts:[["demandSummaryCanvas",""],["demandPickupTimeCanvas",""],["demandDeliveryTimeCanvas",""],["demandOrderCanvas",""],["truckTypeCanvas",""],["truckSupplierCanvas",""],["hubRegionCanvas",""],["hubTypeCanvas",""],["class","flex items-center justify-center py-16",4,"ngIf"],["class","bg-red-50 border border-red-200 rounded-lg p-6 text-center",4,"ngIf"],["class","space-y-8",4,"ngIf"],[1,"flex","items-center","justify-center","py-16"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-orange-500"],[1,"ml-2","text-gray-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6","text-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-3","text-red-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-semibold","text-red-800","mb-2"],[1,"text-red-700"],[1,"space-y-8"],["class","space-y-6",4,"ngIf"],["class","bg-white border border-gray-200 rounded-lg shadow-sm p-4 sm:p-6",4,"ngIf"],[1,"space-y-6"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","xl:grid-cols-5","2xl:grid-cols-6","gap-4","lg:gap-6"],[1,"bg-gradient-to-br","from-green-500","to-green-600","text-white","p-6","rounded-lg","shadow-lg"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-semibold","opacity-90"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"text-3xl","font-bold"],[1,"text-xs","opacity-75","mt-1"],[1,"bg-gradient-to-br","from-blue-500","to-blue-600","text-white","p-6","rounded-lg","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"],[1,"bg-gradient-to-br","from-purple-500","to-purple-600","text-white","p-6","rounded-lg","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"],[1,"bg-gradient-to-br","from-orange-500","to-orange-600","text-white","p-6","rounded-lg","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-3","gap-4","lg:gap-6","mb-6"],[1,"bg-white","border","border-green-200","rounded-lg","shadow-sm","p-5"],[1,"text-sm","font-semibold","text-green-600","mb-3"],["height","200"],[1,"bg-white","border","border-green-200","rounded-lg","shadow-sm","overflow-hidden"],[1,"px-6","py-4","bg-gradient-to-r","from-green-50","to-green-100","border-b","border-green-200"],[1,"font-semibold","text-gray-900"],[1,"p-5"],["height","100"],[1,"bg-white","border","border-green-200","rounded-lg","shadow-sm"],[1,"flex","items-center","justify-between"],[1,"text-xs","text-gray-600"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["class","px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",4,"ngFor","ngForOf"],[1,"bg-white","divide-y","divide-gray-200"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"px-3","sm:px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[3,"ngClass"],["class","px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900",4,"ngFor","ngForOf"],[1,"px-3","sm:px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"grid","grid-cols-1","lg:grid-cols-2","xl:grid-cols-3","gap-4","lg:gap-6"],[1,"bg-white","border","border-orange-200","rounded-lg","shadow-sm","p-6"],[1,"text-lg","font-semibold","text-orange-600","mb-4"],[1,"relative",2,"height","300px"],[1,"bg-white","border","border-orange-200","rounded-lg","shadow-sm","overflow-hidden"],[1,"px-6","py-4","bg-gradient-to-r","from-orange-50","to-orange-100","border-b","border-orange-200"],[1,"min-w-full","divide-y","divide-orange-200"],[1,"bg-orange-50"],[1,"px-3","sm:px-6","py-3","text-left","text-xs","font-medium","text-orange-700","uppercase","tracking-wider"],[1,"px-3","sm:px-6","py-3","text-right","text-xs","font-medium","text-orange-700","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-orange-100"],[1,"px-3","sm:px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"px-3","sm:px-6","py-4","whitespace-nowrap","text-sm","text-right","font-medium","text-gray-900"],[1,"px-3","sm:px-6","py-4","whitespace-nowrap","text-sm","text-right","text-gray-900"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 14l-7 7m0 0l-7-7m7 7V3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"],[1,"px-3","sm:px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","text-center"],[1,"px-3","sm:px-6","py-4","whitespace-nowrap","text-sm","text-gray-900","font-mono"],[1,"bg-white","border","border-gray-200","rounded-lg","shadow-sm","p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"bg-white","border","border-gray-200","rounded-lg","shadow-sm","p-4","sm:p-6"],[1,"text-sm","font-mono","bg-gray-50","p-3","sm:p-4","rounded-lg","overflow-auto","border","border-gray-200",2,"max-height","400px"]],template:function(i,n){1&i&&(t.j41(0,"div")(1,"div"),t.DNE(2,L,4,0,"div",8)(3,P,7,1,"div",9)(4,q,6,5,"div",10),t.k0s()()),2&i&&(t.HbH(n.embedded?"h-full bg-white":"min-h-screen bg-gray-50"),t.R7$(),t.HbH(n.embedded?"w-full p-4":"w-full px-4 sm:px-6 lg:px-8 xl:px-12 py-8"),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(),t.Y8G("ngIf",n.error&&!n.loading),t.R7$(),t.Y8G("ngIf",n.dataset&&!n.loading))},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.TG,g.QX,v.YN,k.tm,C.Dw,y.KQ,E.Ph,F.um,_.py,T.bG,x.Fr],styles:["#hub-map[_ngcontent-%COMP%]{height:450px;width:100%;border-radius:8px;border:1px solid #e5e7eb;position:relative;z-index:1}#hub-map[_ngcontent-%COMP%]   .leaflet-container[_ngcontent-%COMP%]{border-radius:8px;z-index:1}#hub-map[_ngcontent-%COMP%]   .leaflet-tile-pane[_ngcontent-%COMP%]{z-index:2}#hub-map[_ngcontent-%COMP%]   .leaflet-overlay-pane[_ngcontent-%COMP%]{z-index:4}#hub-map[_ngcontent-%COMP%]   .leaflet-marker-pane[_ngcontent-%COMP%]{z-index:5}#hub-map[_ngcontent-%COMP%]   .leaflet-popup-pane[_ngcontent-%COMP%]{z-index:6}#hub-map[_ngcontent-%COMP%]   .leaflet-control-container[_ngcontent-%COMP%]{z-index:7}.leaflet-container[_ngcontent-%COMP%]{border-radius:8px}.leaflet-popup-content-wrapper[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 10px 25px #0000001a}.leaflet-popup-tip[_ngcontent-%COMP%]{background-color:#fff}.hub-search-dialog[_ngcontent-%COMP%]{max-height:90vh;overflow-y:auto}.selected-hubs-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.selected-hubs-list[_ngcontent-%COMP%]   .hub-item[_ngcontent-%COMP%]{transition:background-color .2s ease}.selected-hubs-list[_ngcontent-%COMP%]   .hub-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb}@media (max-width: 768px){#hub-map[_ngcontent-%COMP%]{height:350px}.hub-search-dialog[_ngcontent-%COMP%]{margin:1rem;max-height:95vh}}"]})}return o})()}}]);