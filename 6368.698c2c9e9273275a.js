"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[5315,6368,7696],{2215:(G,M,h)=>{h.d(M,{G:()=>A});var S=h(7643),j=h(8810),k=h(6354),t=h(9437),D=h(1360),b=h(4412),I=h(1985);let B=(()=>{class w{configs={local:{environment:"local",host:"http://localhost:8081",name:"Local Development"},production:{environment:"production",host:"https://test-api.routing-deviation.ghn.tech",name:"Production API"}};currentConfigSubject=new b.t(this.configs.local);currentConfig$=this.currentConfigSubject.asObservable();constructor(){this.loadSavedConfig()}getCurrentConfig(){return this.currentConfigSubject.value}getHost(){return this.getCurrentConfig().host}getEnvironment(){return this.getCurrentConfig().environment}switchEnvironment(u){const l=this.configs[u];l&&(this.currentConfigSubject.next(l),this.saveConfig(l),console.log(`[API Config] Switched to ${l.name} (${l.host})`))}getAvailableConfigs(){return Object.values(this.configs)}isLocal(){return"local"===this.getEnvironment()}isProduction(){return"production"===this.getEnvironment()}testConnection(){const u=this.getHost(),l=`${u}/_`;return new I.c(f=>{fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}).then(g=>{f.next(g.ok?{success:!0,host:u}:{success:!1,host:u,status:g.status}),f.complete()}).catch(g=>{f.next({success:!1,host:u,error:g.message}),f.complete()})})}loadSavedConfig(){try{if(typeof window<"u"&&window.localStorage){const u=localStorage.getItem("api-config");if(u){const l=JSON.parse(u);l.environment&&this.configs[l.environment]&&this.currentConfigSubject.next(this.configs[l.environment])}}}catch(u){console.warn("[API Config] Failed to load saved config:",u)}}saveConfig(u){try{typeof window<"u"&&window.localStorage&&localStorage.setItem("api-config",JSON.stringify({environment:u.environment}))}catch(l){console.warn("[API Config] Failed to save config:",l)}}static \u0275fac=function(l){return new(l||w)};static \u0275prov=D.jDH({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})(),A=(()=>{class w{http;apiConfig;defaultTimeout=3e4;authToken="ZCXb4Thq56HgXlQC4IKS4EcghaYt6xxmIoHdazBJgVBRAwYqbLhx9rE3QTuzIqpo";constructor(u,l){this.http=u,this.apiConfig=l}getAuthHeaders(){const u={"Content-Type":"application/json"},l=this.authToken;return l&&(u.Authorization=`Bearer ${l}`),new S.Lr(u)}getHost(){return this.apiConfig.getHost()}getUrl(u){return this.getHost()+(u.startsWith("/")?u:"/"+u)}handleError(u){let l;return l=typeof ErrorEvent<"u"&&u.error instanceof ErrorEvent?{status:0,message:"Network error",error:"NETWORK_ERROR"}:{status:u.status,message:u.error?.message||u.message||"Server error",error:u.error?.error||"SERVER_ERROR",data:u.error},console.error("[API Error]",l),(0,j.$)(()=>l)}transformResponse(u){return{ok:!0,status:200,data:u,message:"Success"}}get(u,l){const f=this.getUrl(u);let g=new S.Nl;return l&&Object.keys(l).forEach(T=>{null!=l[T]&&(g=g.set(T,l[T].toString()))}),console.log(`[API] GET ${f}`,l),this.http.get(f,{params:g,headers:this.getAuthHeaders()}).pipe((0,k.T)(T=>this.transformResponse(T)),(0,t.W)(T=>this.handleError(T)))}post(u,l){const f=this.getUrl(u);return console.log(`[API] POST ${f}`,l),this.http.post(f,l,{headers:this.getAuthHeaders()}).pipe((0,k.T)(g=>this.transformResponse(g)),(0,t.W)(g=>this.handleError(g)))}put(u,l){const f=this.getUrl(u);return console.log(`[API] PUT ${f}`,l),this.http.put(f,l,{headers:this.getAuthHeaders()}).pipe((0,k.T)(g=>this.transformResponse(g)),(0,t.W)(g=>this.handleError(g)))}delete(u,l){const f=this.getUrl(u);return console.log(`[API] DELETE ${f}`,l),this.http.delete(f,{headers:this.getAuthHeaders(),body:l}).pipe((0,k.T)(g=>this.transformResponse(g)),(0,t.W)(g=>this.handleError(g)))}patch(u,l){const f=this.getUrl(u);return console.log(`[API] PATCH ${f}`,l),this.http.patch(f,l,{headers:this.getAuthHeaders()}).pipe((0,k.T)(g=>this.transformResponse(g)),(0,t.W)(g=>this.handleError(g)))}upload(u,l){const f=this.getUrl(u);console.log(`[API] UPLOAD ${f}`);const g={},T=this.authToken;return T&&(g.Authorization=`Bearer ${T}`),this.http.post(f,l,{headers:new S.Lr(g)}).pipe((0,k.T)(N=>this.transformResponse(N)),(0,t.W)(N=>this.handleError(N)))}static \u0275fac=function(l){return new(l||w)(D.KVO(S.Qq),D.KVO(B))};static \u0275prov=D.jDH({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()},5315:(G,M,h)=>{h.d(M,{J:()=>k});var S=h(1360),j=h(2215);let k=(()=>{class t{api;constructor(b){this.api=b}getPlan(b){return this.api.post("/routing-deviation/internal/get",{plan_id:b})}getPlans(b){return this.api.post("/routing-deviation/internal/plans",b||{})}createPlan(b){return this.api.post("/routing-deviation/internal/plans",b)}uploadPlan(b){return this.api.upload("/routing-deviation/internal/import",b)}deletePlan(b){return this.api.post("/routing-deviation/internal/delete",{plan_id:b})}predictPlan(b,I){const B=I?new URLSearchParams(I).toString():"";return this.api.post(`/api/v1/route-deviation/plan/${b}/predict${B?"?"+B:""}`,null)}static \u0275fac=function(I){return new(I||t)(S.KVO(j.G))};static \u0275prov=S.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},6368:(G,M,h)=>{h.r(M),h.d(M,{TripSimulationComponent:()=>nt});var S=h(467),j=h(2881),k=h(9417),t=h(1360),D=h(1910),b=h(5315),I=h(9350),B=h(7707),w=h(7643),z=h(8810),u=h(6354),l=h(9437);let f=(()=>{class s{http;apiBase="http://localhost:8081";defaultToken="ZCXb4Thq56HgXlQC4IKS4EcghaYt6xxmIoHdazBJgVBRAwYqbLhx9rE3QTuzIqpo";constructor(e){this.http=e}runSimulation(e){const r=`${this.apiBase}/routing-deviation/internal/plan/predict`,n=this.getAuthToken(),o=new w.Lr({"Content-Type":"application/json",Authorization:n.startsWith("Bearer")?n:`Bearer ${n}`});return this.http.post(r,e,{headers:o}).pipe((0,u.T)(i=>i.data||i),(0,l.W)(i=>(console.error("[SimulationService] API error:",i),(0,z.$)(()=>i))))}getAuthToken(){try{return window.__AUTH_TOKEN__||window.API_TOKEN||localStorage.getItem("token")||localStorage.getItem("auth_token")||localStorage.getItem("access_token")||this.defaultToken}catch{return this.defaultToken}}static \u0275fac=function(r){return new(r||s)(t.KVO(w.Qq))};static \u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),g=(()=>{class s{convertPredictResponseToPlan(e){const r=[];return!e||!e.schedule||Object.keys(e.schedule).forEach(n=>{const o=e.schedule[n];if(!o)return;const i=Array.isArray(o.vehicle_trips)?o.vehicle_trips:[],a=new Map;i.forEach(c=>{const _=c.shift_name||"Unknown";a.has(_)||a.set(_,[]);const x=this.convertStopsToDemands(c.stops,c),y=x.reduce((C,R)=>C+(R.pickup_weight_kg||0),0),m=x.reduce((C,R)=>C+(R.delivery_weight_kg||0),0),v={vehicle_id:c.vehicle_id||"unknown",number_plate:c.number_plate||null,vehicle_payload_capacity_kg:c.vehicle_payload_capacity_kg||null,total_distance_km:null!=c.total_distance_km?c.total_distance_km:0,total_delivery_weight_kg:m,total_pickup_weight_kg:y,shift_start_time:c.stops&&c.stops.length>0&&c.stops[0].planned_checkin_time?c.stops[0].planned_checkin_time:null,ontime_rate_percent:c.ontime_rate_percent??c.ontime_rate??null,drop_rate_percent:c.drop_rate_percent??c.drop_rate??null,fill_rate_percent:c.fill_rate_percent??c.fill_rate??null,demands:x,total_stops:x.length};a.get(_).push(v)});const d=Array.from(a.entries()).map(([c,_])=>({shift_name:c,vehicles:_}));r.push({date:n,plan:{id:o.plan_id||e.id||"",shifts:d,meta:{date:n,source:"predict"}}})}),r}convertStopsToDemands(e,r){return Array.isArray(e)?e.map((n,o)=>{const i=n.original_stop_name||n.stop_name||n.name||`Stop ${o+1}`,a=null!=n.pickup_weight_kg?n.pickup_weight_kg:null!=n.planned_pickup_weight_kg?n.planned_pickup_weight_kg:0,d=null!=n.delivery_weight_kg?n.delivery_weight_kg:null!=n.planned_delivery_weight_kg?n.planned_delivery_weight_kg:0;return{...n,stt:n.original_stt||n.stt||n.sequence||o+1,stop_name:i,stop_type:n.stop_type||(a>0?"\u0110i\u1ec3m l\u1ea5y":"\u0110i\u1ec3m giao"),expected_checkin_time:n.planned_checkin_time||n.expected_checkin_time||null,expected_checkout_time:n.planned_checkout_time||n.expected_checkout_time||null,checkin_time:n.check_in||n.checkin_time||null,checkout_time:n.check_out||n.checkout_time||null,actual_checkin_time:n.actual_checkin_time||null,actual_checkout_time:n.actual_checkout_time||null,processing_time:n.serve_time||n.processing_time||null,transit_time:n.transit_time||null,distance_km:null!=n.planned_distance_km?n.planned_distance_km:n.distance_km||0,pickup_weight_kg:a,delivery_weight_kg:d,loaded_weight_kg:null!=n.load_on_truck?n.load_on_truck:a+d,vehicle_payload_capacity_kg:r.vehicle_payload_capacity_kg||null,average_speed:n.speed_kmh||n.average_speed||null,drop_rate:null!=n.drop_rate_percent?n.drop_rate_percent:n.drop_rate||null,ontime_rate:null!=n.ontime_rate_percent?n.ontime_rate_percent:null!=n.is_ontime?n.is_ontime?100:0:n.ontime_rate||null,fill_rate:null!=n.fill_rate_percent?n.fill_rate_percent:n.fill_rate||null,extra:n.extra||{}}}):[]}static \u0275fac=function(r){return new(r||s)};static \u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),T=(()=>{class s{renderTable(e,r="simulation-table-body-2"){console.log("[ForecastTableRenderer] ===== ENTRY ====="),console.log("[ForecastTableRenderer] Called with data:",e),console.log("[ForecastTableRenderer] Looking for tbody:",r);let n=document.getElementById(r);if(n||(n=document.querySelector(`#${r}`)),!n){const o=document.querySelectorAll("tbody");Array.from(o).forEach(i=>{!n&&(i.id===r||i.id.includes("simulation"))&&(n=i,console.log("[ForecastTableRenderer] Found tbody via querySelectorAll with ID:",i.id))})}if(!n||"TBODY"!==n.tagName)return console.error("[ForecastTableRenderer] ERROR: tbody element not found:",r),console.log('[ForecastTableRenderer] Available elements with "simulation" in ID:',Array.from(document.querySelectorAll('[id*="simulation"]')).map(o=>({id:o.id,tagName:o.tagName}))),console.log("[ForecastTableRenderer] All tbody elements:",Array.from(document.querySelectorAll("tbody")).map(o=>({id:o.id,className:o.className}))),void setTimeout(()=>{const o=document.getElementById(r);o&&"TBODY"===o.tagName?(console.log("[ForecastTableRenderer] Found tbody on retry after delay"),this.renderTableInternal(e,o)):console.error("[ForecastTableRenderer] Still not found after retry")},200);console.log("[ForecastTableRenderer] Found tbody element"),this.renderTableInternal(e,n)}renderTableInternal(e,r){window._routeDataCache||(window._routeDataCache={});const n=[];if(!e)return void(r.innerHTML='<tr><td colspan="11" class="px-6 py-8 text-left text-sm text-gray-500">Kh\xf4ng c\xf3 d\u1eef li\u1ec7u d\u1ef1 b\xe1o</td></tr>');if(Array.isArray(e)?e.forEach(d=>{d&&d.date&&d.plan?n.push(d):d&&d.shifts&&n.push({date:d.meta?.date||null,plan:d})}):e&&e.shifts?n.push({date:e.meta?.date||null,plan:e}):e.date&&e.plan&&n.push(e),console.log("[ForecastTableRenderer] Normalized items:",n.length),0===n.length)return void(r.innerHTML='<tr><td colspan="11" class="px-6 py-8 text-left text-sm text-gray-500">Kh\xf4ng c\xf3 d\u1eef li\u1ec7u d\u1ef1 b\xe1o</td></tr>');const o=this.buildTripsFromPlanItems(n);if(console.log("[ForecastTableRenderer] Built",o.length,"trips total"),0===o.length)return void(r.innerHTML='<tr><td colspan="11" class="px-6 py-8 text-left text-sm text-gray-500">D\u1eef li\u1ec7u d\u1ef1 b\xe1o r\u1ed7ng</td></tr>');const i=this.renderTableHTML(o);r.innerHTML=i;const a=r.querySelectorAll("tr").length;console.log("[ForecastTableRenderer] Table rendered with",a,"rows"),this.attachVisualizationListeners()}buildTripsFromPlanItems(e){const r=[];return e.forEach(n=>{const o=n.date?new Date(n.date):new Date,i=this.formatDate(o);!n.plan||!Array.isArray(n.plan.shifts)||n.plan.shifts.forEach(a=>{const d=a.shift_name||"";(Array.isArray(a.vehicles)?a.vehicles:[]).forEach(c=>{const _=c.vehicle_id||"N/A",x=Array.isArray(c.demands)?c.demands.map((F,P)=>({...F,stt:F.stt||F.original_stt||P+1,stop_name:F.stop_name||F.original_stop_name||`Stop ${P+1}`,stop_type:F.stop_type||(F.pickup_weight_kg>0?"\u0110i\u1ec3m l\u1ea5y":"\u0110i\u1ec3m giao")})):[],y=x[0]||{},m=y.vehicle_payload_capacity_kg||c.vehicle_payload_capacity_kg||0,C=null!=c.total_pickup_weight_kg?c.total_pickup_weight_kg:0,R=Number(null!=c.total_delivery_weight_kg?c.total_delivery_weight_kg:0)+Number(C)||0,H=m>0?Math.min(100,Math.round(R/m*100)):0,$=F=>{if(null==F)return null;const P=Number(F);return Number.isNaN(P)?null:Math.abs(P)<=1?100*P:P},L=$(c.ontime_rate_percent??c.ontime_rate??(!0===c.ontime?100:!1===c.ontime?0:null)),V=$(c.drop_rate_percent??c.drop_rate??null),O=$(c.fill_rate_percent??c.fill_rate??null)??H;r.push({date:i,shift:d,vehicle:_,demands:x,truckCapacity:m,ontimeRate:L,dropRate:V,fillRate:O,route:x.length>1?`${y.stop_name} \u2192 ${x[x.length-1].stop_name}`:y.stop_name||""})})})}),r}renderTableHTML(e){const r={};e.forEach(i=>{const a=i.date||"N/A",d=i.shift||"Unknown",p=i.vehicle||"N/A";r[a]||(r[a]={}),r[a][d]||(r[a][d]={}),r[a][d][p]||(r[a][d][p]=[]),r[a][d][p].push(i)});let n="";return Object.keys(r).sort().forEach(i=>{const a=r[i];let d=0;Object.keys(a).forEach(_=>{const x=a[_];Object.keys(x).forEach(y=>{const m=x[y][0];d+=m.demands.length>0?m.demands.length:1})});let p=!0;Object.keys(a).sort().forEach(_=>{const x=a[_];let y=0;Object.keys(x).forEach(C=>{const R=x[C][0];y+=R.demands.length>0?R.demands.length:1});let m=!0;Object.keys(x).sort().forEach(C=>{const H=x[C][0],$=H.demands||[];0===$.length?(n+=this.renderEmptyVehicleRow(i,_,C,p,m,d,y),p&&(p=!1),m&&(m=!1)):$.forEach((L,V)=>{n+=this.renderDemandRow(H,L,V,i,_,C,p,m,d,y,V===$.length-1,0===V),p&&(p=!1),m&&(m=!1)})})})}),n}renderEmptyVehicleRow(e,r,n,o,i,a,d){let p='<tr class="hover:bg-blue-50 border-b border-gray-200">';return o&&(p+=`<td rowspan="${a}" class="px-3 py-2 text-sm font-semibold text-gray-900 bg-gray-50 border-r border-gray-300 align-top">${this.escapeHtml(e)}</td>`),i&&(p+=`<td rowspan="${d}" class="px-3 py-2 text-sm font-medium text-gray-800 bg-blue-50 border-r border-gray-300 align-top">${this.escapeHtml(r)}</td>`),p+=`<td class="px-2 py-2 text-sm font-mono text-blue-700 font-semibold border-r-2 border-gray-400 align-top">${this.escapeHtml(n)}</td>`,p+='<td class="px-2 py-2 text-sm text-gray-400 text-left align-top" colspan="8">Kh\xf4ng c\xf3 d\u1eef li\u1ec7u \u0111i\u1ec3m d\u1eebng</td>',p+="</tr>",p}renderDemandRow(e,r,n,o,i,a,d,p,c,_,x,y){let v=`<tr class="hover:bg-blue-50 ${x?"border-b-2 border-gray-400":"border-b border-gray-100"}">`;return d&&(v+=`<td rowspan="${c}" class="px-3 py-2 text-sm font-semibold text-gray-900 bg-gray-50 border-r border-gray-300 align-top">${this.escapeHtml(o)}</td>`),p&&(v+=`<td rowspan="${_}" class="px-3 py-2 text-sm font-medium text-gray-800 bg-blue-50 border-r border-gray-300 align-top">${this.escapeHtml(i)}</td>`),y&&(v+=this.renderVehicleColumn(e,o,i,a)),v+=`<td class="px-2 py-2 text-sm text-center text-gray-700 border-r border-gray-200 bg-gray-50" style="min-width: 50px; max-width: 50px;">\n      <span class="font-bold text-blue-600 text-base">${r.stt||n+1}</span>\n    </td>`,v+=this.renderStopNameColumn(r,e),v+=this.renderCheckinColumn(r),v+=this.renderCheckoutColumn(r),v+=this.renderVolumeColumn(r),v+=this.renderDropRateColumn(r),v+=this.renderFillRateColumn(r),v+=this.renderProcessingTimeColumn(r),v+="</tr>",v}renderVehicleColumn(e,r,n,o){const i=null!==e.ontimeRate?(Math.round(100*e.ontimeRate)/100).toFixed(2)+"%":"\u2014",a=null!==e.dropRate?(Math.round(100*e.dropRate)/100).toFixed(2)+"%":"\u2014",d=null!==e.fillRate?(Math.round(100*e.fillRate)/100).toFixed(2)+"%":"\u2014",p=null!==e.ontimeRate?e.ontimeRate>=90?"text-emerald-600":e.ontimeRate>=75?"text-orange-600":"text-red-600":"text-gray-500",c=null!==e.dropRate?e.dropRate<=5?"text-emerald-600":e.dropRate<=10?"text-orange-600":"text-red-600":"text-gray-500",_=null!==e.fillRate?e.fillRate>=80?"text-emerald-600":e.fillRate>=60?"text-orange-600":"text-red-600":"text-gray-500",x=`route_${r}_${n}_${o}`.replace(/[^a-zA-Z0-9_]/g,"_"),y={vehicle_code:o,date:r,shift:n,vehicle_type:e.truckCapacity?(e.truckCapacity/1e3).toFixed(1)+"T":"-",stops:e.demands.map(m=>({stt:m.stt,stop_name:m.stop_name,stop_type:m.stop_type,distance_km:m.distance_km,average_speed:m.average_speed,expected_checkin_time:m.expected_checkin_time,checkin_time:m.checkin_time,expected_checkout_time:m.expected_checkout_time,checkout_time:m.checkout_time,pickup_weight_kg:m.pickup_weight_kg,delivery_weight_kg:m.delivery_weight_kg,loaded_weight_kg:m.loaded_weight_kg,drop_rate:m.drop_rate_percent??m.drop_rate??null,ontime_rate:m.ontime_rate,fill_rate:m.fill_rate}))};return window._routeDataCache[x]=y,`<td rowspan="${e.demands.length}" class="px-3 py-3 border-r-2 border-gray-400 align-top bg-gradient-to-br from-orange-50 to-amber-50" style="min-width: 220px;">\n      <div class="space-y-2">\n        <div class="flex items-center gap-2 pb-2 border-b border-orange-200">\n          <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />\n          </svg>\n          <span class="font-bold text-base text-orange-900">${this.escapeHtml(o)}</span>\n        </div>\n        <div class="grid grid-cols-1 gap-1.5 text-sm">\n          <div class="flex items-center justify-between px-2 py-1 bg-white rounded shadow-sm border border-orange-100">\n            <span class="text-gray-600 font-medium text-xs">\u{1f69b} Lo\u1ea1i xe:</span>\n            <span class="font-bold text-orange-700">${e.truckCapacity.toLocaleString()} Kg</span>\n          </div>\n          <div class="flex items-center justify-between px-2 py-1 bg-white rounded shadow-sm border border-orange-100">\n            <span class="text-gray-600 font-medium text-xs">\u23f1\ufe0f On-time:</span>\n            <span class="font-bold ${p}">${i}</span>\n          </div>\n          <div class="flex items-center justify-between px-2 py-1 bg-white rounded shadow-sm border border-orange-100">\n            <span class="text-gray-600 font-medium text-xs">\u{1f4c9} R\u1edbt h\xe0ng:</span>\n            <span class="font-bold ${c}">${a}</span>\n          </div>\n          <div class="flex items-center justify-between px-2 py-1 bg-white rounded shadow-sm border border-orange-100">\n            <span class="text-gray-600 font-medium text-xs">\u{1f4e6} L\u1ea5p \u0111\u1ea7y:</span>\n            <span class="font-bold ${_}">${d}</span>\n          </div>\n        </div>\n        <button \n          data-route-key="${x}"\n          class="btn-eval-visualize w-full mt-2 px-3 py-2 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white text-sm font-semibold rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2"\n          title="M\xf4 ph\u1ecfng">\n          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />\n          </svg>\n          <span>M\xf4 ph\u1ecfng</span>\n        </button>\n      </div>\n    </td>`}renderStopNameColumn(e,r){const n=(e.stop_type||"").toLowerCase(),o=n.includes("l\u1ea5y")||n.includes("pickup"),i=o?"\u{1f4e5}":"\u{1f4e6}",a=o?"bg-emerald-50":"bg-blue-50",d=o?"text-emerald-700":"text-blue-700",p=e.distance_km||0,c=e.average_speed||0,x=e.transit_time,y=null!=x?x/3600:null,m=null!=y?(Math.ceil(100*y)/100).toFixed(2)+" h":"\u2014";return`<td class="px-2 py-2 text-sm ${a} border-r border-gray-200" style="min-width: 180px; max-width: 180px;">\n      <div class="space-y-1">\n        <div class="flex items-center gap-1">\n          <span class="text-lg">${i}</span>\n          <span class="font-semibold ${d} truncate text-sm">${this.escapeHtml(e.stop_name||"\u2014")}</span>\n        </div>\n        <div class="flex items-center justify-between text-xs text-gray-600">\n          <span>\u{1f4cd} ${p>0?p.toFixed(1):"\u2014"} km</span>\n          <span>\u{1f697} ${c>0?c.toFixed(1):"\u2014"} km/h</span>\n        </div>\n        <div class="flex items-center justify-center text-xs text-gray-500">\n          <span>\u23f1 ${m}</span>\n        </div>\n      </div>\n    </td>`}renderCheckinColumn(e){const r=e.expected_checkin_time,n=e.checkin_time,o=n&&r?n-r:null;return`<td class="px-2 py-2 text-sm bg-purple-50 border-r border-gray-200" style="min-width: 150px;">\n      <div class="space-y-0.5">\n        <div class="text-orange-600 text-sm">K\u1ebf ho\u1ea1ch: ${this.formatTime(r)}</div>\n        <div class="font-bold ${o?Math.abs(o/60)<=5||o<0?"text-emerald-600":"text-red-600":"text-gray-600"} text-sm">Th\u1ef1c t\u1ebf: ${this.formatTime(n)}</div>\n        <div class="mt-1">${(()=>{if(!o)return"";const d=Math.round(o/60);return Math.abs(d)<=5?'<span class="text-emerald-600 text-sm font-semibold">\u2713 \u0110\xfang gi\u1edd</span>':o<0?`<span class="text-emerald-600 text-sm font-semibold">\u2191 S\u1edbm ${Math.abs(d)}p</span>`:`<span class="text-red-600 text-sm font-semibold">\u2193 Tr\u1ec5 ${d}p</span>`})()}</div>\n      </div>\n    </td>`}renderCheckoutColumn(e){const r=e.expected_checkout_time,n=e.checkout_time,o=n&&r?n-r:null;return`<td class="px-2 py-2 text-sm bg-purple-50 border-r border-gray-200" style="min-width: 150px;">\n      <div class="space-y-0.5">\n        <div class="text-orange-600 text-sm">K\u1ebf ho\u1ea1ch: ${this.formatTime(r)}</div>\n        <div class="font-bold ${o?Math.abs(o/60)<=5||o<0?"text-emerald-600":"text-red-600":"text-gray-600"} text-sm">Th\u1ef1c t\u1ebf: ${this.formatTime(n)}</div>\n        <div class="mt-1">${(()=>{if(!o)return"";const d=Math.round(o/60);return Math.abs(d)<=5?'<span class="text-emerald-600 text-sm font-semibold">\u2713 \u0110\xfang gi\u1edd</span>':o<0?`<span class="text-emerald-600 text-sm font-semibold">\u2191 S\u1edbm ${Math.abs(d)}p</span>`:`<span class="text-red-600 text-sm font-semibold">\u2193 Tr\u1ec5 ${d}p</span>`})()}</div>\n      </div>\n    </td>`}renderVolumeColumn(e){const r=e.pickup_weight_kg||0,n=e.delivery_weight_kg||0,o=e.load_on_truck||e.loaded_weight_kg||0,i=r+n,a=null!=e.throughput_rate?Math.ceil(100*e.throughput_rate)/100:null;return`<td class="px-2 py-2 text-sm bg-blue-50 border-r border-gray-200" style="min-width: 180px;">\n      <div class="space-y-1.5">\n        <div class="flex items-center justify-between">\n          <span class="text-gray-600 text-xs">\u{1f4e5} L\u1ea5y:</span>\n          <span class="font-semibold text-emerald-700 text-sm">${r.toLocaleString()} kg</span>\n        </div>\n        <div class="flex items-center justify-between">\n          <span class="text-gray-600 text-xs">\u{1f4e6} Giao:</span>\n          <span class="font-semibold text-blue-700 text-sm">${n.toLocaleString()} kg</span>\n        </div>\n        <div class="flex items-center justify-between pt-1 border-t-2 border-blue-300">\n          <span class="text-gray-800 font-bold text-xs">\u{1f4ca} T\u1ed5ng:</span>\n          <span class="font-extrabold text-blue-900 text-2xl">${i.toLocaleString()}</span>\n        </div>\n        <div class="flex items-center justify-between pt-1 border-t border-blue-200">\n          <span class="text-gray-700 font-semibold text-xs">\u{1f69b} Load:</span>\n          <span class="font-extrabold text-orange-700 text-2xl">${o.toLocaleString()}</span>\n        </div>\n        <div class="flex items-center justify-between px-2 py-1 bg-orange-100 rounded border border-orange-300 mt-1">\n          <span class="text-orange-800 font-semibold text-xs">\u{1f4c8} Th\xf4ng l\u01b0\u1ee3ng:</span>\n          <span class="font-bold text-orange-700 text-sm">${null!=a?a.toFixed(2):"\u2014"} kg/s</span>\n        </div>\n      </div>\n    </td>`}renderDropRateColumn(e){const r=null!=e.drop_rate_percent?e.drop_rate_percent:e.drop_rate||0;return`<td class="px-2 py-2 text-center ${r<=3?"bg-emerald-50":r<=7?"bg-orange-50":"bg-red-50"} border-r border-gray-200" style="min-width: 100px;">\n      <div class="space-y-1">\n        <div class="text-xs text-gray-600">\u{1f4c9} R\u1edbt h\xe0ng</div>\n        <div class="font-extrabold text-2xl ${r<=3?"text-emerald-700":r<=7?"text-orange-600":"text-red-700"}">${r.toFixed(1)}%</div>\n      </div>\n    </td>`}renderFillRateColumn(e){const r=null!=e.fill_rate?e.fill_rate:e.fill_rate_percent||0;return`<td class="px-2 py-2 text-center ${r>=80?"bg-emerald-50":r>=60?"bg-orange-50":r>=40?"bg-amber-50":"bg-red-50"} border-r border-gray-200" style="min-width: 100px;">\n      <div class="space-y-1">\n        <div class="text-xs text-gray-600">\u{1f4e6} L\u1ea5p \u0111\u1ea7y</div>\n        <div class="font-extrabold text-2xl ${r>=80?"text-emerald-700":r>=60?"text-orange-600":r>=40?"text-amber-600":"text-red-700"}">${r.toFixed(1)}%</div>\n      </div>\n    </td>`}renderProcessingTimeColumn(e){const r=e.planned_processing_time,n=e.serve_time,o=null!=r?(Math.ceil(r)/60).toFixed(2):null,i=null!=n?(Math.ceil(n)/60).toFixed(2):null,a=i&&o?parseFloat(i)<=parseFloat(o)?"text-emerald-700":"text-red-600":"text-orange-600";return`<td class="px-2 py-2 text-sm bg-amber-50 border-r border-gray-200" style="min-width: 150px;">\n      <div class="space-y-2">\n        <div class="flex items-center justify-between px-2 py-1.5 bg-white rounded border border-amber-200">\n          <span class="font-semibold text-gray-700 text-sm">\u23f1\ufe0f K\u1ebf ho\u1ea1ch:</span>\n          <span class="font-bold text-gray-800 text-base">${null!=o?o+" ph\xfat":"\u2014"}</span>\n        </div>\n        <div class="flex items-center justify-between px-2 py-1.5 bg-white rounded border-2" style="border-color: ${"text-emerald-700"===a?"#10b981":"text-red-600"===a?"#ef4444":"#f97316"};">\n          <span class="font-semibold text-gray-700 text-sm">\u26a1 Th\u1ef1c t\u1ebf:</span>\n          <span class="font-bold ${a} text-base">${null!=i?i+" ph\xfat":"\u2014"}</span>\n        </div>\n      </div>\n    </td>`}attachVisualizationListeners(){const e=document.querySelectorAll(".btn-eval-visualize");console.log("[ForecastTableRenderer] Attached listeners to",e.length,"visualization buttons")}formatTime(e){if(!e||"number"!=typeof e)return"\u2014";const r=Math.floor(e),n=Math.floor(r/3600),o=Math.floor(r%3600/60);return`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}formatDate(e){return e.toLocaleDateString("vi-VN")}escapeHtml(e){if(!e)return"";const r=document.createElement("div");return r.textContent=e,r.innerHTML}static \u0275fac=function(r){return new(r||s)};static \u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),N=(()=>{class s{forecastRenderer;constructor(e){this.forecastRenderer=e}renderTable(e,r,n){const o=n||r?.id||"simulation-table-body-2";if(e)console.log("[SimulationTableService] Using TypeScript ForecastTableRendererService"),this.forecastRenderer.renderTable(e,o);else{const i=r||document.getElementById(o);i&&(i.innerHTML='<tr><td colspan="11" class="px-6 py-8 text-left text-sm text-gray-500">Kh\xf4ng c\xf3 d\u1eef li\u1ec7u d\u1ef1 b\xe1o</td></tr>')}}renderSimpleTable(e,r){let n="";e.forEach(o=>{const i=o.date||"N/A";o.plan.shifts.forEach(a=>{a.vehicles.forEach(d=>{d.demands.forEach((p,c)=>{n+='<tr class="hover:bg-blue-50 border-b border-gray-200">',0===c&&(n+=`<td rowspan="${d.demands.length}" class="px-3 py-2 text-sm font-semibold text-gray-900">${i}</td>`,n+=`<td rowspan="${d.demands.length}" class="px-3 py-2 text-sm font-medium text-gray-800">${a.shift_name}</td>`,n+=`<td rowspan="${d.demands.length}" class="px-2 py-2 text-sm font-mono text-blue-700">${d.vehicle_id}</td>`),n+=`<td class="px-2 py-2 text-sm text-center">${p.stt||c+1}</td>`,n+=`<td class="px-2 py-2 text-sm">${p.stop_name||"\u2014"}</td>`,n+=`<td class="px-2 py-2 text-sm">${this.formatTime(p.expected_checkin_time)}</td>`,n+=`<td class="px-2 py-2 text-sm">${p.pickup_weight_kg||0} kg</td>`,n+=`<td class="px-2 py-2 text-sm">${p.delivery_weight_kg||0} kg</td>`,n+=`<td class="px-2 py-2 text-sm">${p.drop_rate||0}%</td>`,n+=`<td class="px-2 py-2 text-sm">${p.fill_rate||0}%</td>`,n+="</tr>"})})})}),r.innerHTML=""===n?'<tr><td colspan="15" class="px-6 py-8 text-left text-sm text-gray-500">D\u1eef li\u1ec7u d\u1ef1 b\xe1o r\u1ed7ng</td></tr>':n}formatTime(e){if(!e||"number"!=typeof e)return"\u2014";const r=Math.floor(e),n=Math.floor(r/3600),o=Math.floor(r%3600/60);return`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}static \u0275fac=function(r){return new(r||s)(t.KVO(T))};static \u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),U=(()=>{class s{injector;simulationService;converterService;tableService;static instance=null;constructor(e,r,n,o){this.injector=e,this.simulationService=r,this.converterService=n,this.tableService=o,s.instance=this}static getInstance(){return s.instance}runSimulation(e){var r=this;return(0,S.A)(function*(){try{const n=yield function A(s,E){const e="object"==typeof E;return new Promise((r,n)=>{const o=new B.Ms({next:i=>{r(i),o.unsubscribe()},error:n,complete:()=>{e?r(E.defaultValue):n(new I.G)}});s.subscribe(o)})}(r.simulationService.runSimulation(e));return r.converterService.convertPredictResponseToPlan(n)}catch(n){throw console.error("[SimulationRunnerService] Error running simulation:",n),n}})()}renderTable(e,r="simulation-table-body-2"){this.tableService.renderTable(e,null,r)}runSimulationAndRender(e){var r=this;return(0,S.A)(function*(n,o="simulation-table-body-2"){try{const i=yield r.runSimulation(n);r.renderTable(i,o)}catch(i){console.error("[SimulationRunnerService] Error in runSimulationAndRender:",i);const a=document.getElementById(o);throw a&&(a.innerHTML=`<tr><td colspan="15" class="px-6 py-8 text-left text-sm text-red-600">\n          L\u1ed7i khi ch\u1ea1y m\xf4 ph\u1ecfng: ${i instanceof Error?i.message:String(i)}\n        </td></tr>`),i}}).apply(this,arguments)}convertResponseToPlan(e){return this.converterService.convertPredictResponseToPlan(e)}static \u0275fac=function(r){return new(r||s)(t.KVO(t.zZn),t.KVO(f),t.KVO(g),t.KVO(N))};static \u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const K=["tableBody"];function X(s,E){if(1&s&&(t.j41(0,"span",41)(1,"span",42),t.EFF(2,"\u{1f4cb}"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Cho l\u1ecbch t\u1ea3i: "),t.k0s(),t.j41(5,"span",43),t.EFF(6),t.k0s()()),2&s){const e=t.XpG();t.R7$(6),t.JRh(e.planName)}}function Y(s,E){1&s&&(t.qSk(),t.j41(0,"svg",9),t.nrm(1,"path",44),t.k0s())}function W(s,E){1&s&&t.nrm(0,"div",45)}function J(s,E){if(1&s){const e=t.RV6();t.j41(0,"div",46)(1,"div",47)(2,"div")(3,"label",17),t.EFF(4,"Model ID"),t.k0s(),t.j41(5,"input",48),t.mxI("ngModelChange",function(n){t.eBV(e);const o=t.XpG();return t.DH7(o.modelId,n)||(o.modelId=n),t.Njj(n)}),t.k0s()(),t.j41(6,"div",4)(7,"label",22)(8,"input",23),t.mxI("ngModelChange",function(n){t.eBV(e);const o=t.XpG();return t.DH7(o.weather,n)||(o.weather=n),t.Njj(n)}),t.k0s(),t.j41(9,"span"),t.EFF(10,"Th\u1eddi ti\u1ebft"),t.k0s()(),t.j41(11,"label",22)(12,"input",23),t.mxI("ngModelChange",function(n){t.eBV(e);const o=t.XpG();return t.DH7(o.traffic,n)||(o.traffic=n),t.Njj(n)}),t.k0s(),t.j41(13,"span"),t.EFF(14,"Giao th\xf4ng"),t.k0s()(),t.j41(15,"label",22)(16,"input",23),t.mxI("ngModelChange",function(n){t.eBV(e);const o=t.XpG();return t.DH7(o.events,n)||(o.events=n),t.Njj(n)}),t.k0s(),t.j41(17,"span"),t.EFF(18,"S\u1ef1 ki\u1ec7n"),t.k0s()()()()()}if(2&s){const e=t.XpG();t.R7$(5),t.R50("ngModel",e.modelId),t.R7$(3),t.R50("ngModel",e.weather),t.R7$(4),t.R50("ngModel",e.traffic),t.R7$(4),t.R50("ngModel",e.events)}}function Q(s,E){1&s&&(t.j41(0,"div",49),t.nrm(1,"div",50),t.j41(2,"p",51),t.EFF(3,"\u0110ang ch\u1ea1y m\xf4 ph\u1ecfng..."),t.k0s()())}function Z(s,E){if(1&s&&(t.j41(0,"div",52)(1,"div",53),t.qSk(),t.j41(2,"svg",54),t.nrm(3,"path",55),t.k0s(),t.joV(),t.j41(4,"p",56),t.EFF(5),t.k0s()()()),2&s){const e=t.XpG();t.R7$(5),t.JRh(e.error)}}function q(s,E){1&s&&(t.j41(0,"tr")(1,"td",57),t.EFF(2,"Ch\u1ecdn plan v\xe0 ch\u1ea1y m\xf4 ph\u1ecfng \u0111\u1ec3 xem k\u1ebft qu\u1ea3"),t.k0s()())}function tt(s,E){1&s&&(t.j41(0,"div",58),t.qSk(),t.j41(1,"svg",59),t.nrm(2,"path",60),t.k0s(),t.joV(),t.j41(3,"p",61),t.EFF(4,"Ch\u01b0a c\xf3 d\u1eef li\u1ec7u m\xf4 ph\u1ecfng"),t.k0s(),t.j41(5,"p",62),t.EFF(6,'Ch\u1ecdn plan v\xe0 th\u1eddi gian, sau \u0111\xf3 nh\u1ea5n "M\xf4 Ph\u1ecfng" \u0111\u1ec3 ch\u1ea1y'),t.k0s()())}function et(s,E){if(1&s){const e=t.RV6();t.j41(0,"div",63),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeTripDetail())}),t.j41(1,"div",64),t.bIt("click",function(n){return t.eBV(e),t.Njj(n.stopPropagation())}),t.j41(2,"div",65)(3,"h3",66),t.EFF(4,"Chi ti\u1ebft chuy\u1ebfn xe"),t.k0s(),t.j41(5,"button",67),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeTripDetail())}),t.qSk(),t.j41(6,"svg",68),t.nrm(7,"path",69),t.k0s()()(),t.joV(),t.j41(8,"div",70)(9,"div",71)(10,"div",72)(11,"div",73),t.EFF(12,"M\xe3 chuy\u1ebfn"),t.k0s(),t.j41(13,"div",74),t.EFF(14),t.k0s()(),t.j41(15,"div",72)(16,"div",73),t.EFF(17,"Ng\xe0y"),t.k0s(),t.j41(18,"div",74),t.EFF(19),t.k0s()(),t.j41(20,"div",72)(21,"div",73),t.EFF(22,"Ca"),t.k0s(),t.j41(23,"div",74),t.EFF(24),t.k0s()()(),t.j41(25,"div",75)(26,"div",76)(27,"div",77),t.EFF(28),t.nI1(29,"number"),t.k0s(),t.j41(30,"div",78),t.EFF(31,"On-time Rate"),t.k0s()(),t.j41(32,"div",79)(33,"div",80),t.EFF(34),t.nI1(35,"number"),t.k0s(),t.j41(36,"div",81),t.EFF(37,"Drop Rate"),t.k0s()(),t.j41(38,"div",82)(39,"div",83),t.EFF(40),t.nI1(41,"number"),t.k0s(),t.j41(42,"div",84),t.EFF(43,"Fill Rate"),t.k0s()()(),t.j41(44,"div",85)(45,"h4",86),t.EFF(46,"Th\xf4ng tin chi ti\u1ebft"),t.k0s(),t.j41(47,"pre",87),t.EFF(48),t.nI1(49,"json"),t.k0s()()()()()}if(2&s){const e=t.XpG();t.R7$(14),t.JRh(e.selectedTrip.code||e.selectedTrip.trip_code||"-"),t.R7$(5),t.JRh(e.selectedTrip.date||"-"),t.R7$(5),t.JRh(e.selectedTrip.shift||e.selectedTrip.shift_name||"-"),t.R7$(4),t.SpI(" ",t.i5U(29,7,e.selectedTrip.ontime_rate||e.selectedTrip.ontime_rate_percent||0,"1.1-1"),"% "),t.R7$(6),t.SpI(" ",t.i5U(35,10,e.selectedTrip.drop_rate||e.selectedTrip.drop_rate_percent||0,"1.1-1"),"% "),t.R7$(6),t.SpI(" ",t.i5U(41,13,e.selectedTrip.fill_rate||e.selectedTrip.load_factor||0,"1.1-1"),"% "),t.R7$(8),t.JRh(t.bMT(49,16,e.selectedTrip))}}let nt=(()=>{class s{route;router;cdr;planService;simulationRunner;planId=null;tableBodyRef;simPlanId="";fromDate="";toDate="";persist=!0;modelId="";weather=!1;traffic=!1;events=!1;showSettings=!1;loading=!1;error=null;planName="";simulationResults=[];selectedTrip=null;canRunSimulation=!1;constructor(e,r,n,o,i){this.route=e,this.router=r,this.cdr=n,this.planService=o,this.simulationRunner=i}ngOnInit(){const e=new Date,r=new Date(e);r.setDate(r.getDate()+1),this.fromDate=e.toISOString().slice(0,10),this.toDate=r.toISOString().slice(0,10),this.route.params.subscribe(n=>{const o=n.id;o&&(this.planId=o,this.simPlanId=o,this.loadPlanInfo(o))}),this.planId&&(this.simPlanId=this.planId,this.loadPlanInfo(this.planId)),this.checkPlanningState(),this.updateButtonState()}ngOnChanges(e){e.planId&&this.planId&&(this.simPlanId=this.planId,this.loadPlanInfo(this.planId),this.updateButtonState())}checkPlanningState(){try{const e=window.planningState;e&&(e.selectedPlanId&&!this.simPlanId&&(this.simPlanId=e.selectedPlanId),e.selectedPlan&&(this.planName=e.selectedPlan.name||e.selectedPlan.plan_name||""),e.currentPlan&&(this.planName=this.planName||e.currentPlan.name||e.currentPlan.plan_name||"")),!this.simPlanId&&window.selectedPlanId&&(this.simPlanId=window.selectedPlanId),this.simPlanId&&this.updateButtonState()}catch(e){console.warn("Error checking planningState:",e)}}loadPlanInfo(e){this.planService.getPlan(e).subscribe({next:r=>{if(r&&r.ok&&r.data){let n=r.data;for(;n&&n.data;)n=n.data;this.planName=n?.name||n?.plan_name||n?.title||"";try{window.planningState=window.planningState||{},window.planningState.selectedPlan=n,window.planningState.currentPlan=n,window.planningState.selectedPlanId=e}catch(o){console.warn("Error updating planningState:",o)}}this.updateButtonState(),this.cdr.detectChanges()},error:r=>{console.warn("Error loading plan info:",r),this.updateButtonState(),this.cdr.detectChanges()}})}updateButtonState(){const e=!(!this.fromDate||!this.toDate),r=!(!this.simPlanId||!this.simPlanId.trim());this.canRunSimulation=e&&r,console.log("[TripSimulation] updateButtonState:",{hasDates:e,hasPlan:r,canRunSimulation:this.canRunSimulation,fromDate:this.fromDate,toDate:this.toDate,simPlanId:this.simPlanId}),this.cdr.detectChanges()}ngAfterViewInit(){console.log("[TripSimulation] Component initialized - using TypeScript renderer")}runSimulation(){var e=this;return(0,S.A)(function*(){if(console.log("[TripSimulation] runSimulation called",{canRunSimulation:e.canRunSimulation,loading:e.loading,simPlanId:e.simPlanId,fromDate:e.fromDate,toDate:e.toDate}),!e.canRunSimulation)return console.warn("[TripSimulation] Cannot run simulation - canRunSimulation is false"),console.warn("[TripSimulation] hasDates:",!(!e.fromDate||!e.toDate)),void console.warn("[TripSimulation] hasPlan:",!(!e.simPlanId||!e.simPlanId.trim()));if(e.loading)console.warn("[TripSimulation] Simulation already running");else{e.loading=!0,e.error=null,e.simulationResults=[],e.cdr.detectChanges();try{const r={plan_id:e.simPlanId,from_date:e.fromDate,to_date:e.toDate,persist:e.persist};e.modelId&&e.modelId.trim()&&(r.model_id=e.modelId.trim()),(e.weather||e.traffic||e.events)&&(r.simulation={weather:e.weather,traffic:e.traffic,events:e.events}),console.log("[TripSimulation] Calling simulationRunner.runSimulation with request:",r);const n=yield e.simulationRunner.runSimulation(r);console.log("[TripSimulation] Simulation completed, received planItems:",n),e.simulationResults=Array.isArray(n)?n:[n],console.log("[TripSimulation] Stored simulationResults:",e.simulationResults.length,"items");try{window.planningState=window.planningState||{},window.planningState.simulationData=n}catch(i){console.warn("Error updating simulation data in planningState:",i)}e.loading=!1,e.cdr.detectChanges(),yield new Promise(i=>setTimeout(i,100)),e.cdr.detectChanges(),yield new Promise(i=>setTimeout(i,100)),e.tableBodyRef?.nativeElement||document.getElementById("simulation-table-body-2")||(console.warn("[TripSimulation] Table body not found yet, waiting more..."),yield new Promise(i=>setTimeout(i,200))),console.log("[TripSimulation] Rendering table using TypeScript ForecastTableRendererService"),console.log("[TripSimulation] PlanItems to render:",n),e.simulationRunner.renderTable(n,"simulation-table-body-2"),console.log("[TripSimulation] Table rendering initiated")}catch(r){console.error("Error running simulation:",r),e.error=r?.message||"L\u1ed7i khi ch\u1ea1y m\xf4 ph\u1ecfng. Vui l\xf2ng th\u1eed l\u1ea1i.",e.simulationResults=[],e.cdr.detectChanges(),yield new Promise(o=>setTimeout(o,100));const n=e.tableBodyRef?.nativeElement||document.getElementById("simulation-table-body-2");n&&(n.innerHTML=`<tr><td colspan="11" class="px-6 py-8 text-left text-sm text-red-600">L\u1ed7i: ${e.error}</td></tr>`)}finally{e.loading&&(e.loading=!1),e.cdr.detectChanges()}}})()}showTripDetail(e){this.selectedTrip=e,this.cdr.detectChanges()}closeTripDetail(){this.selectedTrip=null,this.cdr.detectChanges()}loadTripSimulationData(){this.planId&&this.loadPlanInfo(this.planId)}static \u0275fac=function(r){return new(r||s)(t.rXU(D.nX),t.rXU(D.Ix),t.rXU(t.gRc),t.rXU(b.J),t.rXU(U))};static \u0275cmp=t.VBU({type:s,selectors:[["app-trip-simulation"]],viewQuery:function(r,n){if(1&r&&t.GBs(K,5),2&r){let o;t.mGM(o=t.lsd())&&(n.tableBodyRef=o.first)}},inputs:{planId:"planId"},features:[t.OA$],decls:75,vars:16,consts:[["tableBody",""],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","mb-6","overflow-hidden"],[1,"bg-gradient-to-r","from-orange-50","to-orange-100","border-b","border-orange-200","px-6","py-4"],[1,"flex","items-center","justify-between","flex-wrap","gap-4"],[1,"flex","items-center","gap-4"],[1,"text-lg","font-bold","text-gray-900","flex","items-center","gap-2"],["class","text-sm font-normal text-orange-600 bg-orange-100 px-3 py-1 rounded-full border border-orange-200",4,"ngIf"],[1,"flex","items-center","gap-3"],["type","button",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-white","hover:bg-orange-50","text-orange-600","text-sm","font-medium","rounded-lg","transition-colors","shadow-sm","border","border-orange-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["type","button",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-orange-400","hover:bg-orange-500","text-white","text-sm","font-medium","rounded-lg","transition-colors","shadow-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled","title"],["class","w-4 h-4","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],["class","inline-block animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent",4,"ngIf"],[1,"px-0","py-3","border-t","border-orange-100","bg-orange-50"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-3","items-end"],[1,"block","text-xs","font-medium","text-gray-700","mb-1"],["type","text","id","sim-plan-id-2","placeholder","Nh\u1eadp ho\u1eb7c ch\u1ecdn plan ID",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500",3,"ngModelChange","ngModel"],["type","date","id","sim-date-from-2",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500",3,"ngModelChange","ngModel"],["type","date","id","sim-date-to-2",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-700"],["type","checkbox",1,"w-4","h-4","text-orange-600","border-gray-300","rounded","focus:ring-orange-500",3,"ngModelChange","ngModel"],["class","px-0 py-3 border-t border-orange-100 bg-white",4,"ngIf"],["class","p-12 text-center",4,"ngIf"],["class","p-6 bg-red-50 border-l-4 border-red-500",4,"ngIf"],[1,"overflow-x-auto","border-t","border-gray-200"],[1,"min-w-full","border-collapse",2,"table-layout","auto"],[1,"sticky","top-0","z-10","bg-gradient-to-r","from-orange-200","to-orange-100"],[1,"px-3","py-2","text-left","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","100px"],[1,"px-3","py-2","text-left","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","120px"],[1,"px-3","py-2","text-left","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","150px"],[1,"px-3","py-2","text-center","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","50px"],[1,"px-3","py-2","text-left","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","200px"],[1,"px-3","py-2","text-left","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","180px"],[1,"px-3","py-2","text-center","text-xs","font-bold","text-gray-900","uppercase","border","border-gray-300",2,"min-width","100px"],["id","simulation-table-body-2",1,"bg-white"],[4,"ngIf"],["class","p-12 text-center text-gray-500",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"text-sm","font-normal","text-orange-600","bg-orange-100","px-3","py-1","rounded-full","border","border-orange-200"],[1,"mr-1"],[1,"font-semibold"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"inline-block","animate-spin","rounded-full","h-4","w-4","border-2","border-white","border-t-transparent"],[1,"px-0","py-3","border-t","border-orange-100","bg-white"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],["type","text","placeholder","\u0110\u1ec3 tr\u1ed1ng = m\u1eb7c \u0111\u1ecbnh",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500",3,"ngModelChange","ngModel"],[1,"p-12","text-center"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-4","border-orange-500","border-t-transparent","mb-3"],[1,"text-sm","text-gray-500"],[1,"p-6","bg-red-50","border-l-4","border-red-500"],[1,"flex","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-red-500","mr-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-sm","text-red-700"],["colspan","11",1,"px-6","py-8","text-center","text-sm","text-gray-500"],[1,"p-12","text-center","text-gray-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","opacity-30"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"text-base","font-medium"],[1,"text-sm","mt-2"],[1,"fixed","inset-0","bg-black","bg-opacity-50","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-white","rounded-lg","shadow-xl","max-w-4xl","w-full","max-h-[90vh]","overflow-y-auto",3,"click"],[1,"bg-gradient-to-r","from-orange-500","to-orange-600","px-6","py-4","flex","items-center","justify-between"],[1,"text-xl","font-bold","text-white"],[1,"text-white","hover:text-orange-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-4","mb-6"],[1,"bg-gray-50","p-3","rounded-lg"],[1,"text-xs","text-gray-600","mb-1"],[1,"font-bold","text-gray-900"],[1,"grid","grid-cols-3","gap-4","mb-6"],[1,"bg-green-50","p-4","rounded-lg","text-center"],[1,"text-2xl","font-bold","text-green-700"],[1,"text-sm","text-green-600","mt-1"],[1,"bg-red-50","p-4","rounded-lg","text-center"],[1,"text-2xl","font-bold","text-red-700"],[1,"text-sm","text-red-600","mt-1"],[1,"bg-blue-50","p-4","rounded-lg","text-center"],[1,"text-2xl","font-bold","text-blue-700"],[1,"text-sm","text-blue-600","mt-1"],[1,"border-t","pt-4"],[1,"font-bold","text-gray-900","mb-2"],[1,"bg-gray-50","p-4","rounded-lg","text-xs","overflow-x-auto"]],template:function(r,n){if(1&r){const o=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3",5)(5,"span"),t.EFF(6,"\u{1f680}"),t.k0s(),t.j41(7,"span"),t.EFF(8,"M\xf4 Ph\u1ecfng Chuy\u1ebfn Xe"),t.k0s(),t.DNE(9,X,7,1,"span",6),t.k0s()(),t.j41(10,"div",7)(11,"button",8),t.bIt("click",function(){return t.eBV(o),t.Njj(n.showSettings=!n.showSettings)}),t.qSk(),t.j41(12,"svg",9),t.nrm(13,"path",10)(14,"path",11),t.k0s(),t.joV(),t.j41(15,"span"),t.EFF(16,"C\xe0i \u0111\u1eb7t"),t.k0s()(),t.j41(17,"button",12),t.bIt("click",function(){return t.eBV(o),t.Njj(n.runSimulation())}),t.DNE(18,Y,2,0,"svg",13)(19,W,1,0,"div",14),t.j41(20,"span"),t.EFF(21),t.k0s()()()(),t.j41(22,"div",15)(23,"div",16)(24,"div")(25,"label",17),t.EFF(26,"Plan ID"),t.k0s(),t.j41(27,"input",18),t.mxI("ngModelChange",function(a){return t.eBV(o),t.DH7(n.simPlanId,a)||(n.simPlanId=a),t.Njj(a)}),t.bIt("ngModelChange",function(){return t.eBV(o),t.Njj(n.updateButtonState())}),t.k0s()(),t.j41(28,"div")(29,"label",17),t.EFF(30,"T\u1eeb ng\xe0y"),t.k0s(),t.j41(31,"input",19),t.mxI("ngModelChange",function(a){return t.eBV(o),t.DH7(n.fromDate,a)||(n.fromDate=a),t.Njj(a)}),t.bIt("ngModelChange",function(){return t.eBV(o),t.Njj(n.updateButtonState())}),t.k0s()(),t.j41(32,"div")(33,"label",17),t.EFF(34,"\u0110\u1ebfn ng\xe0y"),t.k0s(),t.j41(35,"input",20),t.mxI("ngModelChange",function(a){return t.eBV(o),t.DH7(n.toDate,a)||(n.toDate=a),t.Njj(a)}),t.bIt("ngModelChange",function(){return t.eBV(o),t.Njj(n.updateButtonState())}),t.k0s()(),t.j41(36,"div",21)(37,"label",22)(38,"input",23),t.mxI("ngModelChange",function(a){return t.eBV(o),t.DH7(n.persist,a)||(n.persist=a),t.Njj(a)}),t.k0s(),t.j41(39,"span"),t.EFF(40,"L\u01b0u k\u1ebft qu\u1ea3"),t.k0s()()()()(),t.DNE(41,J,19,4,"div",24),t.k0s(),t.DNE(42,Q,4,0,"div",25)(43,Z,6,1,"div",26),t.j41(44,"div",27)(45,"table",28)(46,"thead",29)(47,"tr")(48,"th",30),t.EFF(49,"Ng\xe0y"),t.k0s(),t.j41(50,"th",31),t.EFF(51,"Ca"),t.k0s(),t.j41(52,"th",32),t.EFF(53,"Xe"),t.k0s(),t.j41(54,"th",33),t.EFF(55,"STT"),t.k0s(),t.j41(56,"th",34),t.EFF(57,"T\xean \u0111i\u1ec3m"),t.k0s(),t.j41(58,"th",32),t.EFF(59,"Check-in"),t.k0s(),t.j41(60,"th",32),t.EFF(61,"Check-out"),t.k0s(),t.j41(62,"th",35),t.EFF(63,"S\u1ea3n l\u01b0\u1ee3ng"),t.k0s(),t.j41(64,"th",36),t.EFF(65,"R\u1edbt h\xe0ng"),t.k0s(),t.j41(66,"th",36),t.EFF(67,"L\u1ea5p \u0111\u1ea7y"),t.k0s(),t.j41(68,"th",32),t.EFF(69,"X\u1eed l\xfd"),t.k0s()()(),t.j41(70,"tbody",37,0),t.DNE(72,q,3,0,"tr",38),t.k0s()()(),t.DNE(73,tt,7,0,"div",39),t.k0s(),t.DNE(74,et,50,18,"div",40)}2&r&&(t.R7$(9),t.Y8G("ngIf",n.planName),t.R7$(8),t.Y8G("disabled",!n.canRunSimulation||n.loading)("title",n.canRunSimulation?n.loading?"\u0110ang ch\u1ea1y m\xf4 ph\u1ecfng...":"Ch\u1ea1y m\xf4 ph\u1ecfng":"Vui l\xf2ng nh\u1eadp Plan ID v\xe0 ch\u1ecdn ng\xe0y"),t.R7$(),t.Y8G("ngIf",!n.loading),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(2),t.JRh(n.loading?"\u0110ang ch\u1ea1y...":"M\xf4 Ph\u1ecfng"),t.R7$(6),t.R50("ngModel",n.simPlanId),t.R7$(4),t.R50("ngModel",n.fromDate),t.R7$(4),t.R50("ngModel",n.toDate),t.R7$(3),t.R50("ngModel",n.persist),t.R7$(3),t.Y8G("ngIf",n.showSettings),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(),t.Y8G("ngIf",n.error&&!n.loading),t.R7$(29),t.Y8G("ngIf",!n.simulationResults||0===n.simulationResults.length),t.R7$(),t.Y8G("ngIf",!n.simulationResults||0===n.simulationResults.length&&!n.loading&&!n.error),t.R7$(),t.Y8G("ngIf",n.selectedTrip))},dependencies:[j.MD,j.bT,j.TG,j.QX,k.YN,k.me,k.Zm,k.BC,k.vS],encapsulation:2})}return s})()}}]);