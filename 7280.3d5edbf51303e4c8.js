"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[7280],{7280:(J,d,o)=>{o.r(d),o.d(d,{GuestsComponent:()=>N});var l=o(2881),_=o(9417),y=o(5207),h=o(1141),C=o(491),M=o(1570),P=o(2242),O=o(6221),v=o(6150),f=o(7722),G=o(8542),E=o(5716),R=o(935),k=o(9114),F=o(7164),m=o(5779),j=o(5545),t=o(1360);const T=()=>({width:"80vw",maxWidth:"1000px"}),D=()=>[10,25,50];function b(a,i){1&a&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"Guest"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Total Bookings"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Total Spent"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Favorite Apartment"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Last Booking"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Status"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Actions"),t.k0s()())}function I(a,i){if(1&a&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&a){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,e.lastBooking.check_in,"short")," ")}}function B(a,i){1&a&&(t.j41(0,"span",32),t.EFF(1,"N/A"),t.k0s())}function A(a,i){if(1&a){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"div",22),t.nrm(3,"p-avatar",23),t.j41(4,"span",24),t.EFF(5),t.k0s()()(),t.j41(6,"td")(7,"span",25),t.EFF(8),t.k0s()(),t.j41(9,"td")(10,"span",26),t.EFF(11),t.nI1(12,"currency"),t.k0s()(),t.j41(13,"td")(14,"span",27),t.EFF(15),t.k0s()(),t.j41(16,"td"),t.DNE(17,I,3,4,"span",28)(18,B,2,0,"span",29),t.k0s(),t.j41(19,"td"),t.nrm(20,"p-badge",30),t.nI1(21,"titlecase"),t.k0s(),t.j41(22,"td")(23,"button",31),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.viewGuestDetails(s))}),t.k0s()()()}if(2&a){const e=i.$implicit,n=t.XpG(2);t.R7$(3),t.Y8G("label",n.getInitials(e.account_id)),t.R7$(2),t.JRh(e.account_id),t.R7$(3),t.JRh(e.totalBookings),t.R7$(3),t.JRh(t.bMT(12,9,e.totalSpent)),t.R7$(4),t.JRh(n.getApartmentName(e.favoriteApartment||"")),t.R7$(2),t.Y8G("ngIf",e.lastBooking),t.R7$(),t.Y8G("ngIf",!e.lastBooking),t.R7$(2),t.Y8G("value",t.bMT(21,11,e.status))("severity",n.getStatusSeverity(e.status))}}function S(a,i){1&a&&(t.j41(0,"tr")(1,"td",33)(2,"div",34),t.nrm(3,"i",35),t.j41(4,"p"),t.EFF(5,"No guests found"),t.k0s()()()())}function w(a,i){if(1&a&&(t.j41(0,"p-card")(1,"p-table",18),t.DNE(2,b,15,0,"ng-template",19)(3,A,24,13,"ng-template",20)(4,S,6,0,"ng-template",21),t.k0s()()),2&a){const e=t.XpG();t.R7$(),t.Y8G("value",e.filteredGuests)("paginator",!0)("rows",10)("rowsPerPageOptions",t.lJ4(5,D))("showCurrentPageReport",!0)}}function $(a,i){1&a&&(t.j41(0,"div",36),t.nrm(1,"p-skeleton",37),t.k0s())}function x(a,i){1&a&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"Booking ID"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Apartment"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Check-in"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Check-out"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Total Price"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Status"),t.k0s()())}function U(a,i){if(1&a&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.nI1(7,"date"),t.k0s(),t.j41(8,"td"),t.EFF(9),t.nI1(10,"date"),t.k0s(),t.j41(11,"td"),t.EFF(12),t.nI1(13,"currency"),t.k0s(),t.j41(14,"td"),t.nrm(15,"p-badge",30),t.nI1(16,"titlecase"),t.k0s()()),2&a){const e=i.$implicit,n=t.XpG(2);t.R7$(2),t.JRh(e.id),t.R7$(2),t.JRh(n.getApartmentName(e.apartment_id)),t.R7$(2),t.JRh(t.i5U(7,7,e.check_in,"short")),t.R7$(3),t.JRh(t.i5U(10,10,e.check_out,"short")),t.R7$(3),t.JRh(t.bMT(13,13,e.total_price)),t.R7$(3),t.Y8G("value",t.bMT(16,15,e.booking_status))("severity",n.getBookingStatusSeverity(e.booking_status))}}function L(a,i){if(1&a&&(t.j41(0,"div",38)(1,"div",39)(2,"div",40)(3,"div",41)(4,"span",42),t.EFF(5,"Total Bookings:"),t.k0s(),t.j41(6,"span",43),t.EFF(7),t.k0s()(),t.j41(8,"div",41)(9,"span",42),t.EFF(10,"Total Spent:"),t.k0s(),t.j41(11,"span",44),t.EFF(12),t.nI1(13,"currency"),t.k0s()(),t.j41(14,"div",41)(15,"span",42),t.EFF(16,"Favorite Apartment:"),t.k0s(),t.j41(17,"span",43),t.EFF(18),t.k0s()(),t.j41(19,"div",41)(20,"span",42),t.EFF(21,"Status:"),t.k0s(),t.nrm(22,"p-badge",30),t.nI1(23,"titlecase"),t.k0s()()(),t.nrm(24,"p-divider"),t.j41(25,"h3"),t.EFF(26,"Booking History"),t.k0s(),t.j41(27,"p-table",45),t.DNE(28,x,13,0,"ng-template",19)(29,U,17,17,"ng-template",20),t.k0s()()),2&a){const e=t.XpG();t.R7$(7),t.JRh(e.selectedGuest.totalBookings),t.R7$(5),t.JRh(t.bMT(13,8,e.selectedGuest.totalSpent)),t.R7$(6),t.JRh(e.getApartmentName(e.selectedGuest.favoriteApartment||"")),t.R7$(4),t.Y8G("value",t.bMT(23,10,e.selectedGuest.status))("severity",e.getStatusSeverity(e.selectedGuest.status)),t.R7$(5),t.Y8G("value",e.guestBookings)("paginator",!0)("rows",5)}}let N=(()=>{class a{hotelService;messageService;bookings=[];guests=[];filteredGuests=[];apartments=[];loading=!1;searchTerm="";showGuestDialog=!1;selectedGuest=null;guestBookings=[];constructor(e,n){this.hotelService=e,this.messageService=n}ngOnInit(){this.loadData()}loadData(){this.loading=!0,this.hotelService.getBookings().subscribe({next:e=>{this.bookings=e.data||[],this.processGuests(),this.loadApartments(),this.loading=!1},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load guest data"}),this.loading=!1}})}loadApartments(){this.hotelService.getApartments().subscribe({next:e=>{this.apartments=e.data||[]},error:()=>{}})}processGuests(){const e=new Map;this.bookings.forEach(n=>{const s=n.account_id;e.has(s)||e.set(s,{account_id:s,totalBookings:0,totalSpent:0,status:"active"});const r=e.get(s);r.totalBookings++,r.totalSpent+=n.total_price||0,(!r.lastBooking||new Date(n.check_in)>new Date(r.lastBooking.check_in))&&(r.lastBooking=n)}),e.forEach((n,s)=>{const r=new Map;this.bookings.filter(c=>c.account_id===s).forEach(c=>{const u=r.get(c.apartment_id)||0;r.set(c.apartment_id,u+1)});let p=0,g="";if(r.forEach((c,u)=>{c>p&&(p=c,g=u)}),n.favoriteApartment=g,n.lastBooking){const c=new Date(n.lastBooking.check_in),u=((new Date).getTime()-c.getTime())/864e5;n.status=u>90?"inactive":"active"}}),this.guests=Array.from(e.values()),this.filterGuests()}filterGuests(){let e=[...this.guests];if(this.searchTerm){const n=this.searchTerm.toLowerCase();e=e.filter(s=>s.account_id.toLowerCase().includes(n)||s.favoriteApartment&&this.getApartmentName(s.favoriteApartment).toLowerCase().includes(n))}e.sort((n,s)=>s.totalSpent-n.totalSpent),this.filteredGuests=e}onSearch(){this.filterGuests()}viewGuestDetails(e){this.selectedGuest=e,this.guestBookings=this.bookings.filter(n=>n.account_id===e.account_id).sort((n,s)=>new Date(s.check_in).getTime()-new Date(n.check_in).getTime()),this.showGuestDialog=!0}closeGuestDialog(){this.showGuestDialog=!1,this.selectedGuest=null,this.guestBookings=[]}getApartmentName(e){const n=this.apartments.find(s=>(s.id||s._id)===e);return n?n.title:e}getStatusSeverity(e){return"active"===e?"success":"secondary"}getInitials(e){return e.substring(0,2).toUpperCase()}getActiveGuests(){return this.guests.filter(e=>"active"===e.status).length}getTotalRevenue(){return this.guests.reduce((e,n)=>e+n.totalSpent,0)}getAverageSpending(){return 0===this.guests.length?0:this.getTotalRevenue()/this.guests.length}getBookingStatusSeverity(e){return{confirmed:"success",pending:"warning",canceled:"danger",completed:"info",no_show:"secondary"}[e]||"secondary"}static \u0275fac=function(n){return new(n||a)(t.rXU(j.g),t.rXU(m.bg))};static \u0275cmp=t.VBU({type:a,selectors:[["app-hotel-guests"]],features:[t.Jv_([m.bg])],decls:47,vars:19,consts:[["loadingTemplate",""],[1,"guests-page"],[1,"page-header"],[1,"header-content"],[1,"subtitle"],[1,"header-actions"],["pButton","","type","button","label","Refresh","icon","pi pi-refresh",1,"p-button-secondary",3,"click"],[1,"summary-cards"],[1,"summary-stat"],[1,"stat-value"],[1,"stat-label"],[1,"search-card"],[1,"search-group"],["pInputText","","type","text","placeholder","Search by Guest ID or Apartment",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"pi","pi-search","search-icon"],[4,"ngIf","ngIfElse"],[3,"visibleChange","onHide","visible","header","modal","closable"],["class","guest-details-content",4,"ngIf"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} guests","styleClass","p-datatable-sm",3,"value","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"guest-info"],["styleClass","mr-2","shape","circle",3,"label"],[1,"guest-id"],[1,"booking-count"],[1,"total-spent"],[1,"apartment-name"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[3,"value","severity"],["pButton","","type","button","icon","pi pi-eye","label","View Details",1,"p-button-sm","p-button-info",3,"click"],[1,"text-muted"],["colspan","7",1,"text-center"],[1,"empty-state"],[1,"pi","pi-users"],[1,"loading-container"],["height","300px"],[1,"guest-details-content"],[1,"guest-summary"],[1,"summary-grid"],[1,"summary-item"],[1,"label"],[1,"value"],[1,"value","price"],["styleClass","p-datatable-sm",3,"value","paginator","rows"]],template:function(n,s){if(1&n){const r=t.RV6();t.j41(0,"div",1),t.nrm(1,"p-toast"),t.j41(2,"div",2)(3,"div",3)(4,"div")(5,"h1"),t.EFF(6,"Guests Management"),t.k0s(),t.j41(7,"p",4),t.EFF(8,"View and manage guest information and booking history"),t.k0s()(),t.j41(9,"div",5)(10,"button",6),t.bIt("click",function(){return t.eBV(r),t.Njj(s.loadData())}),t.k0s()()()(),t.j41(11,"div",7)(12,"p-card")(13,"div",8)(14,"span",9),t.EFF(15),t.k0s(),t.j41(16,"span",10),t.EFF(17,"Total Guests"),t.k0s()()(),t.j41(18,"p-card")(19,"div",8)(20,"span",9),t.EFF(21),t.k0s(),t.j41(22,"span",10),t.EFF(23,"Active Guests"),t.k0s()()(),t.j41(24,"p-card")(25,"div",8)(26,"span",9),t.EFF(27),t.nI1(28,"currency"),t.k0s(),t.j41(29,"span",10),t.EFF(30,"Total Revenue"),t.k0s()()(),t.j41(31,"p-card")(32,"div",8)(33,"span",9),t.EFF(34),t.nI1(35,"currency"),t.k0s(),t.j41(36,"span",10),t.EFF(37,"Avg. Spending"),t.k0s()()()(),t.j41(38,"p-card",11)(39,"div",12)(40,"input",13),t.mxI("ngModelChange",function(g){return t.eBV(r),t.DH7(s.searchTerm,g)||(s.searchTerm=g),t.Njj(g)}),t.bIt("input",function(){return t.eBV(r),t.Njj(s.onSearch())}),t.k0s(),t.nrm(41,"i",14),t.k0s()(),t.DNE(42,w,5,6,"p-card",15)(43,$,2,0,"ng-template",null,0,t.C5r),t.j41(45,"p-dialog",16),t.mxI("visibleChange",function(g){return t.eBV(r),t.DH7(s.showGuestDialog,g)||(s.showGuestDialog=g),t.Njj(g)}),t.bIt("onHide",function(){return t.eBV(r),t.Njj(s.closeGuestDialog())}),t.DNE(46,L,30,12,"div",17),t.k0s()()}if(2&n){const r=t.sdS(44);t.R7$(15),t.JRh(s.guests.length),t.R7$(6),t.JRh(s.getActiveGuests()),t.R7$(6),t.JRh(t.bMT(28,14,s.getTotalRevenue())),t.R7$(7),t.JRh(t.bMT(35,16,s.getAverageSpending())),t.R7$(6),t.R50("ngModel",s.searchTerm),t.R7$(2),t.Y8G("ngIf",!s.loading)("ngIfElse",r),t.R7$(3),t.Aen(t.lJ4(18,T)),t.R50("visible",s.showGuestDialog),t.Y8G("header","Guest Details: "+((null==s.selectedGuest?null:s.selectedGuest.account_id)||""))("modal",!0)("closable",!0),t.R7$(),t.Y8G("ngIf",s.selectedGuest)}},dependencies:[l.MD,l.bT,l.PV,l.oe,l.vh,_.YN,_.me,_.BC,_.vS,y.iI,h.tm,h._f,m.Ei,C.Dw,C.Zp,M.Ph,M.lG,P.um,P.Sm,O.bG,O.XI,v.EJ,v.Ex,f.MB,f.y8,G.Ss,E.k2,E.EA,R.$C,k.mC,k.eu,F.mN,F.cG],styles:[".guests-page[_ngcontent-%COMP%]{padding:2rem}.guests-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;background:linear-gradient(135deg,var(--p-surface-0) 0%,rgba(var(--p-primary-500),.05) 100%);padding:2rem;border-radius:12px;border-bottom:2px solid rgba(var(--p-primary-500),.2)}.guests-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.guests-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:2rem;font-weight:700;color:var(--p-surface-900)}.guests-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.95rem;color:var(--p-surface-600)}.guests-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:2rem}.guests-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:1rem}.guests-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--p-primary-600)}.guests-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--p-surface-600);margin-top:.5rem}.guests-page[_ngcontent-%COMP%]   .search-card[_ngcontent-%COMP%]{margin-bottom:2rem}.guests-page[_ngcontent-%COMP%]   .search-card[_ngcontent-%COMP%]   .search-group[_ngcontent-%COMP%]{position:relative}.guests-page[_ngcontent-%COMP%]   .search-card[_ngcontent-%COMP%]   .search-group[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding-right:2.5rem}.guests-page[_ngcontent-%COMP%]   .search-card[_ngcontent-%COMP%]   .search-group[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;right:1rem;top:50%;transform:translateY(-50%);color:var(--p-surface-400)}.guests-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{padding:2rem}.guests-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{padding:3rem;text-align:center;color:var(--p-surface-600)}.guests-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem;color:var(--p-surface-400)}.guests-page[_ngcontent-%COMP%]   .guest-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.guests-page[_ngcontent-%COMP%]   .guest-info[_ngcontent-%COMP%]   .guest-id[_ngcontent-%COMP%]{font-weight:500;font-family:Courier New,monospace}.guests-page[_ngcontent-%COMP%]   .booking-count[_ngcontent-%COMP%]{font-weight:600;color:var(--p-primary-600)}.guests-page[_ngcontent-%COMP%]   .total-spent[_ngcontent-%COMP%]{font-weight:600;color:var(--p-success-600)}.guests-page[_ngcontent-%COMP%]   .apartment-name[_ngcontent-%COMP%]{font-weight:500}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   .guest-summary[_ngcontent-%COMP%]{margin-bottom:1.5rem}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   .guest-summary[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   .guest-summary[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--p-surface-50);border-radius:6px}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   .guest-summary[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:var(--p-surface-600)}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   .guest-summary[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-900)}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   .guest-summary[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .value.price[_ngcontent-%COMP%]{color:var(--p-primary-600);font-size:1.1rem}.guests-page[_ngcontent-%COMP%]   .guest-details-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:1.5rem 0 1rem;color:var(--p-surface-900)}"]})}return a})()}}]);