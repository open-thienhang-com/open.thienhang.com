<div class="header flex items-center justify-between p-2 mb-4">
  <div class="">
    <ul class="flex list-none m-0 p-0 gap-2 items-center">
      <li>
        <button type="button"
                class="inline-flex w-8 h-8 p-0 items-center justify-center surface-0 dark:surface-800 border border-surface-200 dark:border-surface-600 rounded"
                (click)="toggleSidebar.emit()">
          <i class="pi pi-th-large dark:text-white"></i>
        </button>
      </li>
      <li>
        <div class="search-container">
          <input type="text" 
                 pInputText 
                 [(ngModel)]="searchKeyword" 
                 placeholder="Search..."
                 (keyup.enter)="performSearch()"
                 (input)="onSearchInput()"
                 class="search-input">
          <i class="pi pi-search search-icon" (click)="performSearch()"></i>
          
          <!-- Search Results Overlay -->
          <div class="search-overlay" *ngIf="showSearchResults" (clickOutside)="clearSearch()">
            <app-search-results
              [results]="searchResults$ | async"
              [isSearching]="isSearching$ | async"
              [popularSearches]="popularSearches"
              (clear)="clearSearch()"
              (resultClick)="onSearchResultClick($event)">
            </app-search-results>
          </div>
        </div>
      </li>
    </ul>
  </div>
  <div class="">
    <ul class="flex list-none m-0 p-0 gap-2 items-center">
      <!-- Current user component shows avatar dropdown with name, email and ID -->
      <li>
        <app-current-user></app-current-user>
      </li>

      <!-- App selector: open matrix dialog -->
      <li>
        <button type="button"
                class="inline-flex items-center justify-center w-8 h-8 p-0 rounded border border-surface-200 dark:border-surface-600 surface-0 dark:surface-800"
                aria-haspopup="dialog"
                (click)="openAppMatrix()"
                aria-label="Open app switcher">
          <i class="pi pi-th-large dark:text-white"></i>
        </button>

  <!-- Workspace badge -->
  <span class="workspace-badge ml-2" [class.highlight]="workspaceHighlight">{{ workspaceLabel }}</span>

        <p-dialog 
          header="All Applications" 
          [(visible)]="showAppMatrix" 
          [modal]="true" 
          [style]="{ width: '720px', maxWidth: '90vw' }" 
          [closable]="true" 
          (onHide)="closeAppMatrix()"
          styleClass="app-matrix-dialog">
          <div class="apps-matrix-grid">
            <button *ngFor="let app of apps" type="button"
                    class="app-tile"
                    [class.active]="selectedApp === app.key"
                    (click)="selectAppKey(app.key)"
                    [attr.aria-label]="app.label">
              <div class="app-icon-wrapper" [attr.data-app]="app.key">
                <i [class]="app.icon"></i>
              </div>
              <span class="app-label">{{ app.label }}</span>
              <i class="pi pi-check check-icon" *ngIf="selectedApp === app.key"></i>
            </button>
          </div>
        </p-dialog>
      </li>

      <!-- Language Selector -->
      <li class="relative">
        <button
          pStyleClass="@next"
          enterFromClass="hidden"
          enterActiveClass="animate-scalein"
          leaveToClass="hidden"
          leaveActiveClass="animate-fadeout"
          [hideOnOutsideClick]="true"
          type="button"
          class="inline-flex w-8 h-8 p-0 items-center justify-center surface-0 dark:surface-800 border border-surface-200 dark:border-surface-600 rounded">
          <i class="pi pi-globe dark:text-white"></i>
        </button>
        <div class="absolute top-[2.5rem] right-0 hidden w-[12rem] bg-white dark:bg-surface-800 rounded-md shadow-lg border border-surface-200 dark:border-surface-700 z-50 origin-top">
          <div class="p-2">
            <button 
              (click)="changeLanguage('vi')"
              class="flex items-center gap-3 p-2 rounded-md hover:bg-surface-100 dark:hover:bg-surface-700 transition-colors w-full text-left"
              [class.bg-surface-100]="currentLanguage() === 'vi'"
              [class.dark:bg-surface-700]="currentLanguage() === 'vi'">
              <span class="text-lg">ðŸ‡»ðŸ‡³</span>
              <span class="text-sm text-surface-700 dark:text-surface-300">Tiáº¿ng Viá»‡t</span>
              <i *ngIf="currentLanguage() === 'vi'" class="pi pi-check text-green-500 ml-auto"></i>
            </button>
            <button 
              (click)="changeLanguage('en')"
              class="flex items-center gap-3 p-2 rounded-md hover:bg-surface-100 dark:hover:bg-surface-700 transition-colors w-full text-left"
              [class.bg-surface-100]="currentLanguage() === 'en'"
              [class.dark:bg-surface-700]="currentLanguage() === 'en'">
              <span class="text-lg">ðŸ‡ºðŸ‡¸</span>
              <span class="text-sm text-surface-700 dark:text-surface-300">English</span>
              <i *ngIf="currentLanguage() === 'en'" class="pi pi-check text-green-500 ml-auto"></i>
            </button>
          </div>
        </div>
      </li>
      
      <li>
        <button type="button"
                class="inline-flex w-8 h-8 p-0 items-center justify-center surface-0 dark:surface-800 border border-surface-200 dark:border-surface-600 rounded"
                (click)="onThemeToggler()">
          <i [ngClass]="'pi ' + iconClass()" class="dark:text-white"></i>
        </button>
      </li>
      <li class="relative">
        <button
          pStyleClass="@next"
          enterFromClass="hidden"
          enterActiveClass="animate-scalein"
          leaveToClass="hidden"
          leaveActiveClass="animate-fadeout"
          [hideOnOutsideClick]="true"
          type="button"
          class="inline-flex w-8 h-8 p-0 items-center justify-center surface-0 dark:surface-800 border border-surface-200 dark:border-surface-600 rounded"
        >
          <i class="pi pi-palette dark:text-white"></i>
        </button>
        <div
          class="absolute top-[2.5rem] right-0 hidden w-[18rem] p-3 bg-white dark:bg-surface-800 rounded-md shadow border border-surface-200 dark:border-surface-700 flex-col justify-start items-start gap-3.5 inline-flex origin-top z-10">
          <div class="flex-col justify-start items-start gap-2 inline-flex pr-4">
            <span class="text-sm font-medium">Primary Colors</span>
            <div class="self-stretch justify-start items-start gap-2 inline-flex flex-wrap">
              @for (primaryColor of primaryColors(); track primaryColor.name) {
                <button
                  type="button"
                  [title]="primaryColor.name"
                  (click)="updateColors($event, 'primary', primaryColor)"
                  class="outline outline-2 outline-offset-1 outline-transparent cursor-pointer p-0 rounded-[50%] w-5 h-5"
                  [ngStyle]="{
                                        'background-color': primaryColor.name === 'noir' ? 'var(--text-color)' : primaryColor.palette['500'],
                                        'outline-color': selectedPrimaryColor() === primaryColor.name ? 'var(--p-primary-color)' : ''
                                    }"
                ></button>
              }
            </div>
          </div>
          <div class="flex-col justify-start items-start gap-2 inline-flex pr-2">
            <span class="text-sm font-medium">Surface Colors</span>
            <div class="self-stretch justify-start items-start gap-2 inline-flex">
              @for (surface of surfaces; track surface.name) {
                <button
                  type="button"
                  [title]="surface.name"
                  (click)="updateColors($event, 'surface', surface)"
                  class="outline outline-2 outline-offset-1 outline-transparent cursor-pointer p-0 rounded-[50%] w-5 h-5"
                  [ngStyle]="{
                                        'background-color': surface.palette['500'],
                                        'outline-color': selectedSurfaceColor() === surface.name ? 'var(--p-primary-color)' : ''
                                    }"
                ></button>
              }
            </div>
          </div>
          <div class="flex-col justify-start items-start gap-2 inline-flex w-full">
            <span class="text-sm font-medium">Preset</span>
            <div
              class="inline-flex p-[0.28rem] items-start gap-[0.28rem] rounded-[0.71rem] border border-[#00000003] w-full">
              <p-selectbutton [options]="presets" [ngModel]="selectedPreset()" (ngModelChange)="onPresetChange($event)"
                              [unselectable]="false" size="small"/>
            </div>
          </div>
          <div class="inline-flex flex-col justify-start items-start gap-2 w-full pt-4 pb-2">
            <span class="text-sm font-medium m-0">Ripple Effect</span>
            <p-toggleswitch [(ngModel)]="ripple"/>
          </div>
        </div>
      </li>
    </ul>
  </div>

</div>
