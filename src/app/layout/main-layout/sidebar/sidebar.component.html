<div class="sidebar-container">
  <!-- Header actions (replaces sidebar-header) -->
  <div class="header-actions" [class.justify-center]="collapsed">
    <!-- logo removed per request -->

    <div class="actions-block">
      <button
        type="button"
        class="header-btn app-switcher-header-btn"
        (click)="openAppMatrix()"
        [pTooltip]="collapsed ? 'Switch App' : ''"
        tooltipPosition="right">
        <i class="pi pi-th-large"></i>
        <span *ngIf="!collapsed" class="ml-2">{{ workspaceLabel }}</span>
      </button>

      <button
        class="logout-header-btn"
        [class.hidden]="collapsed"
        (click)="doLogout()"
        type="button"
        [pTooltip]="collapsed ? 'Logout' : ''"
        tooltipPosition="right">
        <i class="pi pi-sign-out"></i>
      </button>

      <button 
        class="close-btn lg:hidden"
        [class.hidden]="collapsed"
        (click)="toggle.emit()">
        <i class="pi pi-times"></i>
      </button>
    </div>
  </div>

  <!-- Navigation - Scrollable Middle Section -->
  <div class="sidebar-content">
    <nav class="sidebar-nav" [class.collapsed]="collapsed">
      
      <!-- Quick Access Section -->
      <!-- Quick Access removed per request -->

      <!-- Main Navigation Groups -->
      <div class="nav-section" *ngFor="let group of visibleGroups; trackBy: trackByGroup">
        <!-- Group Header - Clickable to expand/collapse -->
        <button 
          class="group-header"
          [class.expanded]="group.expanded"
          [class.collapsed-sidebar]="collapsed"
          (click)="!collapsed && toggleGroup(group)"
          type="button">
          <div class="group-title">
            <i [class]="group.icon"></i>
            <span *ngIf="!collapsed">{{ group.label }}</span>
          </div>
          <i 
            *ngIf="!collapsed && hasItems(group)" 
            class="pi pi-chevron-down expand-icon"
            [class.expanded]="group.expanded"></i>
        </button>

        <!-- Group Items - Flat list (NO nested subgroups) -->
        <ul class="nav-list" *ngIf="!collapsed && hasItems(group)" [ngClass]="{ open: group.expanded }">
          <li *ngFor="let item of group._flattened; trackBy: trackByItem">
            <a 
              [routerLink]="item.url" 
              class="nav-link sub-link"
              routerLinkActive="active"
              *ngIf="item.url">
              <i [class]="item.icon"></i>
              <span>{{ item.label }}</span>
            </a>
          </li>
        </ul>
      </div>

    </nav>
  </div>

  <!-- Footer - Fixed at bottom -->
  <div class="sidebar-footer" [class.collapsed]="collapsed">
    
    <!-- User Info removed per request -->

    <!-- Footer now only contains Profile (logout and app-switcher were moved to header) -->
    <div class="footer-actions">
      <button
        type="button"
        class="footer-btn profile-btn"
        (click)="openProfile()"
        [pTooltip]="collapsed ? 'Profile' : ''"
        tooltipPosition="right">
        <i class="pi pi-user"></i>
        <span *ngIf="!collapsed">Profile</span>
      </button>
    </div>
  </div>
</div>

<!-- App Matrix Dialog -->
<p-dialog 
  header="All Applications" 
  [(visible)]="showAppMatrix" 
  [modal]="true" 
  appendTo="body"
  [baseZIndex]="10000"
  [style]="{ width: '720px', maxWidth: '90vw' }" 
  [closable]="true" 
  (onHide)="closeAppMatrix()"
  styleClass="app-matrix-dialog">
  <div class="apps-matrix-grid">
    <button *ngFor="let app of apps" type="button"
            class="app-tile"
            [class.active]="selectedApp === app.key"
            (click)="selectAppKey(app.key)"
            [attr.aria-label]="app.label">
      <div class="app-icon-wrapper" [attr.data-app]="app.key">
        <i [class]="app.icon"></i>
      </div>
      <span class="app-label">{{ app.label }}</span>
      <i class="pi pi-check check-icon" *ngIf="selectedApp === app.key"></i>
    </button>
  </div>
</p-dialog>

<!-- Info Dialog -->
<p-dialog 
  header="{{ selectedInfo?.title }}" 
  [(visible)]="infoDialogVisible" 
  [modal]="true" 
  [style]="{ width: '600px' }"
  [draggable]="false" 
  [resizable]="false"
  styleClass="info-dialog">
  
  <div *ngIf="selectedInfo" class="info-content">
    <!-- Description -->
    <div class="mb-4">
      <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
        {{ selectedInfo.description }}
      </p>
    </div>

    <!-- Features -->
    <div class="mb-4">
      <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
        <i class="pi pi-star text-blue-500 mr-2"></i>
        Key Features
      </h4>
      <ul class="space-y-2">
        <li *ngFor="let feature of selectedInfo.features" class="flex items-start gap-2">
          <i class="pi pi-check text-green-500 mt-0.5 text-sm"></i>
          <span class="text-gray-700 dark:text-gray-300 text-sm">{{ feature }}</span>
        </li>
      </ul>
    </div>

    <p-divider></p-divider>

    <!-- Usage -->
    <div class="mb-4">
      <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
        <i class="pi pi-info-circle text-blue-500 mr-2"></i>
        How to Use
      </h4>
      <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
        {{ selectedInfo.usage }}
      </p>
    </div>

    <!-- Tips -->
    <div *ngIf="selectedInfo.tips && selectedInfo.tips.length > 0" class="mb-4">
      <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
        <i class="pi pi-lightbulb text-yellow-500 mr-2"></i>
        Pro Tips
      </h4>
      <ul class="space-y-2">
        <li *ngFor="let tip of selectedInfo.tips" class="flex items-start gap-2">
          <i class="pi pi-angle-right text-blue-500 mt-0.5 text-sm"></i>
          <span class="text-gray-700 dark:text-gray-300 text-sm">{{ tip }}</span>
        </li>
      </ul>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <button 
        pButton 
        pRipple 
        label="Got it!" 
        icon="pi pi-check"
        class="p-button-primary"
        (click)="hideInfo()">
      </button>
    </div>
  </ng-template>
</p-dialog>