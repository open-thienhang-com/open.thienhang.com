import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';

export interface Language {
  code: string;
  name: string;
  flag: string;
}

export interface TranslationKey {
  [key: string]: string | TranslationKey;
}

@Injectable({
  providedIn: 'root'
})
export class I18nService {
  private currentLanguageSubject = new BehaviorSubject<string>('vi'); // Default to Vietnamese
  public currentLanguage$ = this.currentLanguageSubject.asObservable();

  private translations: { [lang: string]: TranslationKey } = {
    vi: {
      // Common
      common: {
        loading: 'ƒêang t·∫£i...',
        save: 'L∆∞u',
        cancel: 'H·ªßy',
        delete: 'X√≥a',
        edit: 'Ch·ªânh s·ª≠a',
        view: 'Xem',
        search: 'T√¨m ki·∫øm',
        filter: 'L·ªçc',
        clear: 'X√≥a',
        refresh: 'L√†m m·ªõi',
        export: 'Xu·∫•t',
        import: 'Nh·∫≠p',
        settings: 'C√†i ƒë·∫∑t',
        profile: 'H·ªì s∆°',
        logout: 'ƒêƒÉng xu·∫•t',
        login: 'ƒêƒÉng nh·∫≠p',
        register: 'ƒêƒÉng k√Ω',
        confirm: 'X√°c nh·∫≠n',
        close: 'ƒê√≥ng',
        back: 'Quay l·∫°i',
        next: 'Ti·∫øp theo',
        previous: 'Tr∆∞·ªõc',
        submit: 'G·ª≠i',
        reset: 'ƒê·∫∑t l·∫°i',
        select: 'Ch·ªçn',
        all: 'T·∫•t c·∫£',
        none: 'Kh√¥ng c√≥'
      },
      
      // Navigation
      navigation: {
        dashboard: 'B·∫£ng ƒëi·ªÅu khi·ªÉn',
        dataProducts: 'S·∫£n ph·∫©m d·ªØ li·ªáu',
        dataMesh: 'L∆∞·ªõi d·ªØ li·ªáu',
        domainCatalog: 'Danh m·ª•c mi·ªÅn',
        marketplace: 'Ch·ª£ d·ªØ li·ªáu',
        explore: 'Kh√°m ph√°',
        governance: 'Qu·∫£n tr·ªã',
        observability: 'Quan s√°t',
        settings: 'C√†i ƒë·∫∑t',
        profile: 'H·ªì s∆°',
        help: 'Tr·ª£ gi√∫p'
      },

      // Domain Catalog
      domainCatalog: {
        title: 'Danh m·ª•c mi·ªÅn d·ªØ li·ªáu',
        subtitle: 'Kh√°m ph√° v√† t√¨m hi·ªÉu c√°c mi·ªÅn d·ªØ li·ªáu trong t·ªï ch·ª©c c·ªßa b·∫°n. Duy·ªát qua c√°c s·∫£n ph·∫©m d·ªØ li·ªáu, API v√† ch√≠nh s√°ch qu·∫£n tr·ªã theo mi·ªÅn c·ª• th·ªÉ.',
        totalDomains: 'T·ªïng s·ªë mi·ªÅn',
        activeDomains: 'Mi·ªÅn ho·∫°t ƒë·ªông',
        dataProducts: 'S·∫£n ph·∫©m d·ªØ li·ªáu',
        systemHealth: 'T√¨nh tr·∫°ng h·ªá th·ªëng',
        excellent: 'Xu·∫•t s·∫Øc',
        healthy: 'T·ªët',
        searchPlaceholder: 'T√¨m ki·∫øm theo t√™n, m√¥ t·∫£ ho·∫∑c th·∫ª...',
        allStatus: 'T·∫•t c·∫£ tr·∫°ng th√°i',
        allTeams: 'T·∫•t c·∫£ nh√≥m',
        clearFilters: 'X√≥a b·ªô l·ªçc',
        gridView: 'D·∫°ng l∆∞·ªõi',
        listView: 'D·∫°ng danh s√°ch',
        domainPortfolio: 'Danh m·ª•c mi·ªÅn',
        domains: 'mi·ªÅn',
        domain: 'mi·ªÅn',
        viewDetails: 'Xem chi ti·∫øt',
        products: 'S·∫£n ph·∫©m',
        quality: 'Ch·∫•t l∆∞·ª£ng',
        subscribers: 'Ng∆∞·ªùi ƒëƒÉng k√Ω',
        uptime: 'Th·ªùi gian ho·∫°t ƒë·ªông',
        team: 'Nh√≥m',
        owner: 'Ch·ªß s·ªü h·ªØu',
        unassigned: 'Ch∆∞a ph√¢n c√¥ng',
        tbd: 'Ch∆∞a x√°c ƒë·ªãnh',
        noDomainsFound: 'Kh√¥ng t√¨m th·∫•y mi·ªÅn n√†o',
        noDomainsMessage: 'Ch√∫ng t√¥i kh√¥ng th·ªÉ t√¨m th·∫•y mi·ªÅn n√†o ph√π h·ª£p v·ªõi ti√™u ch√≠ t√¨m ki·∫øm c·ªßa b·∫°n. H√£y th·ª≠ ƒëi·ªÅu ch·ªânh b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm.',
        addDomain: 'Th√™m mi·ªÅn',
        lastUpdated: 'C·∫≠p nh·∫≠t l·∫ßn cu·ªëi',
        allSystemsOperational: 'T·∫•t c·∫£ h·ªá th·ªëng ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng',
        thisWeek: 'tu·∫ßn n√†y',
        acrossDomains: 'tr√™n c√°c mi·ªÅn'
      },

      // Data Products
      dataProduct: {
        title: 'S·∫£n ph·∫©m d·ªØ li·ªáu',
        name: 'T√™n',
        description: 'M√¥ t·∫£',
        domain: 'Mi·ªÅn',
        owner: 'Ch·ªß s·ªü h·ªØu',
        status: 'Tr·∫°ng th√°i',
        version: 'Phi√™n b·∫£n',
        type: 'Lo·∫°i',
        tags: 'Th·∫ª',
        created: 'T·∫°o l√∫c',
        updated: 'C·∫≠p nh·∫≠t l√∫c',
        qualityScore: 'ƒêi·ªÉm ch·∫•t l∆∞·ª£ng',
        subscribers: 'Ng∆∞·ªùi ƒëƒÉng k√Ω',
        apis: 'APIs',
        documentation: 'T√†i li·ªáu',
        schema: 'L∆∞·ª£c ƒë·ªì',
        metrics: 'S·ªë li·ªáu',
        overview: 'T·ªïng quan',
        details: 'Chi ti·∫øt',
        api: 'API',
        swagger: 'Swagger',
        subscribe: 'ƒêƒÉng k√Ω',
        unsubscribe: 'H·ªßy ƒëƒÉng k√Ω',
        
        // Hotel-specific translations
        hotel: {
          title: 'H·ªá th·ªëng qu·∫£n l√Ω kh√°ch s·∫°n',
          description: 'Gi·∫£i ph√°p d·ªØ li·ªáu t√≠ch h·ª£p cho qu·∫£n l√Ω kh√°ch s·∫°n',
          features: {
            apartments: 'Qu·∫£n l√Ω cƒÉn h·ªô',
            rooms: 'Qu·∫£n l√Ω ph√≤ng',
            bookings: 'H·ªá th·ªëng ƒë·∫∑t ph√≤ng',
            ratings: 'ƒê√°nh gi√°',
            reviews: 'Nh·∫≠n x√©t',
            metadata: 'Th√¥ng tin meta'
          },
          endpoints: {
            create: 'T·∫°o m·ªõi',
            read: 'Xem',
            update: 'C·∫≠p nh·∫≠t',
            delete: 'X√≥a',
            list: 'Danh s√°ch',
            cancel: 'H·ªßy',
            version: 'Phi√™n b·∫£n',
            overview: 'T·ªïng quan',
            quality: 'Ch·∫•t l∆∞·ª£ng',
            cost: 'Chi ph√≠',
            features: 'T√≠nh nƒÉng',
            summary: 'T√≥m t·∫Øt',
            healthCheck: 'Ki·ªÉm tra s·ª©c kh·ªèe'
          },
          actions: {
            testEndpoint: 'Ki·ªÉm tra endpoint',
            copyUrl: 'Sao ch√©p URL',
            viewSwagger: 'Xem Swagger',
            downloadSchema: 'T·∫£i xu·ªëng schema'
          }
        }
      },

      // Settings
      settings: {
        title: 'C√†i ƒë·∫∑t',
        general: 'Chung',
        language: 'Ng√¥n ng·ªØ',
        theme: 'Giao di·ªán',
        notifications: 'Th√¥ng b√°o',
        privacy: 'Quy·ªÅn ri√™ng t∆∞',
        security: 'B·∫£o m·∫≠t',
        account: 'T√†i kho·∫£n',
        preferences: 'T√πy ch·ªçn',
        selectLanguage: 'Ch·ªçn ng√¥n ng·ªØ',
        vietnamese: 'Ti·∫øng Vi·ªát',
        english: 'English'
      },

      // Status
      status: {
        active: 'Ho·∫°t ƒë·ªông',
        inactive: 'Kh√¥ng ho·∫°t ƒë·ªông',
        pending: 'ƒêang ch·ªù',
        approved: 'ƒê√£ duy·ªát',
        rejected: 'B·ªã t·ª´ ch·ªëi',
        draft: 'B·∫£n nh√°p',
        published: 'ƒê√£ xu·∫•t b·∫£n',
        archived: 'ƒê√£ l∆∞u tr·ªØ',
        deprecated: 'Kh√¥ng d√πng n·ªØa',
        maintenance: 'B·∫£o tr√¨'
      },

      // Messages
      messages: {
        success: 'Th√†nh c√¥ng',
        error: 'L·ªói',
        warning: 'C·∫£nh b√°o',
        info: 'Th√¥ng tin',
        loadingError: 'C√≥ l·ªói x·∫£y ra khi t·∫£i d·ªØ li·ªáu',
        saveSuccess: 'L∆∞u th√†nh c√¥ng',
        deleteSuccess: 'X√≥a th√†nh c√¥ng',
        updateSuccess: 'C·∫≠p nh·∫≠t th√†nh c√¥ng',
        noDataFound: 'Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu'
      },

      // Profile
      profile: {
        title: 'H·ªì s∆° c√° nh√¢n',
        subtitle: 'Qu·∫£n l√Ω th√¥ng tin t√†i kho·∫£n v√† t√πy ch·ªçn c√° nh√¢n',
        
        // Account section
        account: {
          title: 'Th√¥ng tin t√†i kho·∫£n',
          subtitle: 'Th√¥ng tin c√° nh√¢n v√† chi ti·∫øt li√™n h·ªá',
          fullName: 'H·ªç v√† t√™n',
          email: 'ƒê·ªãa ch·ªâ email',
          phone: 'S·ªë ƒëi·ªán tho·∫°i',
          userId: 'M√£ ng∆∞·ªùi d√πng',
          status: 'Tr·∫°ng th√°i',
          role: 'Vai tr√≤',
          verified: 'ƒê√£ x√°c minh'
        },

        // User management section
        users: {
          title: 'Qu·∫£n l√Ω ng∆∞·ªùi d√πng',
          subtitle: 'Xem v√† qu·∫£n l√Ω t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng',
          user: 'Ng∆∞·ªùi d√πng',
          fullName: 'H·ªç v√† t√™n',
          email: 'Email',
          role: 'Vai tr√≤',
          status: 'Tr·∫°ng th√°i',
          joinedDate: 'Ng√†y tham gia',
          totalUsers: 'ng∆∞·ªùi d√πng',
          searchPlaceholder: 'T√¨m ki·∫øm ng∆∞·ªùi d√πng...',
          noUsers: 'Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o',
          noUsersMessage: 'Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o ƒë∆∞·ª£c t√¨m th·∫•y.',
          active: 'Ho·∫°t ƒë·ªông',
          inactive: 'Kh√¥ng ho·∫°t ƒë·ªông'
        },

        // Security section
        security: {
          title: 'B·∫£o m·∫≠t & Quy·ªÅn ri√™ng t∆∞',
          subtitle: 'Qu·∫£n l√Ω c√†i ƒë·∫∑t b·∫£o m·∫≠t t√†i kho·∫£n',
          password: 'M·∫≠t kh·∫©u',
          passwordSubtitle: 'Thay ƒë·ªïi l·∫ßn cu·ªëi 30 ng√†y tr∆∞·ªõc',
          changePassword: 'ƒê·ªïi m·∫≠t kh·∫©u',
          twoFactor: 'X√°c th·ª±c hai y·∫øu t·ªë',
          enabled: 'ƒê√£ b·∫≠t',
          disabled: 'ƒê√£ t·∫Øt',
          enable: 'B·∫≠t',
          disable: 'T·∫Øt',
          privacy: 'C√†i ƒë·∫∑t quy·ªÅn ri√™ng t∆∞',
          privacySubtitle: 'Ki·ªÉm so√°t kh·∫£ nƒÉng hi·ªÉn th·ªã d·ªØ li·ªáu',
          manage: 'Qu·∫£n l√Ω',
          dataExport: 'Xu·∫•t d·ªØ li·ªáu',
          dataExportSubtitle: 'T·∫£i xu·ªëng d·ªØ li·ªáu c·ªßa b·∫°n',
          export: 'Xu·∫•t'
        },

        // Actions section
        actions: {
          title: 'H√†nh ƒë·ªông nhanh',
          subtitle: 'C√°c t√°c v·ª• qu·∫£n l√Ω t√†i kho·∫£n ph·ªï bi·∫øn',
          editProfile: 'Ch·ªânh s·ª≠a h·ªì s∆°',
          changePassword: 'ƒê·ªïi m·∫≠t kh·∫©u',
          settings: 'C√†i ƒë·∫∑t t√†i kho·∫£n',
          downloadData: 'T·∫£i xu·ªëng d·ªØ li·ªáu',
          refresh: 'L√†m m·ªõi'
        },

        // Sessions section
        sessions: {
          title: 'Phi√™n ƒëang ho·∫°t ƒë·ªông',
          subtitle: 'Qu·∫£n l√Ω c√°c phi√™n ƒëƒÉng nh·∫≠p ƒëang ho·∫°t ƒë·ªông',
          count: 'phi√™n',
          sessionNumber: 'Phi√™n',
          active: 'Ho·∫°t ƒë·ªông',
          sessionId: 'M√£ phi√™n',
          expiresIn: 'H·∫øt h·∫°n sau',
          location: 'V·ªã tr√≠',
          lastActivity: 'Ho·∫°t ƒë·ªông cu·ªëi c√πng',
          terminate: 'K·∫øt th√∫c'
        },

        // Role display
        roles: {
          admin: 'Qu·∫£n tr·ªã vi√™n',
          manager: 'Qu·∫£n l√Ω',
          analyst: 'Ph√¢n t√≠ch vi√™n d·ªØ li·ªáu',
          viewer: 'Ng∆∞·ªùi xem',
          user: 'Ng∆∞·ªùi d√πng'
        },

        // Status display
        statusDisplay: {
          active: 'T√†i kho·∫£n ho·∫°t ƒë·ªông',
          inactive: 'T√†i kho·∫£n kh√¥ng ho·∫°t ƒë·ªông',
          verified: 'Email ƒë√£ x√°c minh',
          unverified: 'Email ch∆∞a x√°c minh'
        },

        // Stats
        stats: {
          userId: 'M√£ ng∆∞·ªùi d√πng',
          activeSessions: 'Phi√™n ho·∫°t ƒë·ªông',
          memberSince: 'Th√†nh vi√™n t·ª´'
        },

        // Footer
        footer: {
          lastUpdated: 'C·∫≠p nh·∫≠t l·∫ßn cu·ªëi',
          needHelp: 'C·∫ßn tr·ª£ gi√∫p?',
          contactSupport: 'Li√™n h·ªá h·ªó tr·ª£'
        }
      }
    },

    en: {
      // Common
      common: {
        loading: 'Loading...',
        save: 'Save',
        cancel: 'Cancel',
        delete: 'Delete',
        edit: 'Edit',
        view: 'View',
        search: 'Search',
        filter: 'Filter',
        clear: 'Clear',
        refresh: 'Refresh',
        export: 'Export',
        import: 'Import',
        settings: 'Settings',
        profile: 'Profile',
        logout: 'Logout',
        login: 'Login',
        register: 'Register',
        confirm: 'Confirm',
        close: 'Close',
        back: 'Back',
        next: 'Next',
        previous: 'Previous',
        submit: 'Submit',
        reset: 'Reset',
        select: 'Select',
        all: 'All',
        notProvided: 'Not provided',
        unknown: 'Unknown',
        justNow: 'Just now',
        pagination: 'Showing {first} to {last} of {totalRecords} entries'
      },

      // Navigation
      nav: {
        dashboard: 'Dashboard',
        dataMesh: 'Data Mesh',
        domainCatalog: 'Domain Catalog',
        dataProducts: 'Data Products',
        governance: 'Governance',
        observability: 'Observability',
        discovery: 'Discovery',
        explore: 'Explore',
        settings: 'Settings',
        profile: 'Profile',
        logout: 'Logout',
        search: 'Search...',
        notifications: 'Notifications',
        help: 'Help',
        dataContracts: 'Data Contracts'
      },

      // Language
      language: {
        current: 'English',
        vietnamese: 'Vietnamese',
        english: 'English',
        switchTo: 'Switch to'
      },

      // Actions
      actions: {
        create: 'Create',
        edit: 'Edit',
        delete: 'Delete',
        view: 'View',
        save: 'Save',
        cancel: 'Cancel',
        search: 'Search',
        filter: 'Filter',
        export: 'Export',
        refresh: 'Refresh',
        loadMore: 'Load More',
        showAll: 'Show All',
        collapseAll: 'Collapse All',
        expandAll: 'Expand All'
      },

      // Status
      status: {
        active: 'Active',
        inactive: 'Inactive',
        pending: 'Pending',
        approved: 'Approved',
        rejected: 'Rejected',
        draft: 'Draft',
        published: 'Published',
        archived: 'Archived',
        deprecated: 'Deprecated',
        maintenance: 'Maintenance'
      },

      // Messages
      messages: {
        success: 'Success',
        error: 'Error',
        warning: 'Warning',
        info: 'Information',
        loadingError: 'An error occurred while loading data',
        saveSuccess: 'Successfully saved',
        deleteSuccess: 'Successfully deleted',
        updateSuccess: 'Successfully updated',
        noDataFound: 'No data found'
      },

      // Data Products
      dataProduct: {
        title: 'Data Products',
        name: 'Name',
        description: 'Description',
        domain: 'Domain',
        owner: 'Owner',
        status: 'Status',
        version: 'Version',
        type: 'Type',
        tags: 'Tags',
        created: 'Created',
        updated: 'Updated',
        qualityScore: 'Quality Score',
        subscribers: 'Subscribers',
        apis: 'APIs',
        documentation: 'Documentation',
        schema: 'Schema',
        metrics: 'Metrics',
        overview: 'Overview',
        details: 'Details',
        api: 'API',
        swagger: 'Swagger',
        subscribe: 'Subscribe',
        unsubscribe: 'Unsubscribe',
        
        // Hotel-specific translations
        hotel: {
          title: 'Hotel Management System',
          description: 'Integrated data solution for hotel management',
          features: {
            apartments: 'Apartment Management',
            rooms: 'Room Management',
            bookings: 'Booking System',
            ratings: 'Ratings',
            reviews: 'Reviews',
            metadata: 'Metadata'
          },
          endpoints: {
            create: 'Create',
            read: 'Read',
            update: 'Update',
            delete: 'Delete',
            list: 'List',
            cancel: 'Cancel',
            version: 'Version',
            overview: 'Overview',
            quality: 'Quality',
            cost: 'Cost',
            features: 'Features',
            summary: 'Summary',
            healthCheck: 'Health Check'
          },
          actions: {
            testEndpoint: 'Test Endpoint',
            copyUrl: 'Copy URL',
            viewSwagger: 'View Swagger',
            downloadSchema: 'Download Schema'
          }
        }
      },

      // Profile
      profile: {
        title: 'My Profile',
        subtitle: 'Manage your account information and preferences',
        
        // Account section
        account: {
          title: 'Account Information',
          subtitle: 'Your personal details and contact information',
          fullName: 'Full Name',
          email: 'Email Address',
          phone: 'Phone Number',
          userId: 'User ID',
          status: 'Status',
          role: 'Role',
          verified: 'Verified'
        },

        // User management section
        users: {
          title: 'User Management',
          subtitle: 'View and manage all users in the system',
          user: 'User',
          fullName: 'Full Name',
          email: 'Email',
          role: 'Role',
          status: 'Status',
          joinedDate: 'Joined Date',
          totalUsers: 'users',
          searchPlaceholder: 'Search users...',
          noUsers: 'No Users Found',
          noUsersMessage: 'No users were found.',
          active: 'Active',
          inactive: 'Inactive'
        },

        // Security section
        security: {
          title: 'Security & Privacy',
          subtitle: 'Manage your account security settings',
          password: 'Password',
          passwordSubtitle: 'Last changed 30 days ago',
          changePassword: 'Change',
          twoFactor: 'Two-Factor Authentication',
          enabled: 'Enabled',
          disabled: 'Disabled',
          enable: 'Enable',
          disable: 'Disable',
          privacy: 'Privacy Settings',
          privacySubtitle: 'Control your data visibility',
          manage: 'Manage',
          dataExport: 'Data Export',
          dataExportSubtitle: 'Download your data',
          export: 'Export'
        },

        // Actions section
        actions: {
          title: 'Quick Actions',
          subtitle: 'Common account management tasks',
          editProfile: 'Edit Profile',
          changePassword: 'Change Password',
          settings: 'Account Settings',
          downloadData: 'Download Data',
          refresh: 'Refresh'
        },

        // Sessions section
        sessions: {
          title: 'Active Sessions',
          subtitle: 'Manage your active login sessions',
          count: 'session(s)',
          sessionNumber: 'Session',
          active: 'Active',
          sessionId: 'Session ID',
          expiresIn: 'Expires in',
          location: 'Location',
          lastActivity: 'Last activity',
          terminate: 'Terminate'
        },

        // Role display
        roles: {
          admin: 'Administrator',
          manager: 'Manager',
          analyst: 'Data Analyst',
          viewer: 'Viewer',
          user: 'User'
        },

        // Status display
        statusDisplay: {
          active: 'Active Account',
          inactive: 'Inactive Account',
          verified: 'Email Verified',
          unverified: 'Email Not Verified'
        },

        // Stats
        stats: {
          userId: 'User ID',
          activeSessions: 'Active Sessions',
          memberSince: 'Member Since'
        },

        // Footer
        footer: {
          lastUpdated: 'Last updated',
          needHelp: 'Need help?',
          contactSupport: 'Contact Support'
        }
      }
    }
  };

  public availableLanguages: Language[] = [
    { code: 'vi', name: 'Ti·∫øng Vi·ªát', flag: 'üáªüá≥' },
    { code: 'en', name: 'English', flag: 'üá∫üá∏' }
  ];

  constructor() {
    // Load saved language from localStorage or default to Vietnamese
    const savedLang = localStorage.getItem('app-language') || 'vi';
    this.setLanguage(savedLang);
  }

  getCurrentLanguage(): string {
    return this.currentLanguageSubject.value;
  }

  setLanguage(languageCode: string): void {
    if (this.translations[languageCode]) {
      this.currentLanguageSubject.next(languageCode);
      localStorage.setItem('app-language', languageCode);
    }
  }

  translate(key: string): string {
    const currentLang = this.getCurrentLanguage();
    const keys = key.split('.');
    let translation: any = this.translations[currentLang];

    for (const k of keys) {
      if (translation && typeof translation === 'object' && k in translation) {
        translation = translation[k];
      } else {
        // Fallback to English if key not found in current language
        translation = this.translations['en'];
        for (const fallbackKey of keys) {
          if (translation && typeof translation === 'object' && fallbackKey in translation) {
            translation = translation[fallbackKey];
          } else {
            return key; // Return the key itself if translation not found
          }
        }
        break;
      }
    }

    return typeof translation === 'string' ? translation : key;
  }

  // Get all translations for a specific namespace
  getTranslations(namespace: string): TranslationKey {
    const currentLang = this.getCurrentLanguage();
    const translations = this.translations[currentLang];
    return translations[namespace] as TranslationKey || {};
  }
}
