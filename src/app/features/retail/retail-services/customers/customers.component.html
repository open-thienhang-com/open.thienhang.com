<p-toast></p-toast>

<div class="bg-gray-50 min-h-screen p-6">
  <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-br from-violet-500 to-indigo-600 rounded-lg flex items-center justify-center">
          <i class="pi pi-users text-white text-xl"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Customer Management</h1>
          <p class="text-gray-600">Manage retail customers from Retail Domain API</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <p-button
          icon="pi pi-refresh"
          severity="info"
          [outlined]="true"
          [rounded]="true"
          (onClick)="loadCustomers()"
          pTooltip="Refresh"
          class="hidden sm:inline-flex">
        </p-button>
        <p-button label="Add Customer" icon="pi pi-plus" severity="primary" (onClick)="createCustomer()"></p-button>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Customers</p>
          <p class="text-3xl font-bold text-gray-900">{{ customers.length }}</p>
        </div>
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="pi pi-users text-blue-600 text-xl"></i>
        </div>
      </div>
    </div>
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Active Customers</p>
          <p class="text-3xl font-bold text-green-600">{{ getActiveCustomersCount() }}</p>
        </div>
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
          <i class="pi pi-check-circle text-green-600 text-xl"></i>
        </div>
      </div>
    </div>
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Customer Types</p>
          <p class="text-3xl font-bold text-indigo-600">{{ typeOptions.length - 1 }}</p>
        </div>
        <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
          <i class="pi pi-sitemap text-indigo-600 text-xl"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-sm mb-6">
    <div class="p-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search"></i>
            <input pInputText [(ngModel)]="searchTerm" (input)="applyFilters()" placeholder="Search by name, phone, email..." class="w-full" />
          </span>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
          <p-dropdown [(ngModel)]="selectedStatus" [options]="statusOptions" optionLabel="label" optionValue="value" (onChange)="applyFilters()" class="w-full"></p-dropdown>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Customer Type</label>
          <p-dropdown [(ngModel)]="selectedType" [options]="typeOptions" optionLabel="label" optionValue="value" (onChange)="applyFilters()" class="w-full"></p-dropdown>
        </div>

        <div class="flex items-end">
          <p-button label="Clear Filters" icon="pi pi-times" severity="secondary" [outlined]="true" (onClick)="clearFilters()"></p-button>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-900">Customer List ({{ filteredCustomers.length }})</h2>
      <p class="text-sm text-gray-500">Source: Retail Domain API</p>
    </div>

    <div class="bg-white rounded-xl border border-gray-200 p-10 text-center" *ngIf="loading">
      <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
        <i class="pi pi-spin pi-spinner text-blue-500 text-xl"></i>
      </div>
      <p class="text-gray-600">Loading customers...</p>
    </div>

    <p-table
      *ngIf="!loading"
      [value]="filteredCustomers"
      [paginator]="true"
      [rows]="10"
      styleClass="p-datatable-sm"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} customers">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Customer Type</th>
          <th>Status</th>
          <th>Updated At</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <div class="font-semibold text-gray-900">{{ item.name }}</div>
            <div class="text-xs text-gray-500 mt-0.5">{{ item.address || '-' }}</div>
          </td>
          <td>{{ item.phone || '-' }}</td>
          <td>{{ item.email || '-' }}</td>
          <td>{{ item.customerType || '-' }}</td>
          <td>
            <p-badge [value]="getStatusLabel(item.isActive)" [severity]="getStatusSeverity(item.isActive)"></p-badge>
          </td>
          <td>{{ item.updatedAt | date: 'short' }}</td>
          <td>
            <div class="flex gap-1">
              <p-button icon="pi pi-eye" [outlined]="true" size="small" (onClick)="viewCustomer(item)"></p-button>
              <p-button icon="pi pi-pencil" [outlined]="true" size="small" (onClick)="editCustomer(item)"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center py-12 text-gray-500">No customers found</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog
    [(visible)]="showCustomerDialog"
    [header]="dialogMode === 'create' ? 'Add Customer' : (dialogMode === 'edit' ? 'Edit Customer' : 'Customer Detail')"
    [modal]="true"
    [style]="{ width: '680px' }"
    [closable]="!saving">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" *ngIf="editingCustomer">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
        <input pInputText [(ngModel)]="editingCustomer.name" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Customer name">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Type *</label>
        <input pInputText [(ngModel)]="editingCustomer.customerType" [disabled]="dialogMode === 'view'" class="w-full" placeholder="e.g. retail, vip">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
        <input pInputText [(ngModel)]="editingCustomer.phone" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Phone number">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
        <input pInputText [(ngModel)]="editingCustomer.email" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Email">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
        <p-dropdown [(ngModel)]="editingCustomer.isActive" [options]="dialogStatusOptions" optionLabel="label" optionValue="value" [disabled]="dialogMode === 'view'" class="w-full"></p-dropdown>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Created At</label>
        <input pInputText [ngModel]="editingCustomer.createdAt | date:'medium'" disabled class="w-full" />
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-2">Address *</label>
        <textarea pInputTextarea [(ngModel)]="editingCustomer.address" [disabled]="dialogMode === 'view'" rows="3" class="w-full" placeholder="Address"></textarea>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Updated At</label>
        <input pInputText [ngModel]="editingCustomer.updatedAt | date:'medium'" disabled class="w-full" />
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button label="Close" [outlined]="true" [disabled]="saving" (onClick)="cancelEdit()"></p-button>
      <p-button *ngIf="dialogMode !== 'view'" label="Save" icon="pi pi-check" [loading]="saving" (onClick)="saveCustomer()"></p-button>
    </ng-template>
  </p-dialog>
</div>
