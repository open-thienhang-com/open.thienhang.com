<!-- Inventory Movements Management (Inbound/Outbound) -->
<div class="movements-container">
  <div class="header-section">
    <div class="header-content">
      <h1><i class="pi pi-exchange"></i> Inventory Movements</h1>
      <p>Manage inbound purchases and outbound sales transactions</p>
    </div>
    <div class="header-actions">
      <p-button
        label="New Movement"
        icon="pi pi-plus"
        (onClick)="createMovement()">
      </p-button>
      <p-button
        label="Export"
        icon="pi pi-download"
        [outlined]="true"
        (onClick)="exportMovements()">
      </p-button>
      <p-button
        label="Refresh"
        icon="pi pi-refresh"
        [outlined]="true"
        (onClick)="refreshData()">
      </p-button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-item">
        <label>Search</label>
        <input
          pInputText
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
          placeholder="Search by product, reference..."
          class="search-input">
      </div>

      <div class="filter-item">
        <label>Type</label>
        <p-dropdown
          [(ngModel)]="selectedType"
          [options]="movementTypes"
          optionLabel="label"
          optionValue="value"
          placeholder="All Types"
          (onChange)="applyFilters()">
        </p-dropdown>
      </div>

      <div class="filter-item">
        <label>Status</label>
        <p-dropdown
          [(ngModel)]="selectedStatus"
          [options]="statusOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="All Status"
          (onChange)="applyFilters()">
        </p-dropdown>
      </div>

      <div class="filter-item">
        <label>Date Range</label>
        <p-calendar
          [(ngModel)]="selectedDateRange"
          selectionMode="range"
          [readonlyInput]="true"
          placeholder="Select date range"
          (onSelect)="applyFilters()"
          (onClear)="applyFilters()">
        </p-calendar>
      </div>

      <div class="filter-actions">
        <p-button
          label="Clear Filters"
          [outlined]="true"
          size="small"
          (onClick)="clearFilters()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="pi pi-arrow-down"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ getInboundCount() }}</div>
        <div class="stat-label">Inbound Movements</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="pi pi-arrow-up"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ getOutboundCount() }}</div>
        <div class="stat-label">Outbound Movements</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="pi pi-clock"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ getPendingCount() }}</div>
        <div class="stat-label">Pending Movements</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="pi pi-dollar"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ formatCurrency(getTotalValue()) }}</div>
        <div class="stat-label">Total Movement Value</div>
      </div>
    </div>
  </div>

  <!-- Movements Table -->
  <div class="movements-table-section">
    <p-table
      [value]="filteredMovements"
      styleClass="p-datatable-sm"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} movements">
      <ng-template pTemplate="header">
        <tr>
          <th>Type</th>
          <th>Product</th>
          <th>Reference</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Total Value</th>
          <th>Party</th>
          <th>Location</th>
          <th>Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-movement>
        <tr>
          <td>
            <p-badge
              [value]="movement.type.toUpperCase()"
              [severity]="getMovementSeverity(movement.type)">
            </p-badge>
          </td>
          <td>
            <div class="product-info">
              <div class="product-name">{{ movement.productName }}</div>
              <div class="product-reference">{{ movement.reference }}</div>
            </div>
          </td>
          <td>{{ movement.reference }}</td>
          <td>
            <span [class]="movement.quantity >= 0 ? 'positive' : 'negative'">
              {{ movement.quantity >= 0 ? '+' : '' }}{{ movement.quantity }}
            </span>
          </td>
          <td>{{ formatCurrency(movement.unitPrice) }}</td>
          <td>{{ formatCurrency(movement.totalValue) }}</td>
          <td>
            <div class="party-info">
              <span *ngIf="movement.type === 'inbound'">{{ movement.supplier }}</span>
              <span *ngIf="movement.type === 'outbound'">{{ movement.customer }}</span>
            </div>
          </td>
          <td>{{ movement.location }}</td>
          <td>{{ formatDate(movement.date) }}</td>
          <td>
            <p-badge
              [value]="movement.status"
              [severity]="getStatusSeverity(movement.status)">
            </p-badge>
          </td>
          <td>
            <div class="action-buttons">
              <p-button
                *ngIf="movement.status === 'pending'"
                icon="pi pi-check"
                [outlined]="true"
                size="small"
                (onClick)="confirmMovement(movement)"
                pTooltip="Confirm Movement">
              </p-button>
              <p-button
                icon="pi pi-pencil"
                [outlined]="true"
                size="small"
                (onClick)="editMovement(movement)"
                pTooltip="Edit Movement">
              </p-button>
              <p-button
                *ngIf="movement.status === 'pending'"
                icon="pi pi-times"
                [outlined]="true"
                severity="danger"
                size="small"
                (onClick)="cancelMovement(movement)"
                pTooltip="Cancel Movement">
              </p-button>
              <p-button
                icon="pi pi-trash"
                [outlined]="true"
                severity="danger"
                size="small"
                (onClick)="deleteMovement(movement)"
                pTooltip="Delete Movement">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="11" class="empty-message">
            <div class="empty-content">
              <i class="pi pi-exchange"></i>
              <p>No movements found</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Movement Dialog -->
  <p-dialog
    [(visible)]="showMovementDialog"
    [header]="editingMovement?.id ? 'Edit Movement' : 'New Movement'"
    [modal]="true"
    [style]="{width: '700px'}"
    [closable]="true">
    <div class="movement-form" *ngIf="editingMovement">
      <div class="form-grid">
        <div class="form-field">
          <label for="type">Movement Type *</label>
          <p-dropdown
            [(ngModel)]="editingMovement.type"
            [options]="movementTypes"
            optionLabel="label"
            optionValue="value"
            placeholder="Select type">
          </p-dropdown>
        </div>

        <div class="form-field">
          <label for="product">Product *</label>
          <p-dropdown
            [(ngModel)]="editingMovement.productId"
            [options]="products"
            optionLabel="name"
            optionValue="id"
            placeholder="Select product"
            (onChange)="onProductChange()">
          </p-dropdown>
        </div>

        <div class="form-field">
          <label for="reference">Reference Number *</label>
          <input
            pInputText
            id="reference"
            [(ngModel)]="editingMovement.reference"
            placeholder="PO/SO number"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="quantity">Quantity *</label>
          <input
            pInputText
            id="quantity"
            [(ngModel)]="editingMovement.quantity"
            type="number"
            placeholder="0"
            (input)="onQuantityChange()"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="unitPrice">Unit Price *</label>
          <input
            pInputText
            id="unitPrice"
            [(ngModel)]="editingMovement.unitPrice"
            type="number"
            step="0.01"
            placeholder="0.00"
            (input)="onUnitPriceChange()"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="totalValue">Total Value</label>
          <input
            pInputText
            [(ngModel)]="editingMovement.totalValue"
            readonly
            class="form-input readonly">
        </div>

        <div class="form-field" *ngIf="editingMovement.type === 'inbound'">
          <label for="supplier">Supplier *</label>
          <p-dropdown
            [(ngModel)]="editingMovement.supplier"
            [options]="suppliers"
            optionLabel="name"
            optionValue="name"
            placeholder="Select supplier">
          </p-dropdown>
        </div>

        <div class="form-field" *ngIf="editingMovement.type === 'outbound'">
          <label for="customer">Customer *</label>
          <p-dropdown
            [(ngModel)]="editingMovement.customer"
            [options]="customers"
            optionLabel="name"
            optionValue="name"
            placeholder="Select customer">
          </p-dropdown>
        </div>

        <div class="form-field">
          <label for="location">Location *</label>
          <p-dropdown
            [(ngModel)]="editingMovement.location"
            [options]="locations"
            optionLabel="name"
            optionValue="name"
            placeholder="Select location">
          </p-dropdown>
        </div>

        <div class="form-field">
          <label for="date">Date *</label>
          <p-calendar
            [(ngModel)]="editingMovement.date"
            [showIcon]="true"
            inputId="date">
          </p-calendar>
        </div>

        <div class="form-field">
          <label for="status">Status</label>
          <p-dropdown
            [(ngModel)]="editingMovement.status"
            [options]="statusOptions"
            optionLabel="label"
            optionValue="value">
          </p-dropdown>
        </div>

        <div class="form-field full-width">
          <label for="notes">Notes</label>
          <textarea
            pInputTextarea
            [(ngModel)]="editingMovement.notes"
            placeholder="Additional notes..."
            rows="3"
            class="form-textarea">
          </textarea>
        </div>

        <div class="form-field full-width">
          <label>Attachments</label>
          <p-fileUpload
            mode="basic"
            chooseLabel="Choose Files"
            [multiple]="true"
            accept="image/*,.pdf,.doc,.docx"
            maxFileSize="1000000">
          </p-fileUpload>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        [outlined]="true"
        (onClick)="cancelEdit()">
      </p-button>
      <p-button
        label="Save"
        icon="pi pi-check"
        severity="success"
        (onClick)="saveMovement()"
        [disabled]="!editingMovement?.type || !editingMovement?.productId || !editingMovement?.reference || !editingMovement?.quantity || !editingMovement?.unitPrice">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
