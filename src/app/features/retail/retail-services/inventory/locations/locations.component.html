<p-toast></p-toast>

<div class="bg-gray-50 min-h-screen p-6">
  <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center">
          <i class="pi pi-map-marker text-white text-xl"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Inventory Locations</h1>
          <p class="text-gray-600">Manage warehouses from Retail API</p>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2 sm:gap-3">
        <p-button
          icon="pi pi-download"
          severity="secondary"
          [outlined]="true"
          [rounded]="true"
          (onClick)="exportLocations()"
          pTooltip="Export"
          class="hidden sm:inline-flex">
        </p-button>
        <p-button
          icon="pi pi-refresh"
          severity="info"
          [outlined]="true"
          [rounded]="true"
          (onClick)="refreshData()"
          pTooltip="Refresh"
          class="hidden sm:inline-flex">
        </p-button>
        <p-button
          label="Add Location"
          icon="pi pi-plus"
          severity="primary"
          (onClick)="createLocation()">
        </p-button>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Locations</p>
          <p class="text-3xl font-bold text-gray-900">{{ locations.length }}</p>
        </div>
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="pi pi-building text-blue-600 text-xl"></i>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Active Locations</p>
          <p class="text-3xl font-bold text-green-600">{{ getActiveLocationsCount() }}</p>
        </div>
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
          <i class="pi pi-check-circle text-green-600 text-xl"></i>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Capacity</p>
          <p class="text-3xl font-bold text-purple-600">{{ formatNumber(getTotalCapacity()) }}</p>
        </div>
        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
          <i class="pi pi-chart-bar text-purple-600 text-xl"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-sm mb-6">
    <div class="p-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search"></i>
            <input pInputText [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Search by name, location, city..." class="w-full" />
          </span>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
          <p-dropdown [(ngModel)]="selectedStatus" [options]="statusOptions" optionLabel="label" optionValue="value" (onChange)="onStatusChange()" class="w-full"></p-dropdown>
        </div>

        <div class="flex items-end">
          <p-button label="Clear Filters" icon="pi pi-times" severity="secondary" [outlined]="true" (onClick)="clearFilters()"></p-button>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-900">Warehouse List ({{ filteredLocations.length }})</h2>
      <p class="text-sm text-gray-500">Source: Retail Domain API</p>
    </div>

    <div class="bg-white rounded-xl border border-gray-200 p-10 text-center" *ngIf="loading">
      <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
        <i class="pi pi-spin pi-spinner text-blue-500 text-xl"></i>
      </div>
      <p class="text-gray-600">Loading warehouses...</p>
    </div>

    <p-table
      *ngIf="!loading"
      [value]="filteredLocations"
      styleClass="p-datatable-sm"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} locations">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Location</th>
          <th>Address</th>
          <th>City</th>
          <th>Country</th>
          <th>Total Capacity</th>
          <th>Status</th>
          <th>Updated At</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-location>
        <tr>
          <td class="font-semibold text-gray-900">{{ location.name }}</td>
          <td>{{ location.location || '-' }}</td>
          <td>{{ location.address || '-' }}</td>
          <td>{{ location.city || '-' }}</td>
          <td>{{ location.country || '-' }}</td>
          <td>{{ formatNumber(location.totalCapacity) }}</td>
          <td>
            <p-badge [value]="getStatusLabel(location.isActive)" [severity]="getStatusSeverity(location.isActive)"></p-badge>
          </td>
          <td>{{ location.updatedAt | date: 'short' }}</td>
          <td>
            <div class="flex gap-1">
              <p-button icon="pi pi-eye" [outlined]="true" size="small" (onClick)="viewLocation(location)" pTooltip="View Detail"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="text-center py-12 text-gray-500">No locations found</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog
    [(visible)]="showLocationDialog"
    [header]="dialogMode === 'create' ? 'Add New Location' : 'Location Detail'"
    [modal]="true"
    [style]="{width: '700px'}"
    [closable]="!saving">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" *ngIf="editingLocation">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
        <input pInputText [(ngModel)]="editingLocation.name" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Warehouse name">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Location *</label>
        <input pInputText [(ngModel)]="editingLocation.location" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Location code/name">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Address *</label>
        <input pInputText [(ngModel)]="editingLocation.address" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Address">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">City *</label>
        <input pInputText [(ngModel)]="editingLocation.city" [disabled]="dialogMode === 'view'" class="w-full" placeholder="City">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Country *</label>
        <input pInputText [(ngModel)]="editingLocation.country" [disabled]="dialogMode === 'view'" class="w-full" placeholder="Country">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Total Capacity</label>
        <p-inputNumber [(ngModel)]="editingLocation.totalCapacity" [useGrouping]="false" [disabled]="dialogMode === 'view'" class="w-full"></p-inputNumber>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
        <p-dropdown [(ngModel)]="editingLocation.isActive" [options]="dialogStatusOptions" optionLabel="label" optionValue="value" [disabled]="dialogMode === 'view'" class="w-full"></p-dropdown>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Created At</label>
        <input pInputText [ngModel]="editingLocation.createdAt | date:'medium'" disabled class="w-full" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Updated At</label>
        <input pInputText [ngModel]="editingLocation.updatedAt | date:'medium'" disabled class="w-full" />
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button label="Close" icon="pi pi-times" [outlined]="true" (onClick)="cancelEdit()"></p-button>
      <p-button *ngIf="dialogMode === 'create'" label="Create" icon="pi pi-check" [loading]="saving" (onClick)="saveLocation()"></p-button>
    </ng-template>
  </p-dialog>
</div>
