<!-- Inventory Locations Management -->
<div class="locations-container">
  <div class="header-section">
    <div class="header-content">
      <h1><i class="pi pi-map-marker"></i> Location Management</h1>
      <p>Manage warehouses, stores, and storage locations</p>
    </div>
    <div class="header-actions">
      <p-button
        label="Add Location"
        icon="pi pi-plus"
        (onClick)="createLocation()">
      </p-button>
      <p-button
        label="Export"
        icon="pi pi-download"
        [outlined]="true"
        (onClick)="exportLocations()">
      </p-button>
      <p-button
        label="Refresh"
        icon="pi pi-refresh"
        [outlined]="true"
        (onClick)="refreshData()">
      </p-button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-item">
        <label>Search</label>
        <input
          pInputText
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Search by name, address, city..."
          class="search-input">
      </div>

      <div class="filter-item">
        <label>Type</label>
        <p-dropdown
          [(ngModel)]="selectedType"
          [options]="typeOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="All Types"
          (onChange)="onTypeChange()">
        </p-dropdown>
      </div>

      <div class="filter-item">
        <label>Status</label>
        <p-dropdown
          [(ngModel)]="selectedStatus"
          [options]="statusOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="All Status"
          (onChange)="onStatusChange()">
        </p-dropdown>
      </div>

      <div class="filter-actions">
        <p-button
          label="Clear Filters"
          [outlined]="true"
          size="small"
          (onClick)="clearFilters()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <p-card class="summary-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <i class="pi pi-building card-icon warehouses"></i>
          <div class="card-title">Total Locations</div>
        </div>
      </ng-template>
      <div class="card-value">{{ locations.length }}</div>
      <div class="card-subtitle">All storage locations</div>
    </p-card>

    <p-card class="summary-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <i class="pi pi-check-circle card-icon active"></i>
          <div class="card-title">Active Locations</div>
        </div>
      </ng-template>
      <div class="card-value">{{ getActiveLocationsCount() }}</div>
      <div class="card-subtitle">Currently operational</div>
    </p-card>

    <p-card class="summary-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <i class="pi pi-cog card-icon maintenance"></i>
          <div class="card-title">Under Maintenance</div>
        </div>
      </ng-template>
      <div class="card-value">{{ getMaintenanceLocationsCount() }}</div>
      <div class="card-subtitle">Temporarily unavailable</div>
    </p-card>

    <p-card class="summary-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <i class="pi pi-chart-bar card-icon capacity"></i>
          <div class="card-title">Total Capacity</div>
        </div>
      </ng-template>
      <div class="card-value">{{ formatNumber(getTotalCapacity()) }}</div>
      <div class="card-subtitle">Storage units available</div>
    </p-card>
  </div>

  <!-- Locations Table -->
  <div class="locations-table-section">
    <p-table
      [value]="filteredLocations"
      styleClass="p-datatable-sm"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} locations">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Address</th>
          <th>Manager</th>
          <th>Capacity</th>
          <th>Current Stock</th>
          <th>Utilization</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-location>
        <tr>
          <td>
            <div class="location-info">
              <div class="location-name">{{ location.name }}</div>
              <div class="location-description" *ngIf="location.description">{{ location.description }}</div>
            </div>
          </td>
          <td>
            <p-badge
              [value]="location.type"
              [severity]="getTypeSeverity(location.type)">
            </p-badge>
          </td>
          <td>
            <div class="address-info">
              <div>{{ location.address }}</div>
              <div>{{ location.city }}, {{ location.state }} {{ location.zipCode }}</div>
              <div>{{ location.country }}</div>
            </div>
          </td>
          <td>{{ location.manager || 'N/A' }}</td>
          <td>{{ formatNumber(location.capacity) }}</td>
          <td>{{ formatNumber(location.currentStock) }}</td>
          <td>
            <div class="utilization-info">
              <div class="utilization-bar">
                <div
                  class="utilization-fill"
                  [style.width.%]="getCapacityUtilization(location)"
                  [ngClass]="getCapacityStatus(location)">
                </div>
              </div>
              <div class="utilization-text">{{ formatPercentage(getCapacityUtilization(location)) }}</div>
            </div>
          </td>
          <td>
            <p-badge
              [value]="location.status"
              [severity]="getStatusSeverity(location.status)">
            </p-badge>
          </td>
          <td>
            <div class="action-buttons">
              <p-button
                icon="pi pi-pencil"
                [outlined]="true"
                size="small"
                (onClick)="editLocation(location)"
                pTooltip="Edit Location">
              </p-button>
              <p-button
                icon="pi pi-trash"
                [outlined]="true"
                severity="danger"
                size="small"
                (onClick)="deleteLocation(location)"
                pTooltip="Delete Location">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="empty-message">
          <div class="empty-content">
            <i class="pi pi-map-marker"></i>
            <p>No locations found</p>
          </div>
        </td>
      </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Location Dialog -->
  <p-dialog
    [(visible)]="showLocationDialog"
    [header]="editingLocation?.id ? 'Edit Location' : 'Add New Location'"
    [modal]="true"
    [style]="{width: '700px'}"
    [closable]="true">
    <div class="location-form" *ngIf="editingLocation">
      <div class="form-grid">
        <div class="form-field">
          <label for="name">Location Name *</label>
          <input
            pInputText
            id="name"
            [(ngModel)]="editingLocation.name"
            placeholder="Enter location name"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="type">Type *</label>
          <p-dropdown
            [(ngModel)]="editingLocation.type"
            [options]="typeOptions"
            optionLabel="label"
            optionValue="value">
          </p-dropdown>
        </div>

        <div class="form-field">
          <label for="address">Address *</label>
          <input
            pInputText
            id="address"
            [(ngModel)]="editingLocation.address"
            placeholder="Enter street address"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="city">City *</label>
          <input
            pInputText
            id="city"
            [(ngModel)]="editingLocation.city"
            placeholder="Enter city"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="state">State/Province *</label>
          <input
            pInputText
            id="state"
            [(ngModel)]="editingLocation.state"
            placeholder="Enter state/province"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="zipCode">ZIP/Postal Code *</label>
          <input
            pInputText
            id="zipCode"
            [(ngModel)]="editingLocation.zipCode"
            placeholder="Enter ZIP/postal code"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="country">Country *</label>
          <input
            pInputText
            id="country"
            [(ngModel)]="editingLocation.country"
            placeholder="Enter country"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="manager">Manager</label>
          <input
            pInputText
            id="manager"
            [(ngModel)]="editingLocation.manager"
            placeholder="Enter manager name"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="capacity">Capacity *</label>
          <input
            pInputText
            id="capacity"
            [(ngModel)]="editingLocation.capacity"
            type="number"
            placeholder="0"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="currentStock">Current Stock</label>
          <input
            pInputText
            id="currentStock"
            [(ngModel)]="editingLocation.currentStock"
            type="number"
            placeholder="0"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="status">Status</label>
          <p-dropdown
            [(ngModel)]="editingLocation.status"
            [options]="statusOptions"
            optionLabel="label"
            optionValue="value">
          </p-dropdown>
        </div>

        <div class="form-field">
          <label for="contactPhone">Contact Phone</label>
          <input
            pInputText
            id="contactPhone"
            [(ngModel)]="editingLocation.contactPhone"
            placeholder="Enter contact phone"
            class="form-input">
        </div>

        <div class="form-field">
          <label for="operatingHours">Operating Hours</label>
          <input
            pInputText
            id="operatingHours"
            [(ngModel)]="editingLocation.operatingHours"
            placeholder="e.g., Mon-Fri 9AM-5PM"
            class="form-input">
        </div>

        <div class="form-field full-width">
          <label for="description">Description</label>
          <textarea
            pInputTextarea
            [(ngModel)]="editingLocation.description"
            placeholder="Additional description..."
            rows="3"
            class="form-textarea">
          </textarea>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        [outlined]="true"
        (onClick)="cancelEdit()">
      </p-button>
      <p-button
        label="Save"
        icon="pi pi-check"
        severity="success"
        (onClick)="saveLocation()"
        [disabled]="!editingLocation?.name || !editingLocation?.type || !editingLocation?.address || !editingLocation?.city || !editingLocation?.state || !editingLocation?.zipCode || !editingLocation?.country || !editingLocation?.capacity">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
