<!-- Data Products - Modern Marketplace Interface -->
<p-toast></p-toast>

<div class="data-products-container">
  <div class="container-wrapper">
    
    <!-- Header Section -->
    <div class="header-section">
      <div class="header-content">
        <div class="header-left">
          <div class="header-icon">
            <i class="pi pi-shopping-cart"></i>
          </div>
          <div class="header-text">
            <h1>Data Products Marketplace</h1>
            <p>Discover and manage data products across all domains</p>
          </div>
        </div>
        
        <div class="header-actions">
          <p-button 
            icon="pi pi-filter"
            severity="secondary"
            [outlined]="!showFilters"
            (onClick)="toggleFilters()"
            pTooltip="Toggle Filters"
            tooltipPosition="bottom"
            size="small"
            class="action-btn">
          </p-button>
          <p-button 
            [icon]="'pi pi-th-large'"
            [severity]="viewMode === 'grid' ? 'primary' : 'secondary'"
            [outlined]="viewMode !== 'grid'"
            (onClick)="setViewMode('grid')"
            pTooltip="Grid View"
            tooltipPosition="bottom"
            size="small"
            class="action-btn">
          </p-button>
          <p-button 
            [icon]="'pi pi-list'"
            [severity]="viewMode === 'table' ? 'primary' : 'secondary'" 
            [outlined]="viewMode !== 'table'"
            (onClick)="setViewMode('table')"
            pTooltip="Table View"
            tooltipPosition="bottom"
            size="small"
            class="action-btn">
          </p-button>
        </div>
      </div>
    </div>

    <!-- Stats & Search Section -->
    <div class="stats-search-section">
      <!-- Stats Card -->
      <div class="stats-card">
        <div class="stats-content">
          <div class="stats-icon">
            <i class="pi pi-database"></i>
          </div>
          <div class="stats-info">
            <p class="stats-label">Total Products</p>
            <p class="stats-value">{{ totalRecords }}</p>
          </div>
        </div>
      </div>

      <!-- Search & Domain Filter -->
      <div class="search-filter-card">
        <div class="search-filter-content">
          <!-- Domain Filter -->
          <div class="filter-group">
            <label class="filter-label">
              <i class="pi pi-filter"></i>
              Domain
            </label>
            <p-dropdown 
              [(ngModel)]="filters.domain"
              [options]="domainOptions"
              optionLabel="label"
              optionValue="value"
              (onChange)="onFilterChange()"
              placeholder="All Domains"
              [showClear]="true"
              styleClass="filter-dropdown">
            </p-dropdown>
          </div>

          <!-- Search Bar -->
          <div class="search-group">
            <label class="filter-label">
              <i class="pi pi-search"></i>
              Search
            </label>
            <p-inputGroup>
              <p-inputGroupAddon>
                <i class="pi pi-search"></i>
              </p-inputGroupAddon>
              <input 
                pInputText 
                [(ngModel)]="searchTerm"
                placeholder="Search products by name, description..."
                (input)="onSearch()"
                class="search-input">
            </p-inputGroup>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section" *ngIf="showFilters">
      <div class="filters-content">
        <div class="filter-item">
          <label class="filter-label">
            <i class="pi pi-filter"></i>
            Domain
          </label>
          <p-dropdown 
            [(ngModel)]="filters.domain"
            [options]="domainOptions"
            optionLabel="label"
            optionValue="value"
            (onChange)="onFilterChange()"
            placeholder="Select domain"
            [showClear]="true"
            styleClass="filter-dropdown">
          </p-dropdown>
        </div>
        
        <div class="filter-item">
          <label class="filter-label">
            <i class="pi pi-tag"></i>
            Status
          </label>
          <p-dropdown 
            [(ngModel)]="filters.status"
            [options]="statusOptions"
            optionLabel="label"
            optionValue="value"
            (onChange)="onFilterChange()"
            placeholder="Select status"
            [showClear]="true"
            styleClass="filter-dropdown">
          </p-dropdown>
        </div>
        
        <div class="filter-actions">
          <p-button 
            label="Clear Filters"
            icon="pi pi-times"
            severity="secondary"
            (onClick)="clearFilters()"
            size="small"
            [disabled]="!hasSearchOrFilters"
            class="clear-btn">
          </p-button>
          <p-badge 
            *ngIf="hasSearchOrFilters"
            [value]="(isSearchActive ? 1 : 0) + (isFiltersActive ? 1 : 0)"
            severity="info"
            size="small">
          </p-badge>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="loading-content">
        <div class="loading-spinner">
          <i class="pi pi-spin pi-spinner"></i>
        </div>
        <h3>Loading Data Products</h3>
        <p>Please wait while we fetch the latest data products...</p>
      </div>
    </div>

    <!-- Grid View -->
    <div *ngIf="!loading && viewMode === 'grid'" class="grid-view-container">
      
      <!-- Products Grid -->
      <div class="products-grid">
        <div 
          *ngFor="let product of dataProducts; trackBy: trackByProductId; let i = index"
          class="product-card"
          [style.animation-delay]="(i % 12) * 0.05 + 's'"
          (click)="viewProductDetails(product)">
          
          <!-- Product Header with Gradient -->
          <div class="product-header" [style.background]="getProductGradient(product.domain)">
            <div class="product-icon-wrapper">
              <span class="product-icon">{{ getDomainImage(product.domain || '') }}</span>
            </div>
            <div class="product-status">
              <p-tag 
                [value]="product.status || 'Active'"
                [severity]="getStatusSeverity(product.status || 'active')"
                class="status-tag">
              </p-tag>
            </div>
          </div>
          
          <!-- Product Body -->
          <div class="product-body">
            <h3 class="product-title">{{ product.name }}</h3>
            <p class="product-description">
              {{ product.description || 'No description available' }}
            </p>
            
            <div class="product-meta">
              <div class="meta-item">
                <i class="pi pi-tag meta-icon"></i>
                <p-chip 
                  [label]="getDomainDisplayName(product.domain || '')"
                  class="domain-chip">
                </p-chip>
              </div>
              
              <div class="meta-item" *ngIf="product.owner">
                <i class="pi pi-user meta-icon"></i>
                <span class="meta-text">{{ product.owner.email || product.owner.first_name || 'N/A' }}</span>
              </div>
            </div>
          </div>
          
          <!-- Product Footer -->
          <div class="product-footer">
            <div class="product-actions">
              <p-button 
                icon="pi pi-eye"
                size="small"
                [outlined]="true"
                severity="info"
                (onClick)="viewProductDetails(product); $event.stopPropagation()"
                pTooltip="View Details"
                tooltipPosition="top"
                class="action-button">
              </p-button>
              <p-button 
                icon="pi pi-plus"
                size="small"
                severity="success"
                (onClick)="subscribeToProduct(product); $event.stopPropagation()"
                pTooltip="Subscribe"
                tooltipPosition="top"
                class="action-button">
              </p-button>
            </div>
            
            <div class="product-date" *ngIf="product.created_at">
              <i class="pi pi-calendar"></i>
              <span>{{ formatDate(product.created_at) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-wrapper">
        <p-paginator 
          [first]="first"
          [rows]="pageSize"
          [totalRecords]="totalRecords"
          [rowsPerPageOptions]="[12, 24, 48]"
          (onPageChange)="onPageChange($event)"
          styleClass="custom-paginator">
        </p-paginator>
      </div>
    </div>

    <!-- Table View -->
    <div *ngIf="!loading && viewMode === 'table'" class="table-view-container">
      
      <div class="table-wrapper">
        <p-table 
          [value]="dataProducts"
          [paginator]="true"
          [rows]="pageSize"
          [totalRecords]="totalRecords"
          [lazy]="true"
          (onLazyLoad)="onPageChange($event)"
          [loading]="loading"
          [trackBy]="trackByProductId"
          styleClass="modern-table">
          
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 60px;">Icon</th>
              <th>Name</th>
              <th>Domain</th>
              <th>Description</th>
              <th>Status</th>
              <th>Owner</th>
              <th style="width: 140px;">Actions</th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-product>
            <tr class="table-row" (click)="viewProductDetails(product)">
              <td>
                <div class="table-icon-wrapper">
                  <span class="table-icon">{{ getDomainImage(product.domain || '') }}</span>
                </div>
              </td>
              <td>
                <div class="table-name">{{ product.name }}</div>
              </td>
              <td>
                <p-chip 
                  [label]="getDomainDisplayName(product.domain || '')"
                  class="table-chip">
                </p-chip>
              </td>
              <td>
                <span class="table-description">
                  {{ product.description || 'No description available' }}
                </span>
              </td>
              <td>
                <p-tag 
                  [value]="product.status || 'Active'"
                  [severity]="getStatusSeverity(product.status || 'active')"
                  class="table-tag">
                </p-tag>
              </td>
              <td>
                <span class="table-owner">
                  {{ product.owner?.email || product.owner?.first_name || 'Not assigned' }}
                </span>
              </td>
              <td>
                <div class="table-actions">
                  <p-button 
                    icon="pi pi-eye"
                    size="small"
                    [outlined]="true"
                    severity="info"
                    (onClick)="viewProductDetails(product); $event.stopPropagation()"
                    pTooltip="View Details"
                    class="table-action-btn">
                  </p-button>
                  <p-button 
                    icon="pi pi-plus"
                    size="small"
                    severity="success"
                    (onClick)="subscribeToProduct(product); $event.stopPropagation()"
                    pTooltip="Subscribe"
                    class="table-action-btn">
                  </p-button>
                </div>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="7" class="empty-table-message">
                <div class="empty-content">
                  <i class="pi pi-info-circle"></i>
                  <p>No data products found</p>
                  <p class="empty-subtext">Try adjusting your search or filters</p>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && dataProducts.length === 0" class="empty-state">
      <div class="empty-content-wrapper">
        <div class="empty-icon-wrapper">
          <i class="pi pi-inbox"></i>
        </div>
        <h3>No Data Products Found</h3>
        <p>There are no data products available at the moment.</p>
        <p-button 
          label="Clear Filters"
          icon="pi pi-refresh"
          (onClick)="clearFilters()"
          severity="secondary"
          class="empty-action-btn">
        </p-button>
      </div>
    </div>
  </div>
</div>
