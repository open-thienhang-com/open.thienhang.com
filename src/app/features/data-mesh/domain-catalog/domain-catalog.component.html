<div class="governance-page-container">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Domain Catalog</h1>
      <p class="page-subtitle">Explore and manage all data domains across your organization.</p>
    </div>
    <div class="header-actions">
      <button pButton type="button" label="Export" icon="pi pi-download" class="p-button-secondary"></button>
      <button pButton type="button" label="Create Domain" icon="pi pi-plus"></button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <p-card styleClass="stat-card">
      <div class="stat-icon"><i class="pi pi-sitemap"></i></div>
      <div class="stat-info">
        <p class="stat-label">Total Domains</p>
        <p class="stat-value">{{ stats.totalDomains }}</p>
      </div>
    </p-card>
    <p-card styleClass="stat-card">
      <div class="stat-icon"><i class="pi pi-check-circle"></i></div>
      <div class="stat-info">
        <p class="stat-label">Active Domains</p>
        <p class="stat-value">{{ stats.activeDomains }}</p>
      </div>
    </p-card>
    <p-card styleClass="stat-card">
      <div class="stat-icon"><i class="pi pi-box"></i></div>
      <div class="stat-info">
        <p class="stat-label">Total Data Products</p>
        <p class="stat-value">{{ stats.totalDataProducts }}</p>
      </div>
    </p-card>
    <p-card styleClass="stat-card">
      <div class="stat-icon"><i class="pi pi-code"></i></div>
      <div class="stat-info">
        <p class="stat-label">Total APIs</p>
        <p class="stat-value">{{ stats.totalApis }}</p>
      </div>
    </p-card>
  </div>

  <!-- Main Content Card -->
  <p-card>
    <!-- Toolbar -->
    <p-toolbar>
      <div class="p-toolbar-group-start">
        <div class="p-inputgroup">
          <span class="p-inputgroup-addon"><i class="pi pi-search"></i></span>
          <input type="text" pInputText placeholder="Search domains..." [(ngModel)]="searchTerm" (input)="onSearch()">
        </div>
      </div>
      <div class="p-toolbar-group-end">
        <p-dropdown [options]="statusOptions" [(ngModel)]="filters.status" placeholder="Status" (onChange)="onFilterChange()"></p-dropdown>
        <p-dropdown [options]="teamOptions" [(ngModel)]="filters.team" placeholder="Team" (onChange)="onFilterChange()"></p-dropdown>
        <button pButton type="button" icon="pi pi-filter-slash" (click)="clearFilters()" pTooltip="Clear Filters"></button>
        <p-divider layout="vertical"></p-divider>
        <div class="p-buttonset">
          <button pButton type="button" icon="pi pi-list" [ngClass]="{'p-button-primary': viewMode === 'list', 'p-button-secondary': viewMode !== 'list'}" (click)="viewMode = 'list'"></button>
          <button pButton type="button" icon="pi pi-th-large" [ngClass]="{'p-button-primary': viewMode === 'card', 'p-button-secondary': viewMode !== 'card'}" (click)="viewMode = 'card'"></button>
        </div>
      </div>
    </p-toolbar>

    <!-- List View -->
    <p-table *ngIf="viewMode === 'list'" [value]="filteredDomains" [loading]="loading" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="display_name">Name <p-sortIcon field="display_name"></p-sortIcon></th>
          <th>Status</th>
          <th>Owner</th>
          <th>Team</th>
          <th class="text-center">Data Products</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-domain>
        <tr>
          <td>
            <div class="flex items-center gap-3">
              <i [class]="'pi ' + getDomainIcon(domain.domain_key) + ' text-xl text-primary'"></i>
              <div>
                <a class="font-semibold text-primary hover:underline cursor-pointer" (click)="viewDomainDetails(domain)">{{ domain.display_name }}</a>
                <p class="text-sm text-color-secondary">{{ domain.description | slice:0:80 }}...</p>
              </div>
            </div>
          </td>
          <td><p-tag [value]="domain.status" [severity]="getStatusSeverity(domain.status)"></p-tag></td>
          <td>{{ domain.owner }}</td>
          <td>{{ domain.team }}</td>
          <td class="text-center"><p-badge [value]="domain.data_products?.length || 0" severity="info"></p-badge></td>
          <td>
            <button pButton pRipple icon="pi pi-eye" class="p-button-rounded p-button-text" (click)="viewDomainDetails(domain)"></button>
            <button pButton pRipple icon="pi pi-sitemap" class="p-button-rounded p-button-text" (click)="viewDomainDataProducts(domain)"></button>
            <button pButton pRipple icon="pi pi-code" class="p-button-rounded p-button-text" (click)="showDomainApis(domain)"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr><td colspan="6" class="text-center p-5">No domains found.</td></tr>
      </ng-template>
    </p-table>

    <!-- Card View -->
    <div *ngIf="viewMode === 'card'" class="grid mt-4">
      <div *ngFor="let domain of filteredDomains" class="col-12 md:col-6 lg:col-4">
        <p-card (click)="viewDomainDetails(domain)" styleClass="cursor-pointer h-full">
          <ng-template pTemplate="header">
            <div class="flex justify-between items-center p-4 border-bottom-1 surface-border">
              <div class="flex items-center gap-3">
                <i [class]="'pi ' + getDomainIcon(domain.domain_key) + ' text-2xl text-primary'"></i>
                <h3 class="font-bold text-lg m-0">{{ domain.display_name }}</h3>
              </div>
              <p-tag [value]="domain.status" [severity]="getStatusSeverity(domain.status)"></p-tag>
            </div>
          </ng-template>
          <p class="text-color-secondary m-0 px-4 pb-4 h-5rem">{{ domain.description }}</p>
          <ng-template pTemplate="footer">
            <div class="flex justify-between items-center px-4 pt-4 border-top-1 surface-border">
              <div class="flex flex-col">
                <span class="text-xs text-color-secondary">Owner</span>
                <span class="font-medium">{{ domain.owner }}</span>
              </div>
              <div class="flex flex-col text-right">
                <span class="text-xs text-color-secondary">Data Products</span>
                <p-badge [value]="domain.data_products?.length || 0" severity="info"></p-badge>
              </div>
            </div>
          </ng-template>
        </p-card>
      </div>
    </div>

  </p-card>
</div>
