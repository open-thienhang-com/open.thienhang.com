<div class="data-product-detail-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mb-4"></div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">
        <i class="pi pi-database mr-2"></i>
        Loading Data Product Details
      </h3>
      <p class="text-gray-600">Please wait while we fetch the data product information...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-card">
      <div class="error-icon">
        <i class="pi pi-exclamation-triangle text-red-500 text-4xl"></i>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">
        <i class="pi pi-times-circle mr-2"></i>
        Error Loading Data Product
      </h3>
      <p class="text-gray-600 mb-4">{{ error }}</p>
      <div class="flex gap-3">
        <p-button 
          label="Try Again" 
          icon="pi pi-refresh" 
          (click)="ngOnInit()"
          [loading]="loading">
        </p-button>
        <p-button 
          label="Go Back" 
          icon="pi pi-arrow-left" 
          severity="secondary"
          (click)="navigateBack()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="dataProduct && !loading" class="main-content">
    <!-- Header -->
    <div class="detail-header">
      <div class="header-actions">
        <p-button 
          icon="pi pi-arrow-left" 
          label="Back to Data Products"
          severity="secondary"
          (click)="navigateBack()">
        </p-button>
      </div>
      
      <div class="header-info">
        <div class="product-title">
          <div class="title-with-icon">
            <i [class]="'pi ' + getDomainConfig().icon + ' domain-icon'" 
               [style.color]="getDomainConfig().color"></i>
            <div class="title-content">
              <h1>{{ dataProduct.name }}</h1>
              <div class="title-meta">
                <span class="product-id" *ngIf="dataProduct.id">
                  <i class="pi pi-hashtag"></i>
                  {{ dataProduct.id }}
                </span>
                <span class="product-kid" *ngIf="dataProduct.kid">
                  <i class="pi pi-key"></i>
                  {{ dataProduct.kid }}
                </span>
              </div>
            </div>
          </div>
          <div class="title-tags">
            <p-tag 
              [value]="dataProduct.domain || 'Unknown'" 
              severity="info"
              icon="pi pi-tag">
            </p-tag>
          </div>
        </div>
        <p class="product-description" *ngIf="dataProduct.description">
          <i class="pi pi-info-circle mr-2 text-gray-500"></i>
          {{ dataProduct.description }}
        </p>
        
        <div class="product-meta">
          <div class="meta-grid">
            <!-- Owner -->
            <div class="meta-item" *ngIf="dataProduct.owner">
              <i class="pi pi-user meta-icon"></i>
              <div class="meta-content">
                <span class="meta-label">Owner:</span>
                <span class="meta-value">{{ getOwnerDisplayName() }}</span>
                <span class="meta-subvalue" *ngIf="dataProduct.owner.email">{{ dataProduct.owner.email }}</span>
              </div>
            </div>
            
            <!-- Company -->
            <div class="meta-item" *ngIf="dataProduct.owner?.company">
              <i class="pi pi-building meta-icon"></i>
              <div class="meta-content">
                <span class="meta-label">Company:</span>
                <span class="meta-value">{{ getCompanyName() }}</span>
              </div>
            </div>
            
            <!-- Purpose -->
            <div class="meta-item" *ngIf="dataProduct.purpose">
              <i class="pi pi-flag meta-icon"></i>
              <div class="meta-content">
                <span class="meta-label">Purpose:</span>
                <span class="meta-value">{{ dataProduct.purpose }}</span>
              </div>
            </div>
            
            <!-- Created Date -->
            <div class="meta-item" *ngIf="dataProduct.created_at">
              <i class="pi pi-calendar-plus meta-icon"></i>
              <div class="meta-content">
                <span class="meta-label">Created:</span>
                <span class="meta-value">{{ formatDate(dataProduct.created_at) }}</span>
              </div>
            </div>
            
            <!-- Updated Date -->
            <div class="meta-item" *ngIf="dataProduct.updated_at">
              <i class="pi pi-calendar meta-icon"></i>
              <div class="meta-content">
                <span class="meta-label">Updated:</span>
                <span class="meta-value">{{ formatDate(dataProduct.updated_at) }}</span>
              </div>
            </div>
            
            <!-- Discoverability -->
            <div class="meta-item" *ngIf="dataProduct.discoverability">
              <i class="pi pi-search meta-icon"></i>
              <div class="meta-content">
                <span class="meta-label">Discoverability:</span>
                <span class="meta-value">{{ dataProduct.discoverability }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs Content -->
    <div class="detail-tabs">
      <p-tabView (onChange)="onTabChange($event)" [activeIndex]="activeTab">
        
        <!-- Overview Tab -->
        <p-tabPanel header="Overview" leftIcon="pi pi-info-circle">
          <div class="tab-content">
            <div class="overview-grid">
              
              <!-- Purpose Card -->
              <p-card header="Purpose" styleClass="overview-card" *ngIf="dataProduct.purpose">
                <div class="card-icon">
                  <i class="pi pi-flag"></i>
                </div>
                <div class="card-content">
                  <p>{{ dataProduct.purpose }}</p>
                </div>
              </p-card>

              <!-- Consumers Card -->
              <p-card header="Consumers" styleClass="overview-card" *ngIf="hasValue(dataProduct.consumers)">
                <div class="card-icon">
                  <i class="pi pi-users"></i>
                </div>
                <div class="card-content">
                  <div class="consumer-list">
                    <p-chip *ngFor="let consumer of dataProduct.consumers" [label]="consumer"></p-chip>
                  </div>
                </div>
              </p-card>

              <!-- Teams Card -->
              <p-card header="Teams" styleClass="overview-card" *ngIf="hasValue(dataProduct.teams)">
                <div class="card-icon">
                  <i class="pi pi-users"></i>
                </div>
                <div class="card-content">
                  <div class="team-list">
                    <p-chip *ngFor="let team of dataProduct.teams" [label]="team.name || team"></p-chip>
                  </div>
                </div>
              </p-card>

              <!-- Tags Card -->
              <p-card header="Tags" styleClass="overview-card" *ngIf="hasValue(dataProduct.tags)">
                <div class="card-icon">
                  <i class="pi pi-tags"></i>
                </div>
                <div class="card-content">
                  <div class="tag-list">
                    <p-chip *ngFor="let tag of dataProduct.tags" [label]="tag"></p-chip>
                  </div>
                </div>
              </p-card>

              <!-- Assets Card -->
              <p-card header="Assets" styleClass="overview-card" *ngIf="hasValue(dataProduct.assets)">
                <div class="card-icon">
                  <i class="pi pi-database"></i>
                </div>
                <div class="card-content">
                  <div class="asset-list">
                    <div *ngFor="let asset of dataProduct.assets" class="asset-item">
                      <i class="pi pi-file-o"></i>
                      <span>{{ asset.name || asset }}</span>
                    </div>
                  </div>
                </div>
              </p-card>

              <!-- Quality Metrics Card -->
              <p-card header="Quality Metrics" styleClass="overview-card" *ngIf="hasValue(dataProduct.quality_metrics)">
                <div class="card-icon">
                  <i class="pi pi-chart-line"></i>
                </div>
                <div class="card-content">
                  <div class="quality-metrics-list">
                    <div class="quality-item" *ngIf="dataProduct.quality_metrics.accuracy">
                      <span class="quality-label">Accuracy:</span>
                      <span class="quality-value" [style.color]="getQualityColor(dataProduct.quality_metrics.accuracy)">
                        {{ dataProduct.quality_metrics.accuracy }}
                      </span>
                    </div>
                    <div class="quality-item" *ngIf="dataProduct.quality_metrics.freshness">
                      <span class="quality-label">Freshness:</span>
                      <span class="quality-value">{{ dataProduct.quality_metrics.freshness }}</span>
                    </div>
                    <div class="quality-item" *ngIf="dataProduct.quality_metrics.completeness">
                      <span class="quality-label">Completeness:</span>
                      <span class="quality-value" [style.color]="getQualityColor(dataProduct.quality_metrics.completeness)">
                        {{ dataProduct.quality_metrics.completeness }}
                      </span>
                    </div>
                  </div>
                </div>
              </p-card>
            </div>
          </div>
        </p-tabPanel>

        <!-- APIs Tab -->
        <p-tabPanel header="APIs" leftIcon="pi pi-globe">
          <div class="tab-content">
            <div *ngIf="hasValue(dataProduct.apis); else noApis">
              <p-table [value]="dataProduct.apis" [paginator]="false" styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Method</th>
                    <th>Path</th>
                    <th>Description</th>
                    <th>Auth Required</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-api>
                  <tr>
                    <td>
                      <p-badge [value]="api.method" [severity]="getSeverity(api.method)"></p-badge>
                    </td>
                    <td>
                      <code class="api-path">{{ api.path }}</code>
                    </td>
                    <td>{{ api.description || 'N/A' }}</td>
                    <td>
                      <p-tag 
                        [value]="api.auth_required ? 'Yes' : 'No'" 
                        [severity]="api.auth_required ? 'warning' : 'success'">
                      </p-tag>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
            <ng-template #noApis>
              <div class="empty-state">
                <i class="pi pi-globe text-gray-400 text-6xl mb-4"></i>
                <p class="no-data">No APIs configured</p>
              </div>
            </ng-template>
          </div>
        </p-tabPanel>

        <!-- Schema Tab -->
        <p-tabPanel header="Schema" leftIcon="pi pi-code">
          <div class="tab-content">
            <div class="schema-section">
              <h3>
                <i class="pi pi-sign-in mr-2"></i>
                Input Ports
              </h3>
              <div class="schema-card">
                <div *ngIf="hasValue(dataProduct.input_ports); else noInputPorts">
                  <div class="port-list">
                    <p-chip *ngFor="let port of dataProduct.input_ports" [label]="port"></p-chip>
                  </div>
                </div>
                <ng-template #noInputPorts>
                  <p class="no-data">
                    <i class="pi pi-info-circle mr-2"></i>
                    No input ports defined
                  </p>
                </ng-template>
              </div>
            </div>

            <p-divider></p-divider>

            <div class="schema-section">
              <h3>
                <i class="pi pi-sign-out mr-2"></i>
                Output Ports
              </h3>
              <div class="schema-card">
                <div *ngIf="hasValue(dataProduct.output_ports); else noOutputPorts">
                  <div class="port-list">
                    <p-chip *ngFor="let port of dataProduct.output_ports" [label]="port"></p-chip>
                  </div>
                </div>
                <ng-template #noOutputPorts>
                  <p class="no-data">
                    <i class="pi pi-info-circle mr-2"></i>
                    No output ports defined
                  </p>
                </ng-template>
              </div>
            </div>
          </div>
        </p-tabPanel>

        <!-- Policies Tab -->
        <p-tabPanel header="Policies" leftIcon="pi pi-shield">
          <div class="tab-content">
            <div *ngIf="hasValue(dataProduct.policies); else noPolicies">
              <div class="policy-list">
                <div *ngFor="let policy of dataProduct.policies" class="policy-item">
                  <p-card>
                    <div class="policy-header">
                      <div class="policy-title">
                        <i class="pi pi-shield mr-2"></i>
                        <h4>{{ policy.name || 'Unnamed Policy' }}</h4>
                      </div>
                      <p-tag [value]="policy.type || 'Policy'" severity="info"></p-tag>
                    </div>
                    <p>{{ getDefaultValue(policy.description, 'No description available') }}</p>
                  </p-card>
                </div>
              </div>
            </div>
            <ng-template #noPolicies>
              <div class="empty-state">
                <i class="pi pi-shield text-gray-400 text-6xl mb-4"></i>
                <p class="no-data">No policies defined</p>
              </div>
            </ng-template>
          </div>
        </p-tabPanel>

        <!-- Permissions Tab -->
        <p-tabPanel header="Permissions" leftIcon="pi pi-lock">
          <div class="tab-content">
            <div *ngIf="hasValue(dataProduct.permissions); else noPermissions">
              <div class="permission-list">
                <div *ngFor="let permission of dataProduct.permissions" class="permission-item">
                  <p-card>
                    <div class="permission-header">
                      <div class="permission-title">
                        <i class="pi pi-lock mr-2"></i>
                        <h4>{{ permission.name || 'Unnamed Permission' }}</h4>
                      </div>
                      <p-tag [value]="permission.level || 'Standard'" [severity]="getSeverity(permission.level)"></p-tag>
                    </div>
                    <p>{{ getDefaultValue(permission.description, 'No description available') }}</p>
                  </p-card>
                </div>
              </div>
            </div>
            <ng-template #noPermissions>
              <div class="empty-state">
                <i class="pi pi-lock text-gray-400 text-6xl mb-4"></i>
                <p class="no-data">No permissions defined</p>
              </div>
            </ng-template>
          </div>
        </p-tabPanel>

        <!-- Quality Tab -->
        <p-tabPanel header="Quality" leftIcon="pi pi-chart-line">
          <div class="tab-content">
            <div class="quality-metrics">
              <div *ngIf="hasValue(dataProduct.quality_metrics); else noQualityMetrics">
                <div class="quality-grid">
                  <div class="quality-card" *ngIf="dataProduct.quality_metrics.accuracy">
                    <div class="quality-icon" style="background: #10B981;">
                      <i class="pi pi-check-circle"></i>
                    </div>
                    <div class="quality-content">
                      <h4>Accuracy</h4>
                      <p class="quality-value" [style.color]="getQualityColor(dataProduct.quality_metrics.accuracy)">
                        {{ dataProduct.quality_metrics.accuracy }}
                      </p>
                    </div>
                  </div>
                  
                  <div class="quality-card" *ngIf="dataProduct.quality_metrics.freshness">
                    <div class="quality-icon" style="background: #3B82F6;">
                      <i class="pi pi-clock"></i>
                    </div>
                    <div class="quality-content">
                      <h4>Freshness</h4>
                      <p class="quality-value">{{ dataProduct.quality_metrics.freshness }}</p>
                    </div>
                  </div>
                  
                  <div class="quality-card" *ngIf="dataProduct.quality_metrics.completeness">
                    <div class="quality-icon" style="background: #8B5CF6;">
                      <i class="pi pi-percentage"></i>
                    </div>
                    <div class="quality-content">
                      <h4>Completeness</h4>
                      <p class="quality-value" [style.color]="getQualityColor(dataProduct.quality_metrics.completeness)">
                        {{ dataProduct.quality_metrics.completeness }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #noQualityMetrics>
                <div class="empty-state">
                  <i class="pi pi-chart-line text-gray-400 text-6xl mb-4"></i>
                  <p class="no-data">No quality metrics available</p>
                </div>
              </ng-template>
            </div>
          </div>
        </p-tabPanel>

        <!-- Documentation Tab -->
        <p-tabPanel header="Documentation" leftIcon="pi pi-book">
          <div class="tab-content">
            <div class="documentation-section">
              
              <!-- Swagger UI -->
              <div class="swagger-section" *ngIf="dataProduct.swagger">
                <h3>
                  <i class="pi pi-file-code mr-2"></i>
                  Swagger Documentation
                </h3>
                <div class="swagger-container">
                  <div *ngIf="swaggerLoading" class="swagger-loading">
                    <i class="pi pi-spin pi-spinner mr-2"></i>
                    Loading documentation...
                  </div>
                  <div *ngIf="swaggerError && !swaggerLoading" class="swagger-error">
                    <i class="pi pi-exclamation-triangle mr-2"></i>
                    Documentation not available (404)
                  </div>
                  <div *ngIf="swaggerUrl && !swaggerLoading && !swaggerError" class="swagger-frame-container">
                    <iframe 
                      [src]="swaggerUrl" 
                      class="swagger-frame"
                      frameborder="0">
                    </iframe>
                  </div>
                </div>
                <div class="doc-link" *ngIf="dataProduct.swagger">
                  <a [href]="dataProduct.swagger" target="_blank" rel="noopener noreferrer">
                    <i class="pi pi-external-link mr-2"></i>
                    Open Swagger Documentation
                  </a>
                </div>
              </div>

              <!-- OpenAPI -->
              <div class="openapi-section" *ngIf="dataProduct.openapi">
                <h3>
                  <i class="pi pi-file-o mr-2"></i>
                  OpenAPI Documentation
                </h3>
                <div class="openapi-container">
                  <iframe 
                    [src]="openapiUrl" 
                    class="openapi-frame"
                    frameborder="0">
                  </iframe>
                </div>
                <div class="doc-link" *ngIf="dataProduct.openapi">
                  <a [href]="dataProduct.openapi" target="_blank" rel="noopener noreferrer">
                    <i class="pi pi-external-link mr-2"></i>
                    Open OpenAPI Documentation
                  </a>
                </div>
              </div>

              <!-- Additional Documentation -->
              <div class="additional-docs" *ngIf="dataProduct.documentation">
                <h3>
                  <i class="pi pi-book mr-2"></i>
                  Additional Documentation
                </h3>
                <div class="documentation-card">
                  <p>{{ dataProduct.documentation }}</p>
                </div>
              </div>
            </div>
          </div>
        </p-tabPanel>

        <!-- Lifecycle Tab -->
        <p-tabPanel header="Lifecycle" leftIcon="pi pi-history">
          <div class="tab-content">
            <div class="lifecycle-info">
              <div *ngIf="dataProduct.lifecycle; else noLifecycle">
                <div class="lifecycle-card">
                  <div class="lifecycle-content">
                    <i class="pi pi-history lifecycle-icon"></i>
                    <p>{{ dataProduct.lifecycle }}</p>
                  </div>
                </div>
              </div>
              <ng-template #noLifecycle>
                <div class="empty-state">
                  <i class="pi pi-history text-gray-400 text-6xl mb-4"></i>
                  <p class="no-data">No lifecycle information available</p>
                </div>
              </ng-template>
            </div>
          </div>
        </p-tabPanel>

        <!-- Cost Tab -->
        <p-tabPanel header="Cost" leftIcon="pi pi-dollar">
          <div class="tab-content">
            <div class="cost-info">
              <div *ngIf="dataProduct.cost; else noCost">
                <div class="cost-card">
                  <div class="cost-content">
                    <i class="pi pi-dollar cost-icon"></i>
                    <p>{{ dataProduct.cost }}</p>
                  </div>
                </div>
              </div>
              <ng-template #noCost>
                <div class="empty-state">
                  <i class="pi pi-dollar text-gray-400 text-6xl mb-4"></i>
                  <p class="no-data">No cost information available</p>
                </div>
              </ng-template>
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
    </div>
  </div>

  <!-- Toast Messages -->
  <p-toast position="top-right" [life]="5000"></p-toast>
</div>
