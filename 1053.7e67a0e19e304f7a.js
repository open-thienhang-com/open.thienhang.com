"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[1053],{1053:(le,m,p)=>{p.r(m),p.d(m,{PlanPreviewComponent:()=>re});var y=p(467),v=p(2881),e=p(1360),f=p(1910),E=p(5315);const w=(n,r)=>({"bg-white text-orange-600 shadow-sm":n,"text-gray-600 hover:bg-gray-100 border border-gray-200":r}),j=(n,r)=>({"bg-primary text-white shadow-sm hover:shadow-md":n,"text-gray-600 hover:bg-gray-100 border border-gray-200":r}),C=(n,r)=>({"font-semibold bg-white text-primary border-t-2 border-x border-primary shadow-sm":n,"bg-gray-50 text-gray-600 border border-transparent hover:bg-gray-100 hover:text-gray-800":r}),D=(n,r)=>({"bg-primary/10 text-primary":n,"bg-gray-200 text-gray-600":r}),x=()=>[],S=(n,r,t)=>({"bg-green-500":n,"bg-blue-500":r,"bg-gray-400":t}),I=(n,r,t)=>({"bg-green-100 text-green-700":n,"bg-blue-100 text-blue-700":r,"bg-gray-100 text-gray-700":t});function P(n,r){1&n&&(e.j41(0,"div",4),e.nrm(1,"div",5),e.j41(2,"p",6),e.EFF(3,"\u0110ang t\u1ea3i plan..."),e.k0s()())}function R(n,r){if(1&n&&(e.j41(0,"div",7)(1,"p",8),e.EFF(2),e.k0s()()),2&n){const t=e.XpG();e.R7$(2),e.JRh(t.error)}}function $(n,r){if(1&n&&(e.j41(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15),e.qSk(),e.j41(4,"svg",16),e.nrm(5,"path",17)(6,"path",18),e.k0s(),e.joV(),e.j41(7,"span",19),e.EFF(8,"T\u1ed5ng xe"),e.k0s()(),e.j41(9,"div",20),e.EFF(10),e.k0s(),e.j41(11,"div",21),e.EFF(12),e.k0s()(),e.j41(13,"div",22)(14,"div",15)(15,"span",23),e.EFF(16,"\u{1f4e5}"),e.k0s(),e.j41(17,"span",24),e.EFF(18,"SL L\u1ea5y"),e.k0s()(),e.j41(19,"div",25),e.EFF(20),e.nI1(21,"number"),e.k0s(),e.j41(22,"div",26),e.EFF(23,"S\u1ed1 l\u01b0\u1ee3ng \u0111\u01a1n"),e.k0s()(),e.j41(24,"div",22)(25,"div",15)(26,"span",23),e.EFF(27,"\u2696\ufe0f"),e.k0s(),e.j41(28,"span",24),e.EFF(29,"KL L\u1ea5y"),e.k0s()(),e.j41(30,"div",27),e.EFF(31),e.nI1(32,"number"),e.j41(33,"span",28),e.EFF(34,"kg"),e.k0s()(),e.j41(35,"div",26),e.EFF(36,"Kh\u1ed1i l\u01b0\u1ee3ng"),e.k0s()(),e.j41(37,"div",29)(38,"div",15)(39,"span",23),e.EFF(40,"\u{1f4e6}"),e.k0s(),e.j41(41,"span",30),e.EFF(42,"SL Giao"),e.k0s()(),e.j41(43,"div",31),e.EFF(44),e.nI1(45,"number"),e.k0s(),e.j41(46,"div",32),e.EFF(47,"S\u1ed1 l\u01b0\u1ee3ng \u0111\u01a1n"),e.k0s()(),e.j41(48,"div",29)(49,"div",15)(50,"span",23),e.EFF(51,"\u2696\ufe0f"),e.k0s(),e.j41(52,"span",30),e.EFF(53,"KL Giao"),e.k0s()(),e.j41(54,"div",33),e.EFF(55),e.nI1(56,"number"),e.j41(57,"span",28),e.EFF(58,"kg"),e.k0s()(),e.j41(59,"div",32),e.EFF(60,"Kh\u1ed1i l\u01b0\u1ee3ng"),e.k0s()(),e.j41(61,"div",34)(62,"div",15),e.qSk(),e.j41(63,"svg",35),e.nrm(64,"path",36),e.k0s(),e.joV(),e.j41(65,"span",37),e.EFF(66,"T\u1ed5ng KM"),e.k0s()(),e.j41(67,"div",38),e.EFF(68),e.nI1(69,"number"),e.j41(70,"span",28),e.EFF(71,"km"),e.k0s()(),e.j41(72,"div",39),e.EFF(73),e.k0s()()()()),2&n){const t=e.XpG(2);e.R7$(10),e.JRh(t.planStats.totalVehicles),e.R7$(2),e.Lme("NCC: ",t.planStats.vehiclesNCC," \u2022 GHN: ",t.planStats.vehiclesGHN,""),e.R7$(8),e.JRh(e.bMT(21,9,t.planStats.totalPickupQty)),e.R7$(11),e.SpI(" ",e.bMT(32,11,t.planStats.totalPickupKg)," "),e.R7$(13),e.JRh(e.bMT(45,13,t.planStats.totalDeliveryQty)),e.R7$(11),e.SpI(" ",e.bMT(56,15,t.planStats.totalDeliveryKg)," "),e.R7$(13),e.SpI(" ",e.i5U(69,17,t.planStats.totalDistanceKm,"1.1-1")," "),e.R7$(5),e.SpI("",t.planStats.totalStops," \u0111i\u1ec3m d\u1eebng")}}function G(n,r){1&n&&(e.j41(0,"div",12)(1,"div",40)(2,"p",41),e.EFF(3,"Ch\u1ecdn plan \u0111\u1ec3 xem t\u1ed5ng quan"),e.k0s()()())}function T(n,r){if(1&n){const t=e.RV6();e.j41(0,"button",61),e.bIt("click",function(){const a=e.eBV(t).index,o=e.XpG(4);return e.Njj(o.switchToShift(a))}),e.j41(1,"span",62),e.EFF(2),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s(),e.j41(5,"span",63),e.EFF(6),e.k0s()()}if(2&n){const t=r.$implicit,i=r.index,a=e.XpG(4);e.Y8G("ngClass",e.l_i(5,C,a.activeShiftIndex===i,a.activeShiftIndex!==i)),e.R7$(2),e.JRh(a.getShiftIcon(i)),e.R7$(2),e.JRh(t.shift_name||t.name||"Shift "+(i+1)),e.R7$(),e.Y8G("ngClass",e.l_i(8,D,a.activeShiftIndex===i,a.activeShiftIndex!==i)),e.R7$(),e.SpI(" ",(t.vehicles||e.lJ4(11,x)).length," xe ")}}function A(n,r){if(1&n&&(e.j41(0,"div",57)(1,"div",58)(2,"nav",59),e.DNE(3,T,7,12,"button",60),e.k0s()()()),2&n){const t=e.XpG(3);e.R7$(3),e.Y8G("ngForOf",t.shifts)}}function V(n,r){1&n&&e.nrm(0,"div",94)}function M(n,r){if(1&n&&(e.j41(0,"div",95)(1,"span",96),e.EFF(2,"\u2191"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(4),e.SpI("Pickup: ",t.pickup_weight_kg," kg")}}function N(n,r){if(1&n&&(e.j41(0,"div",95)(1,"span",97),e.EFF(2,"\u2193"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(4),e.SpI("Delivery: ",t.delivery_weight_kg," kg")}}function B(n,r){if(1&n&&(e.j41(0,"div",98)(1,"span",99),e.EFF(2,"\u{1f4cd}"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.nI1(5,"number"),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(4),e.SpI("Kho\u1ea3ng c\xe1ch: ",e.i5U(5,1,t.distance_km,"1.1-1")," km")}}function K(n,r){if(1&n&&(e.j41(0,"div",98)(1,"span",99),e.EFF(2,"\u{1f550}"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&n){const t=e.XpG().$implicit,i=e.XpG(8);e.R7$(4),e.SpI("Check-in: ",i.formatTimeOfDay(t.expected_checkin_time),"")}}function X(n,r){if(1&n&&(e.j41(0,"div",98)(1,"span",99),e.EFF(2,"\u{1f550}"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&n){const t=e.XpG().$implicit,i=e.XpG(8);e.R7$(4),e.SpI("Check-out: ",i.formatTimeOfDay(t.expected_checkout_time),"")}}function Y(n,r){if(1&n&&(e.j41(0,"div",83)(1,"div",84)(2,"div",85),e.EFF(3),e.k0s(),e.DNE(4,V,1,0,"div",86),e.k0s(),e.j41(5,"div",87)(6,"div",88)(7,"div",89),e.EFF(8),e.k0s(),e.j41(9,"span",90),e.EFF(10),e.k0s()(),e.j41(11,"div",91),e.DNE(12,M,5,1,"div",92)(13,N,5,1,"div",92)(14,B,6,4,"div",93)(15,K,5,1,"div",93)(16,X,5,1,"div",93),e.k0s()()()),2&n){const t=r.$implicit,i=r.index,a=r.last;e.R7$(2),e.Y8G("ngClass",e.sMw(11,S,"pickup"===t.stop_type||t.stop_type&&t.stop_type.toLowerCase().includes("l\u1ea5y"),"delivery"===t.stop_type||t.stop_type&&t.stop_type.toLowerCase().includes("giao"),!t.stop_type)),e.R7$(),e.SpI(" ",t.stt||i+1," "),e.R7$(),e.Y8G("ngIf",!a),e.R7$(4),e.JRh(t.stop_name||"Stop "+(i+1)),e.R7$(),e.Y8G("ngClass",e.sMw(15,I,"pickup"===t.stop_type||t.stop_type&&t.stop_type.toLowerCase().includes("l\u1ea5y"),"delivery"===t.stop_type||t.stop_type&&t.stop_type.toLowerCase().includes("giao"),!t.stop_type)),e.R7$(),e.SpI(" ",t.stop_type||"N/A"," "),e.R7$(2),e.Y8G("ngIf",t.pickup_weight_kg),e.R7$(),e.Y8G("ngIf",t.delivery_weight_kg),e.R7$(),e.Y8G("ngIf",t.distance_km),e.R7$(),e.Y8G("ngIf",t.expected_checkin_time),e.R7$(),e.Y8G("ngIf",t.expected_checkout_time)}}function U(n,r){if(1&n&&(e.j41(0,"div",81),e.DNE(1,Y,17,19,"div",82),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngForOf",t.demands)}}function O(n,r){if(1&n&&(e.j41(0,"div",72)(1,"div",73)(2,"div",44)(3,"div",45)(4,"div",46),e.EFF(5,"\u{1f69a}"),e.k0s(),e.j41(6,"div",74),e.EFF(7),e.k0s()(),e.j41(8,"div",75)(9,"div",76)(10,"span"),e.EFF(11,"\u{1f4e6}"),e.k0s(),e.j41(12,"span"),e.EFF(13),e.nI1(14,"number"),e.k0s()(),e.j41(15,"div",77)(16,"span"),e.EFF(17,"\u{1f4ec}"),e.k0s(),e.j41(18,"span"),e.EFF(19),e.nI1(20,"number"),e.k0s()(),e.j41(21,"div",78)(22,"span"),e.EFF(23,"\u{1f6e3}\ufe0f"),e.k0s(),e.j41(24,"span"),e.EFF(25),e.nI1(26,"number"),e.k0s()()()()(),e.j41(27,"div",79),e.DNE(28,U,2,1,"div",80),e.k0s()()),2&n){const t=r.$implicit,i=r.index,a=e.XpG(6);e.R7$(7),e.JRh(t.vehicle_id||t.id||"Xe "+(i+1)),e.R7$(6),e.SpI("",e.i5U(14,5,a.getVehiclePickupWeight(t),"1.0-0")," kg"),e.R7$(6),e.SpI("",e.i5U(20,8,a.getVehicleDeliveryWeight(t),"1.0-0")," kg"),e.R7$(6),e.SpI("",e.i5U(26,11,a.getVehicleDistance(t),"1.1-1")," km"),e.R7$(3),e.Y8G("ngIf",t.demands&&t.demands.length>0)}}function L(n,r){if(1&n&&(e.j41(0,"div",70),e.DNE(1,O,29,14,"div",71),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngForOf",t.vehicles)}}function J(n,r){if(1&n&&(e.qex(0),e.j41(1,"div",65)(2,"div",44)(3,"div",45)(4,"div",66),e.EFF(5,"\u{1f4c5}"),e.k0s(),e.j41(6,"div")(7,"div",67),e.EFF(8),e.k0s(),e.j41(9,"div",68),e.EFF(10),e.k0s()()()()(),e.DNE(11,L,2,1,"div",69),e.bVm()),2&n){const t=r.$implicit;e.R7$(8),e.JRh(t.shift_name||t.name||"Shift"),e.R7$(2),e.SpI("",(t.vehicles||e.lJ4(3,x)).length," ph\u01b0\u01a1ng ti\u1ec7n"),e.R7$(),e.Y8G("ngIf",t.vehicles&&t.vehicles.length>0)}}function z(n,r){if(1&n&&(e.j41(0,"div",64),e.DNE(1,J,12,4,"ng-container",3),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.getActiveShift())}}function W(n,r){if(1&n&&(e.j41(0,"td",112),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2),i=t.$implicit,a=t.index;e.BMQ("rowspan",(null==i.demands?null:i.demands.length)||1),e.R7$(),e.SpI(" ",i.vehicle_id||i.id||"Xe "+(a+1)," ")}}function H(n,r){if(1&n&&(e.j41(0,"tr",109),e.DNE(1,W,2,2,"td",110),e.j41(2,"td",111),e.EFF(3),e.k0s(),e.j41(4,"td",111),e.EFF(5),e.k0s(),e.j41(6,"td",111),e.EFF(7),e.k0s(),e.j41(8,"td",111),e.EFF(9),e.k0s(),e.j41(10,"td",111),e.EFF(11),e.k0s(),e.j41(12,"td",111),e.EFF(13),e.k0s(),e.j41(14,"td",111),e.EFF(15),e.k0s(),e.j41(16,"td",111),e.EFF(17),e.k0s(),e.j41(18,"td",111),e.EFF(19),e.k0s(),e.j41(20,"td",111),e.EFF(21),e.nI1(22,"number"),e.k0s()()),2&n){const t=r.$implicit,i=r.index,a=r.first,o=e.XpG(7);e.R7$(),e.Y8G("ngIf",a),e.R7$(2),e.JRh(t.stt||i+1),e.R7$(2),e.JRh(t.stop_name||"-"),e.R7$(2),e.JRh(t.stop_type||"-"),e.R7$(2),e.JRh(o.formatKg(t.pickup_weight_kg)),e.R7$(2),e.JRh(o.formatKg(t.delivery_weight_kg)),e.R7$(2),e.SpI(" ",t.expected_checkin_time?o.formatTimeOfDay(t.expected_checkin_time):"-"," "),e.R7$(2),e.SpI(" ",t.expected_checkout_time?o.formatTimeOfDay(t.expected_checkout_time):"-"," "),e.R7$(2),e.SpI(" ",t.processing_time?o.formatDuration(t.processing_time):"-"," "),e.R7$(2),e.SpI(" ",t.travel_time?o.formatDuration(t.travel_time):"-"," "),e.R7$(2),e.SpI(" ",t.distance_km?e.i5U(22,11,t.distance_km,"1.3-3"):"-"," ")}}function q(n,r){if(1&n&&(e.qex(0),e.DNE(1,H,23,14,"tr",108),e.bVm()),2&n){const t=r.$implicit;e.R7$(),e.Y8G("ngForOf",t.demands)}}function Q(n,r){if(1&n&&(e.j41(0,"div",102)(1,"table",103)(2,"thead",104)(3,"tr")(4,"th",105),e.EFF(5,"Vehicle"),e.k0s(),e.j41(6,"th",105),e.EFF(7,"#"),e.k0s(),e.j41(8,"th",105),e.EFF(9,"Stop"),e.k0s(),e.j41(10,"th",105),e.EFF(11,"Type"),e.k0s(),e.j41(12,"th",105),e.EFF(13,"Pickup"),e.k0s(),e.j41(14,"th",105),e.EFF(15,"Delivery"),e.k0s(),e.j41(16,"th",105),e.EFF(17,"Check-in"),e.k0s(),e.j41(18,"th",105),e.EFF(19,"Check-out"),e.k0s(),e.j41(20,"th",105),e.EFF(21,"Processing"),e.k0s(),e.j41(22,"th",105),e.EFF(23,"Travel"),e.k0s(),e.j41(24,"th",105),e.EFF(25,"Dist (km)"),e.k0s()()(),e.j41(26,"tbody",106),e.DNE(27,q,2,1,"ng-container",107),e.k0s()()()),2&n){const t=e.XpG().$implicit;e.R7$(27),e.Y8G("ngForOf",t.vehicles)}}function Z(n,r){if(1&n&&(e.qex(0),e.DNE(1,Q,28,1,"div",101),e.bVm()),2&n){const t=r.$implicit;e.R7$(),e.Y8G("ngIf",t.vehicles&&t.vehicles.length>0)}}function ee(n,r){if(1&n&&(e.j41(0,"div",100),e.DNE(1,Z,2,1,"ng-container",3),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.getActiveShift())}}function te(n,r){1&n&&(e.j41(0,"div",113),e.qSk(),e.j41(1,"svg",114),e.nrm(2,"path",115)(3,"path",116),e.k0s(),e.joV(),e.j41(4,"p",117),e.EFF(5,"Ch\u01b0a ch\u1ecdn plan"),e.k0s(),e.j41(6,"p",118),e.EFF(7,"Ch\u1ecdn ho\u1eb7c upload plan \u0111\u1ec3 xem preview"),e.k0s()())}function ie(n,r){if(1&n){const t=e.RV6();e.j41(0,"div",42)(1,"div",43)(2,"div",44)(3,"div",45)(4,"div",46),e.EFF(5," \u{1f441}\ufe0f "),e.k0s(),e.j41(6,"div")(7,"h4",47),e.EFF(8,"Xem tr\u01b0\u1edbc"),e.k0s(),e.j41(9,"p",48),e.EFF(10,"Xem tr\u01b0\u1edbc chi ti\u1ebft l\u1ecbch t\u1ea3i"),e.k0s()()(),e.j41(11,"div",49)(12,"button",50),e.bIt("click",function(){e.eBV(t);const a=e.XpG(2);return e.Njj(a.setPreviewView("timeline"))}),e.j41(13,"span",51),e.EFF(14,"\u{1f4ca}"),e.k0s(),e.EFF(15," Timeline "),e.k0s(),e.j41(16,"button",50),e.bIt("click",function(){e.eBV(t);const a=e.XpG(2);return e.Njj(a.setPreviewView("table"))}),e.j41(17,"span",51),e.EFF(18,"\u{1f4cb}"),e.k0s(),e.EFF(19," B\u1ea3ng "),e.k0s()()()(),e.DNE(20,A,4,1,"div",52),e.j41(21,"div",53),e.DNE(22,z,2,1,"div",54)(23,ee,2,1,"div",55)(24,te,8,0,"div",56),e.k0s()()}if(2&n){const t=e.XpG(2);e.R7$(12),e.Y8G("ngClass",e.l_i(6,w,"timeline"===t.previewView,"timeline"!==t.previewView)),e.R7$(4),e.Y8G("ngClass",e.l_i(9,j,"table"===t.previewView,"table"!==t.previewView)),e.R7$(4),e.Y8G("ngIf",t.shifts&&t.shifts.length>0),e.R7$(2),e.Y8G("ngIf","timeline"===t.previewView),e.R7$(),e.Y8G("ngIf","table"===t.previewView),e.R7$(),e.Y8G("ngIf",!t.plan||!t.shifts||0===t.shifts.length)}}function ne(n,r){if(1&n&&(e.j41(0,"div",12)(1,"div",119)(2,"div",120)(3,"div",121)(4,"div",122),e.qSk(),e.j41(5,"svg",123),e.nrm(6,"path",124),e.k0s()(),e.joV(),e.j41(7,"span",125),e.EFF(8,"T\u1ef7 l\u1ec7 l\u1ea5p \u0111\u1ea7y"),e.k0s()(),e.j41(9,"div",126),e.EFF(10),e.nI1(11,"number"),e.k0s(),e.j41(12,"div",127),e.nrm(13,"div",128),e.k0s(),e.j41(14,"div",129),e.EFF(15,"T\u1ea3i tr\u1ecdng s\u1eed d\u1ee5ng TB"),e.k0s()(),e.j41(16,"div",130)(17,"div",121)(18,"div",131),e.qSk(),e.j41(19,"svg",132),e.nrm(20,"path",17)(21,"path",18),e.k0s()(),e.joV(),e.j41(22,"span",133),e.EFF(23,"T\u1ef7 l\u1ec7 xe NCC"),e.k0s()(),e.j41(24,"div",134),e.EFF(25),e.nI1(26,"number"),e.k0s(),e.j41(27,"div",135),e.nrm(28,"div",136),e.k0s(),e.j41(29,"div",21),e.EFF(30),e.k0s()(),e.j41(31,"div",137)(32,"div",121)(33,"div",138)(34,"span",139),e.EFF(35,"\u{1f4e5}"),e.k0s()(),e.j41(36,"span",140),e.EFF(37,"T\u1ef7 l\u1ec7 l\u1ea5y h\xe0ng"),e.k0s()(),e.j41(38,"div",141),e.EFF(39),e.nI1(40,"number"),e.k0s(),e.j41(41,"div",142),e.nrm(42,"div",143),e.k0s(),e.j41(43,"div",26),e.EFF(44),e.nI1(45,"number"),e.nI1(46,"number"),e.k0s()(),e.j41(47,"div",144)(48,"div",121)(49,"div",145)(50,"span",139),e.EFF(51,"\u{1f4e6}"),e.k0s()(),e.j41(52,"span",146),e.EFF(53,"T\u1ef7 l\u1ec7 giao h\xe0ng"),e.k0s()(),e.j41(54,"div",147),e.EFF(55),e.nI1(56,"number"),e.k0s(),e.j41(57,"div",148),e.nrm(58,"div",149),e.k0s(),e.j41(59,"div",32),e.EFF(60),e.nI1(61,"number"),e.nI1(62,"number"),e.k0s()()()()),2&n){const t=e.XpG(2);e.R7$(10),e.SpI("",e.i5U(11,18,t.overviewStats.vehicleUtilization,"1.1-1"),"%"),e.R7$(3),e.xc7("width",t.Math.min(t.overviewStats.vehicleUtilization,100),"%"),e.R7$(12),e.SpI("",e.i5U(26,21,t.overviewStats.nccRatio,"1.1-1"),"%"),e.R7$(3),e.xc7("width",t.overviewStats.nccRatio,"%"),e.R7$(2),e.Lme("",t.planStats.vehiclesNCC," NCC / ",t.planStats.vehiclesGHN," GHN"),e.R7$(9),e.SpI("",e.i5U(40,24,t.overviewStats.pickupRatio,"1.1-1"),"%"),e.R7$(3),e.xc7("width",t.overviewStats.pickupRatio,"%"),e.R7$(2),e.Lme(" ",e.bMT(45,27,t.planStats.totalPickupKg)," kg / ",e.bMT(46,29,t.planStats.totalPickupKg+t.planStats.totalDeliveryKg)," kg "),e.R7$(11),e.SpI("",e.i5U(56,31,t.overviewStats.deliveryRatio,"1.1-1"),"%"),e.R7$(3),e.xc7("width",t.overviewStats.deliveryRatio,"%"),e.R7$(2),e.Lme(" ",e.bMT(61,34,t.planStats.totalDeliveryKg)," kg / ",e.bMT(62,36,t.planStats.totalPickupKg+t.planStats.totalDeliveryKg)," kg ")}}function ae(n,r){if(1&n&&(e.j41(0,"div")(1,"h3",9)(2,"span"),e.EFF(3,"\u{1f4ca}"),e.k0s(),e.j41(4,"span"),e.EFF(5,"T\u1ed5ng quan l\u1ecbch t\u1ea3i"),e.k0s()(),e.DNE(6,$,74,20,"div",10)(7,G,4,0,"div",10)(8,ie,25,12,"div",11)(9,ne,63,38,"div",10),e.k0s()),2&n){const t=e.XpG();e.R7$(6),e.Y8G("ngIf",t.plan&&t.planStats),e.R7$(),e.Y8G("ngIf",!t.plan&&!t.loading),e.R7$(),e.Y8G("ngIf",t.plan),e.R7$(),e.Y8G("ngIf",t.plan&&t.planStats&&t.overviewStats)}}let re=(()=>{class n{cdr;route;router;planService;plan=null;planId;activeShiftIndex=0;shifts=[];previewView="timeline";loading=!1;error=null;planStats=null;overviewStats=null;Math=Math;constructor(t,i,a,o){this.cdr=t,this.route=i,this.router=a,this.planService=o}ngOnInit(){this.route.params.subscribe(t=>{this.planId=t.id,this.planId&&!this.plan&&this.loadPlanById(this.planId)})}ngOnChanges(t){if(t.plan&&this.plan){this.parsePlanData(),this.calculateStats(),this.cdr.detectChanges();try{window.planningState=window.planningState||{},window.planningState.currentPlan=this.plan,window.planningState.selectedPlan=this.plan,window.planningState.selectedPlanId=this.plan.id||this.plan.uuid||null}catch(i){console.warn("Failed to update planningState:",i)}}if(t.planId&&this.planId&&!this.plan)try{this.loadPlanById(this.planId)}catch(i){console.warn("Failed to load plan by id from Input planId",i)}}loadPlanById(t){var i=this;return(0,y.A)(function*(){i.loading=!0,i.error=null;try{i.planService.getPlan(t).subscribe({next:a=>{if(a&&a.ok&&a.data){i.plan=((d,l=3)=>{let s=d,c=0;for(;s&&c<l&&"object"==typeof s&&"data"in s&&s.data&&"object"==typeof s.data&&s.data!==s;)s=s.data,c+=1;return s})(a.data),i.plan=i.normalizePlan(i.plan),i.parsePlanData(),i.calculateStats();try{window.planningState=window.planningState||{},window.planningState.currentPlan=i.plan,window.planningState.selectedPlan=i.plan,window.planningState.selectedPlanId=i.plan.id||i.plan.uuid||null}catch(d){console.warn("Failed to update planningState:",d)}}else i.error="Kh\xf4ng th\u1ec3 t\u1ea3i plan t\u1eeb API";i.loading=!1,i.cdr.detectChanges()},error:a=>{console.error("Error fetching plan:",a),i.error="Failed to load plan details",i.loading=!1,i.cdr.detectChanges()}})}catch(a){i.error="Failed to load plan details",console.error("Error loading plan:",a),i.loading=!1,i.cdr.detectChanges()}})()}normalizePlan(t){if(!t)return t;if(Array.isArray(t.shifts)&&t.shifts.length>0)return t.shifts.forEach(a=>{a.vehicles=Array.isArray(a.vehicles)?a.vehicles:[],a.shift_name=a.shift_name||a.name||a.id||"Shift",a.vehicles.forEach(o=>{o.demands=Array.isArray(o.demands)?o.demands:[]})}),t;const i={...t};return i.shifts=Array.isArray(t.data)&&t.data.length>0?t.data.map((a,o)=>({shift_name:a.name||a.shift_name||`Shift ${o+1}`,vehicles:Array.isArray(a.vehicles)?a.vehicles:a.vehicles_list||[]})):Array.isArray(t.vehicles)&&t.vehicles.length>0?[{shift_name:"Shift 1",vehicles:t.vehicles}]:t.routes&&Array.isArray(t.routes)?[{shift_name:"Shift 1",vehicles:t.routes.map(a=>({vehicle_id:a.vehicle_id,demands:a.stops||[]}))}]:[{shift_name:"Shift 1",vehicles:[]}],i.shifts.forEach(a=>{a.vehicles=Array.isArray(a.vehicles)?a.vehicles:[],a.vehicles=a.vehicles.map((o,d)=>{const l={...o};return l.vehicle_id=l.vehicle_id||l.id||l.vehicleId||`vehicle-${d+1}`,l.demands=Array.isArray(l.demands)?l.demands:l.stops||l.demands_list||[],l.demands=l.demands.map((s,c)=>({stt:s.stt||c+1,stop_name:s.stop_name||s.name||s.address||`Stop ${c+1}`,stop_type:s.stop_type||(s.is_pickup?"pickup":"delivery"),distance_km:s.distance_km||s.distance||0,pickup_weight_kg:s.pickup_weight_kg||s.pickup_weight||s.weight_pickup||0,delivery_weight_kg:s.delivery_weight_kg||s.delivery_weight||s.weight_delivery||0,pickup_quantity:s.pickup_quantity||0,delivery_quantity:s.delivery_quantity||0,expected_checkin_time:s.expected_checkin_time,expected_checkout_time:s.expected_checkout_time,processing_time:s.processing_time,travel_time:s.travel_time,...s})),l})}),i}parsePlanData(){if(this.plan)if("number"==typeof this.plan.shifts&&"number"==typeof this.plan.vehicles)this.shifts=[{id:"shift-1",name:"Ca l\xe0m vi\u1ec7c ch\xednh",shift_name:"Ca l\xe0m vi\u1ec7c ch\xednh",vehicles:[],start_time:"06:00",end_time:"18:00"}],this.shifts[0].totalVehicles=this.plan.vehicles,this.shifts[0].totalShifts=this.plan.shifts;else if(this.shifts=this.plan.shifts||[],!this.shifts.length&&this.plan.data){const t=this.plan.data;Array.isArray(t)&&(this.shifts=t.map((i,a)=>({id:`shift-${a}`,name:i.name||`Shift ${a+1}`,shift_name:i.name||i.shift_name||`Shift ${a+1}`,vehicles:i.vehicles||[],...i})))}}calculateStats(){if(!this.plan||!this.plan.shifts)return this.planStats=null,void(this.overviewStats=null);const t=this.plan.shifts||[],i={totalShifts:t.length,totalVehicles:0,vehiclesNCC:0,vehiclesGHN:0,totalPickupQty:0,totalPickupKg:0,totalDeliveryQty:0,totalDeliveryKg:0,totalStops:0,totalDistanceKm:0,totalPayloadUsed:0,totalPayloadCapacity:0};t.forEach(se=>{const b=se.vehicles||[];i.totalVehicles+=b.length,b.forEach(g=>{const k=(g.vehicle_id||g.id||"").toString().toUpperCase();k.includes("NCC")?i.vehiclesNCC++:k.includes("GHN")&&i.vehiclesGHN++,i.totalPayloadCapacity+=g.vehicle_payload_capacity_kg||2e3;let u=0,h=0;const F=g.demands||[];i.totalStops+=F.length,F.forEach(_=>{i.totalPickupQty+=_.pickup_quantity||0,i.totalPickupKg+=_.pickup_weight_kg||0,i.totalDeliveryQty+=_.delivery_quantity||0,i.totalDeliveryKg+=_.delivery_weight_kg||0,i.totalDistanceKm+=_.distance_km||0,h+=_.pickup_weight_kg||0,h-=_.delivery_weight_kg||0,u=Math.max(u,h)}),i.totalPayloadUsed+=u})}),this.planStats=i;const l=i.totalPickupKg+i.totalDeliveryKg;this.overviewStats={vehicleUtilization:i.totalPayloadCapacity>0?i.totalPayloadUsed/i.totalPayloadCapacity*100:0,nccRatio:i.totalVehicles>0?i.vehiclesNCC/i.totalVehicles*100:0,ghnRatio:i.totalVehicles>0?i.vehiclesGHN/i.totalVehicles*100:0,pickupRatio:l>0?i.totalPickupKg/l*100:0,deliveryRatio:l>0?i.totalDeliveryKg/l*100:0}}switchToShift(t){t>=0&&t<this.shifts.length&&(this.activeShiftIndex=t)}setPreviewView(t){this.previewView=t}getActiveShift(){return this.shifts[this.activeShiftIndex]||null}getShiftIcon(t){const i=["\u{1f305}","\u2600\ufe0f","\u{1f306}","\u{1f319}"];return i[t%i.length]}getVehiclePickupWeight(t){return t.demands?t.demands.reduce((i,a)=>i+(a.pickup_weight_kg||0),0):0}getVehicleDeliveryWeight(t){return t.demands?t.demands.reduce((i,a)=>i+(a.delivery_weight_kg||0),0):0}getVehicleDistance(t){return t.demands?t.demands.reduce((i,a)=>i+(a.distance_km||0),0):0}formatTimeOfDay(t){if(null==t)return"";const i=Number(t);if(!Number.isFinite(i))return"";const a=Math.max(0,Math.floor(i)),o=Math.floor(a/3600),d=Math.floor(a%3600/60);return`${this.pad2(o)}:${this.pad2(d)}`}formatDuration(t){if(null==t)return"";const i=Number(t);if(!Number.isFinite(i))return"";const a=Math.max(0,Math.floor(i));return a<60?`${a}s`:a<3600?`${Math.floor(a/60)} ph\xfat`:`${Math.floor(a/3600)}h ${Math.floor(a%3600/60)}m`}formatKg(t){return null==t?"-":0===t||t?t+" kg":"-"}formatKm(t){return null==t?"-":0===t||t?t+" km":"-"}pad2(t){return String(t).padStart(2,"0")}static \u0275fac=function(i){return new(i||n)(e.rXU(e.gRc),e.rXU(f.nX),e.rXU(f.Ix),e.rXU(E.J))};static \u0275cmp=e.VBU({type:n,selectors:[["app-plan-preview"]],inputs:{plan:"plan",planId:"planId"},features:[e.OA$],decls:4,vars:3,consts:[["id","plan-summary-section",1,"bg-white","border-2","border-gray-300","p-6","shadow","mb-6"],["class","text-center py-12",4,"ngIf"],["class","text-center py-12 text-red-600",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-12"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-4","border-orange-500","border-t-transparent","mb-3"],[1,"text-sm","text-gray-500"],[1,"text-center","py-12","text-red-600"],[1,"text-base","font-medium"],[1,"text-lg","font-bold","text-gray-900","uppercase","mb-6","flex","items-center","gap-2"],["class","mb-6",4,"ngIf"],["class","border-t-2 border-gray-200 pt-6 mb-6",4,"ngIf"],[1,"mb-6"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-6","gap-4"],[1,"bg-gradient-to-br","from-blue-50","to-blue-100","p-4","rounded-lg","border","border-blue-200","shadow-sm"],[1,"flex","items-center","gap-2","mb-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-blue-600"],["d","M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"],["d","M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"],[1,"text-xs","font-semibold","text-blue-700","uppercase"],[1,"text-3xl","font-bold","text-blue-900","mb-1"],[1,"text-xs","text-blue-600"],[1,"bg-gradient-to-br","from-green-50","to-green-100","p-4","rounded-lg","border","border-green-200","shadow-sm"],[1,"text-xl"],[1,"text-xs","font-semibold","text-green-700","uppercase"],[1,"text-3xl","font-bold","text-green-900","mb-1"],[1,"text-xs","text-green-600"],[1,"text-2xl","font-bold","text-green-900","mb-1"],[1,"text-base","font-normal"],[1,"bg-gradient-to-br","from-orange-50","to-orange-100","p-4","rounded-lg","border","border-orange-200","shadow-sm"],[1,"text-xs","font-semibold","text-orange-700","uppercase"],[1,"text-3xl","font-bold","text-orange-900","mb-1"],[1,"text-xs","text-orange-600"],[1,"text-2xl","font-bold","text-orange-900","mb-1"],[1,"bg-gradient-to-br","from-purple-50","to-purple-100","p-4","rounded-lg","border","border-purple-200","shadow-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-purple-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"],[1,"text-xs","font-semibold","text-purple-700","uppercase"],[1,"text-2xl","font-bold","text-purple-900","mb-1"],[1,"text-xs","text-purple-600"],[1,"text-center","py-8","text-gray-400"],[1,"text-sm"],[1,"border-t-2","border-gray-200","pt-6","mb-6"],[1,"bg-gradient-to-r","from-gray-50","to-white","border","border-gray-200","rounded-lg","p-4","mb-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-primary/10","rounded-lg","flex","items-center","justify-center","text-xl"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500","mt-0.5"],[1,"flex","gap-2"],["type","button",1,"px-4","py-2","text-sm","font-medium","rounded-lg","transition-all",3,"click","ngClass"],[1,"mr-1.5"],["class","mb-4",4,"ngIf"],[1,"border","border-gray-200","rounded-lg","bg-white","shadow-sm"],["class","p-6 space-y-6",4,"ngIf"],["class","p-6",4,"ngIf"],["class","text-center py-16 text-gray-400",4,"ngIf"],[1,"mb-4"],[1,"bg-gradient-to-r","from-gray-100","to-gray-50","rounded-t-xl","px-2","py-2"],["aria-label","Shift Tabs",1,"flex","gap-2"],["type","button","class","px-5 py-3 text-sm font-medium rounded-t-lg transition-all",3,"ngClass","click",4,"ngFor","ngForOf"],["type","button",1,"px-5","py-3","text-sm","font-medium","rounded-t-lg","transition-all",3,"click","ngClass"],[1,"text-base","mr-2"],[1,"ml-2","text-xs","px-2","py-0.5","rounded-full",3,"ngClass"],[1,"p-6","space-y-6"],[1,"bg-gradient-to-r","from-primary/5","to-primary/10","border","border-primary/20","rounded-xl","p-4","mb-6"],[1,"w-12","h-12","bg-white","rounded-lg","flex","items-center","justify-center","text-2xl","shadow-sm"],[1,"text-base","font-bold","text-gray-900"],[1,"text-xs","text-gray-600","mt-0.5"],["class","space-y-4",4,"ngIf"],[1,"space-y-4"],["class","bg-white border-2 border-gray-200 rounded-xl overflow-hidden hover:border-primary/30 transition-all shadow-sm",4,"ngFor","ngForOf"],[1,"bg-white","border-2","border-gray-200","rounded-xl","overflow-hidden","hover:border-primary/30","transition-all","shadow-sm"],[1,"bg-gradient-to-r","from-gray-50","to-white","p-4","border-b","border-gray-200"],[1,"font-bold","text-gray-900"],[1,"flex","gap-4","text-xs"],[1,"flex","items-center","gap-1.5","text-green-700","bg-green-50","px-3","py-1.5","rounded-lg","font-medium"],[1,"flex","items-center","gap-1.5","text-blue-700","bg-blue-50","px-3","py-1.5","rounded-lg","font-medium"],[1,"flex","items-center","gap-1.5","text-purple-700","bg-purple-50","px-3","py-1.5","rounded-lg","font-medium"],[1,"p-4"],["class","space-y-3",4,"ngIf"],[1,"space-y-3"],["class","flex gap-4",4,"ngFor","ngForOf"],[1,"flex","gap-4"],[1,"flex","flex-col","items-center"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm","font-bold","shadow-sm","text-white",3,"ngClass"],["class","w-0.5 flex-1 bg-gray-300 mt-2",4,"ngIf"],[1,"flex-1","bg-gray-50","rounded-lg","p-3","border","border-gray-200"],[1,"flex","items-start","justify-between","gap-2","mb-2"],[1,"font-semibold","text-gray-900","text-sm"],[1,"text-xs","px-2","py-1","rounded-full","font-medium",3,"ngClass"],[1,"grid","grid-cols-2","gap-2","text-xs","text-gray-600"],["class","flex items-center gap-1",4,"ngIf"],["class","flex items-center gap-1 col-span-2",4,"ngIf"],[1,"w-0.5","flex-1","bg-gray-300","mt-2"],[1,"flex","items-center","gap-1"],[1,"text-green-600"],[1,"text-blue-600"],[1,"flex","items-center","gap-1","col-span-2"],[1,"text-gray-500"],[1,"p-6"],["class","overflow-x-auto",4,"ngIf"],[1,"overflow-x-auto"],[1,"min-w-full","text-xs","border-collapse"],[1,"bg-gray-100"],[1,"px-3","py-2","text-left","font-semibold","text-gray-700","border","border-gray-300"],[1,"divide-y"],[4,"ngFor","ngForOf"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],["class","px-3 py-2 font-semibold text-gray-900 bg-orange-50 border border-gray-300 align-top",4,"ngIf"],[1,"px-3","py-2","border","border-gray-300"],[1,"px-3","py-2","font-semibold","text-gray-900","bg-orange-50","border","border-gray-300","align-top"],[1,"text-center","py-16","text-gray-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","opacity-30"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"text-base","font-medium","text-gray-500"],[1,"text-sm","text-gray-400","mt-2"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-teal-50","to-teal-100","p-5","rounded-xl","border","border-teal-200","shadow-sm","hover:shadow-md","transition-shadow"],[1,"flex","items-center","gap-3","mb-3"],[1,"p-2","bg-teal-200","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-teal-700"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"text-sm","font-semibold","text-teal-700","uppercase"],[1,"text-4xl","font-bold","text-teal-900","mb-2"],[1,"w-full","bg-teal-200","rounded-full","h-2","mb-2"],[1,"bg-teal-600","h-2","rounded-full","transition-all"],[1,"text-xs","text-teal-600"],[1,"bg-gradient-to-br","from-blue-50","to-blue-100","p-5","rounded-xl","border","border-blue-200","shadow-sm","hover:shadow-md","transition-shadow"],[1,"p-2","bg-blue-200","rounded-lg"],["fill","currentColor","viewBox","0 0 20 20",1,"w-6","h-6","text-blue-700"],[1,"text-sm","font-semibold","text-blue-700","uppercase"],[1,"text-4xl","font-bold","text-blue-900","mb-2"],[1,"w-full","bg-blue-200","rounded-full","h-2","mb-2"],[1,"bg-blue-600","h-2","rounded-full","transition-all"],[1,"bg-gradient-to-br","from-green-50","to-green-100","p-5","rounded-xl","border","border-green-200","shadow-sm","hover:shadow-md","transition-shadow"],[1,"p-2","bg-green-200","rounded-lg"],[1,"text-2xl"],[1,"text-sm","font-semibold","text-green-700","uppercase"],[1,"text-4xl","font-bold","text-green-900","mb-2"],[1,"w-full","bg-green-200","rounded-full","h-2","mb-2"],[1,"bg-green-600","h-2","rounded-full","transition-all"],[1,"bg-gradient-to-br","from-orange-50","to-orange-100","p-5","rounded-xl","border","border-orange-200","shadow-sm","hover:shadow-md","transition-shadow"],[1,"p-2","bg-orange-200","rounded-lg"],[1,"text-sm","font-semibold","text-orange-700","uppercase"],[1,"text-4xl","font-bold","text-orange-900","mb-2"],[1,"w-full","bg-orange-200","rounded-full","h-2","mb-2"],[1,"bg-orange-600","h-2","rounded-full","transition-all"]],template:function(i,a){1&i&&(e.j41(0,"div",0),e.DNE(1,P,4,0,"div",1)(2,R,3,1,"div",2)(3,ae,10,4,"div",3),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",a.loading),e.R7$(),e.Y8G("ngIf",a.error&&!a.loading),e.R7$(),e.Y8G("ngIf",!a.loading&&!a.error))},dependencies:[v.MD,v.YU,v.Sq,v.bT,v.QX],encapsulation:2})}return n})()}}]);