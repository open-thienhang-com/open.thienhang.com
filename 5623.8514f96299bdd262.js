"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[5623],{5623:(Y,v,d)=>{d.r(v),d.d(v,{CostEstimationComponent:()=>U});var T=d(467),h=d(2881),t=d(1360),$=d(5315);function B(o,l){1&o&&(t.qSk(),t.j41(0,"svg",18),t.nrm(1,"path",19),t.k0s())}function I(o,l){1&o&&t.nrm(0,"div",20)}function N(o,l){if(1&o&&(t.j41(0,"div",21)(1,"div",22)(2,"p",23),t.EFF(3,"T\u1ed5ng Chi Ph\xed"),t.k0s(),t.j41(4,"p",24),t.EFF(5),t.k0s(),t.j41(6,"p",25),t.EFF(7,"To\xe0n b\u1ed9"),t.k0s()(),t.j41(8,"div",26)(9,"p",23),t.EFF(10,"Nhi\xean Li\u1ec7u"),t.k0s(),t.j41(11,"p",24),t.EFF(12),t.k0s(),t.j41(13,"p",25),t.EFF(14),t.k0s()(),t.j41(15,"div",27)(16,"p",23),t.EFF(17,"L\u01b0\u01a1ng T\xe0i X\u1ebf"),t.k0s(),t.j41(18,"p",24),t.EFF(19),t.k0s(),t.j41(20,"p",25),t.EFF(21),t.k0s()(),t.j41(22,"div",28)(23,"p",23),t.EFF(24,"Nh\xe0 Cung C\u1ea5p"),t.k0s(),t.j41(25,"p",24),t.EFF(26),t.k0s(),t.j41(27,"p",25),t.EFF(28),t.k0s()(),t.j41(29,"div",29)(30,"p",23),t.EFF(31,"Chi Ph\xed Kh\xe1c"),t.k0s(),t.j41(32,"p",24),t.EFF(33),t.k0s(),t.j41(34,"p",25),t.EFF(35),t.k0s()()()),2&o){const e=t.XpG();t.R7$(5),t.JRh(e.formatCurrency(e.totals.totalCost)),t.R7$(7),t.JRh(e.formatCurrency(e.totals.fuelCost)),t.R7$(2),t.SpI("",e.totals.totalCost>0?(e.totals.fuelCost/e.totals.totalCost*100).toFixed(1):0,"%"),t.R7$(5),t.JRh(e.formatCurrency(e.totals.salaryCost)),t.R7$(2),t.SpI("",e.totals.totalCost>0?(e.totals.salaryCost/e.totals.totalCost*100).toFixed(1):0,"%"),t.R7$(5),t.JRh(e.formatCurrency(e.totals.vendorCost)),t.R7$(2),t.SpI("",e.totals.totalCost>0?(e.totals.vendorCost/e.totals.totalCost*100).toFixed(1):0,"%"),t.R7$(5),t.JRh(e.formatCurrency(e.totals.otherCost)),t.R7$(2),t.SpI("",e.totals.totalCost>0?(e.totals.otherCost/e.totals.totalCost*100).toFixed(1):0,"%")}}function P(o,l){1&o&&(t.j41(0,"div",30)(1,"div",22)(2,"p",23),t.EFF(3,"T\u1ed5ng Chi Ph\xed"),t.k0s(),t.j41(4,"p",24),t.EFF(5,"0 \u20ab"),t.k0s()(),t.j41(6,"div",26)(7,"p",23),t.EFF(8,"Nhi\xean Li\u1ec7u"),t.k0s(),t.j41(9,"p",24),t.EFF(10,"0 \u20ab"),t.k0s()(),t.j41(11,"div",27)(12,"p",23),t.EFF(13,"L\u01b0\u01a1ng T\xe0i X\u1ebf"),t.k0s(),t.j41(14,"p",24),t.EFF(15,"0 \u20ab"),t.k0s()(),t.j41(16,"div",28)(17,"p",23),t.EFF(18,"Nh\xe0 Cung C\u1ea5p"),t.k0s(),t.j41(19,"p",24),t.EFF(20,"0 \u20ab"),t.k0s()(),t.j41(21,"div",29)(22,"p",23),t.EFF(23,"Chi Ph\xed Kh\xe1c"),t.k0s(),t.j41(24,"p",24),t.EFF(25,"0 \u20ab"),t.k0s()()())}function G(o,l){1&o&&(t.j41(0,"div",31),t.nrm(1,"div",32),t.j41(2,"p",33),t.EFF(3,"\u0110ang t\xednh chi ph\xed..."),t.k0s()())}function J(o,l){1&o&&(t.j41(0,"div",34),t.EFF(1,' Ch\u1ecdn plan v\xe0 nh\u1ea5n "T\xednh Chi Ph\xed" \u0111\u1ec3 xem \u01b0\u1edbc l\u01b0\u1ee3ng '),t.k0s())}function L(o,l){if(1&o&&(t.j41(0,"tr",51)(1,"td",52),t.EFF(2),t.k0s(),t.j41(3,"td",53),t.EFF(4),t.nI1(5,"number"),t.k0s(),t.j41(6,"td",53),t.EFF(7),t.k0s(),t.j41(8,"td",53),t.EFF(9),t.k0s(),t.j41(10,"td",54),t.EFF(11),t.nI1(12,"number"),t.k0s(),t.j41(13,"td",54),t.EFF(14),t.nI1(15,"number"),t.k0s(),t.j41(16,"td",55),t.EFF(17),t.k0s(),t.j41(18,"td",55),t.EFF(19),t.k0s(),t.j41(20,"td",55),t.EFF(21),t.k0s(),t.j41(22,"td",55),t.EFF(23),t.k0s(),t.j41(24,"td",50),t.EFF(25),t.k0s()()),2&o){const e=l.$implicit,r=t.XpG(2);t.R7$(2),t.JRh(e.costType),t.R7$(2),t.JRh(t.i5U(5,11,e.capacity,"1.0-0")),t.R7$(3),t.JRh(e.vehicleCount),t.R7$(2),t.JRh(e.tripCount),t.R7$(2),t.JRh(t.i5U(12,14,e.distance,"1.2-2")),t.R7$(3),t.SpI("",t.i5U(15,17,e.avgFill,"1.1-1"),"%"),t.R7$(3),t.JRh(r.formatCurrency(e.fuel)),t.R7$(2),t.JRh(r.formatCurrency(e.salary)),t.R7$(2),t.JRh(r.formatCurrency(e.vendor)),t.R7$(2),t.JRh(r.formatCurrency(e.other||0)),t.R7$(2),t.JRh(r.formatCurrency(e.totalCost))}}function S(o,l){if(1&o&&(t.j41(0,"table",35)(1,"thead",36)(2,"tr",37)(3,"th",38),t.EFF(4,"Lo\u1ea1i Xe"),t.k0s(),t.j41(5,"th",39),t.EFF(6,"T\u1ea3i Tr\u1ecdng (kg)"),t.k0s(),t.j41(7,"th",40),t.EFF(8,"S\u1ed1 Xe"),t.k0s(),t.j41(9,"th",41),t.EFF(10,"S\u1ed1 Chuy\u1ebfn"),t.k0s(),t.j41(11,"th",42),t.EFF(12,"Qu\xe3ng \u0110\u01b0\u1eddng (km)"),t.k0s(),t.j41(13,"th",42),t.EFF(14,"T\u1ef7 L\u1ec7 L\u1ea5p \u0110\u1ea7y"),t.k0s(),t.j41(15,"th",43),t.EFF(16,"Nhi\xean Li\u1ec7u"),t.k0s(),t.j41(17,"th",43),t.EFF(18,"L\u01b0\u01a1ng"),t.k0s(),t.j41(19,"th",43),t.EFF(20,"NCC"),t.k0s(),t.j41(21,"th",43),t.EFF(22,"Chi Ph\xed Kh\xe1c"),t.k0s(),t.j41(23,"th",44),t.EFF(24,"T\u1ed5ng Chi Ph\xed"),t.k0s()()(),t.j41(25,"tbody",45),t.DNE(26,L,26,20,"tr",46),t.j41(27,"tr",47)(28,"td",48),t.EFF(29,"T\u1ed4NG C\u1ed8NG"),t.k0s(),t.j41(30,"td",49),t.EFF(31),t.nI1(32,"number"),t.k0s(),t.j41(33,"td",49),t.EFF(34,"--"),t.k0s(),t.j41(35,"td",49),t.EFF(36),t.k0s(),t.j41(37,"td",49),t.EFF(38),t.k0s(),t.j41(39,"td",49),t.EFF(40),t.k0s(),t.j41(41,"td",49),t.EFF(42),t.k0s(),t.j41(43,"td",50),t.EFF(44),t.k0s()()()()),2&o){const e=t.XpG();t.R7$(26),t.Y8G("ngForOf",e.costBreakdown),t.R7$(2),t.BMQ("colspan",4),t.R7$(3),t.JRh(t.i5U(32,8,e.totals.totalDistance,"1.2-2")),t.R7$(5),t.JRh(e.formatCurrency(e.totals.fuelCost)),t.R7$(2),t.JRh(e.formatCurrency(e.totals.salaryCost)),t.R7$(2),t.JRh(e.formatCurrency(e.totals.vendorCost)),t.R7$(2),t.JRh(e.formatCurrency(e.totals.otherCost)),t.R7$(2),t.JRh(e.formatCurrency(e.totals.totalCost))}}let U=(()=>{class o{cdr;planService;loading=!1;canCalculate=!1;showResults=!1;costBreakdown=[];totals={totalCost:0,fuelCost:0,salaryCost:0,vendorCost:0,otherCost:0,totalDistance:0};FUEL_RATE_GHN=3500;FUEL_RATE_NCC=4500;SALARY_RATE_GHN=2e3;VENDOR_RATE_NCC=5e3;constructor(e,r){this.cdr=e,this.planService=r}ngOnInit(){this.checkPlanAvailability()}checkPlanAvailability(){try{const e=window.planningState;this.canCalculate=!(!e?.currentPlan&&!e?.selectedPlan)}catch(e){console.warn("Error checking plan availability:",e),this.canCalculate=!1}}calculateCost(){var e=this;return(0,T.A)(function*(){if(e.canCalculate){e.loading=!0,e.showResults=!1;try{const r=window.planningState,s=r?.currentPlan||r?.selectedPlan;if(!s)throw new Error("Kh\xf4ng t\xecm th\u1ea5y plan \u0111\u1ec3 t\xednh chi ph\xed");yield new Promise(u=>setTimeout(u,800));const i=e.calculateCostBreakdown(s);e.costBreakdown=i.breakdown,e.totals=i.totals,e.showResults=!0}catch(r){console.error("Error calculating cost:",r),alert("L\u1ed7i khi t\xednh chi ph\xed: "+(r?.message||"Unknown error"))}finally{e.loading=!1,e.cdr.detectChanges()}}else alert("Vui l\xf2ng ch\u1ecdn plan tr\u01b0\u1edbc")})()}calculateCostBreakdown(e){if(!e||!e.shifts)return{breakdown:[],totals:{totalCost:0,fuelCost:0,salaryCost:0,vendorCost:0,otherCost:0,totalDistance:0}};let s=0,i=0,u=0,_=0;const E={};return(Array.isArray(e.shifts)?e.shifts:[]).forEach(g=>{(Array.isArray(g.vehicles)?g.vehicles:[]).forEach(c=>{const R=(c.vehicle_id||c.id||"").toString().toUpperCase(),m=R.includes("NCC"),j=(R.includes("GHN"),m?"NCC":"GHN"),w=g.shift_name||g.name||"Unknown",C=c.vehicle_payload_capacity_kg||2e3;let n=0,D=0,y=0;if((Array.isArray(c.demands)?c.demands:[]).forEach(k=>{n+=k.distance_km||0,D+=(k.pickup_weight_kg||0)+(k.delivery_weight_kg||0),y++}),0===n)return;const f=`${j}-${w}-${C}`;E[f]||(E[f]={costType:j,routeType:w,capacity:C,vehicleCount:0,tripCount:0,distance:0,avgFill:0,fuel:0,salary:0,vendor:0,other:0,totalCost:0});const a=E[f];a.vehicleCount++,a.tripCount++,a.distance+=n;let p=0,F=0,b=0;m?(p=n*this.FUEL_RATE_NCC,b=n*this.VENDOR_RATE_NCC):(p=n*this.FUEL_RATE_GHN,F=n*this.SALARY_RATE_GHN),a.fuel+=p,a.salary+=F,a.vendor+=b,a.totalCost+=p+F+b;const A=C>0&&y>0?D/y/C*100:0,x=a.distance;a.avgFill=x>0?(a.avgFill*(x-n)+A*n)/x:A,s+=p,i+=F,u+=b,_+=n})}),{breakdown:Object.values(E),totals:{totalCost:s+i+u,fuelCost:s,salaryCost:i,vendorCost:u,otherCost:0,totalDistance:_}}}formatCurrency(e){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}static \u0275fac=function(r){return new(r||o)(t.rXU(t.gRc),t.rXU($.J))};static \u0275cmp=t.VBU({type:o,selectors:[["app-cost-estimation"]],decls:23,vars:9,consts:[[1,"bg-white","border-2","border-blue-400","shadow","mb-6"],[1,"px-6","py-4","space-y-4"],[1,"flex","items-center","justify-between","pb-3","border-b","border-blue-200"],[1,"flex","items-center","gap-2"],[1,"text-2xl"],[1,"text-xl","font-bold","text-blue-900"],[1,"text-xs","bg-blue-100","text-blue-700","px-2","py-1","rounded"],[1,"inline-flex","items-center","gap-2","px-4","py-2","bg-blue-600","hover:bg-blue-700","text-white","text-sm","font-semibold","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","w-4 h-4","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],["class","inline-block animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent",4,"ngIf"],["class","grid grid-cols-2 lg:grid-cols-5 gap-4",4,"ngIf"],["class","grid grid-cols-2 lg:grid-cols-5 gap-4 opacity-50",4,"ngIf"],[1,"border-t-2","border-blue-200"],[1,"overflow-x-auto"],[1,"max-h-[600px]","overflow-y-auto"],["class","px-6 py-8 text-center",4,"ngIf"],["class","px-6 py-8 text-center text-sm text-blue-600 uppercase font-semibold",4,"ngIf"],["class","w-full divide-y divide-gray-300","style","table-layout: auto;",4,"ngIf"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"],[1,"inline-block","animate-spin","rounded-full","h-4","w-4","border-2","border-white","border-t-transparent"],[1,"grid","grid-cols-2","lg:grid-cols-5","gap-4"],[1,"bg-gradient-to-br","from-gray-700","to-gray-900","text-white","p-4","rounded-lg","border-l-4","border-gray-900"],[1,"text-xs","font-semibold","uppercase","opacity-90","mb-1"],[1,"text-2xl","font-bold"],[1,"text-xs","opacity-75","mt-1"],[1,"bg-gradient-to-br","from-yellow-400","to-yellow-600","text-white","p-4","rounded-lg","border-l-4","border-yellow-700"],[1,"bg-gradient-to-br","from-orange-400","to-orange-600","text-white","p-4","rounded-lg","border-l-4","border-orange-700"],[1,"bg-gradient-to-br","from-blue-400","to-blue-600","text-white","p-4","rounded-lg","border-l-4","border-blue-700"],[1,"bg-gradient-to-br","from-purple-400","to-purple-600","text-white","p-4","rounded-lg","border-l-4","border-purple-700"],[1,"grid","grid-cols-2","lg:grid-cols-5","gap-4","opacity-50"],[1,"px-6","py-8","text-center"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-4","border-blue-500","border-t-transparent","mb-2"],[1,"text-sm","text-gray-600"],[1,"px-6","py-8","text-center","text-sm","text-blue-600","uppercase","font-semibold"],[1,"w-full","divide-y","divide-gray-300",2,"table-layout","auto"],[1,"sticky","top-0","z-10"],[1,"bg-gradient-to-r","from-blue-200","to-blue-100"],[1,"px-4","py-3","text-left","text-xs","font-bold","text-gray-900","uppercase",2,"min-width","120px","border-right","1px solid #d1d5db"],[1,"px-4","py-3","text-center","text-xs","font-bold","text-gray-900","uppercase","w-32","border-r","border-gray-300"],[1,"px-4","py-3","text-center","text-xs","font-bold","text-gray-900","uppercase","w-24","border-r","border-gray-300"],[1,"px-4","py-3","text-center","text-xs","font-bold","text-gray-900","uppercase","w-28","border-r","border-gray-300"],[1,"px-4","py-3","text-right","text-xs","font-bold","text-gray-900","uppercase","w-32","border-r","border-gray-300"],[1,"px-4","py-3","text-right","text-xs","font-bold","text-gray-900","uppercase",2,"min-width","140px","border-right","1px solid #d1d5db"],[1,"px-4","py-3","text-right","text-xs","font-bold","text-gray-900","uppercase",2,"min-width","160px"],[1,"bg-white","divide-y-2","divide-gray-400"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-gray-100","font-bold"],[1,"px-4","py-3","text-sm","font-bold","text-gray-900","border-r","border-gray-300"],[1,"px-4","py-3","text-sm","text-right","font-bold","text-gray-900","border-r","border-gray-300"],[1,"px-4","py-3","text-sm","text-right","font-bold","text-blue-900"],[1,"hover:bg-gray-50"],[1,"px-4","py-3","text-sm","font-medium","text-gray-900","border-r","border-gray-300"],[1,"px-4","py-3","text-sm","text-center","border-r","border-gray-300"],[1,"px-4","py-3","text-sm","text-right","border-r","border-gray-300"],[1,"px-4","py-3","text-sm","text-right","font-medium","border-r","border-gray-300"]],template:function(r,s){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),t.EFF(5,"\u{1f4b0}"),t.k0s(),t.j41(6,"h3",5),t.EFF(7,"\u01af\u1edbc l\u01b0\u1ee3ng chi ph\xed v\u1eadn t\u1ea3i"),t.k0s(),t.j41(8,"span",6),t.EFF(9,"Cost Estimation"),t.k0s()(),t.j41(10,"button",7),t.bIt("click",function(){return s.calculateCost()}),t.DNE(11,B,2,0,"svg",8)(12,I,1,0,"div",9),t.j41(13,"span"),t.EFF(14),t.k0s()()(),t.DNE(15,N,36,9,"div",10)(16,P,26,0,"div",11),t.k0s(),t.nrm(17,"div",12),t.j41(18,"div",13)(19,"div",14),t.DNE(20,G,4,0,"div",15)(21,J,2,0,"div",16)(22,S,45,11,"table",17),t.k0s()()()),2&r&&(t.R7$(10),t.Y8G("disabled",!s.canCalculate||s.loading),t.R7$(),t.Y8G("ngIf",!s.loading),t.R7$(),t.Y8G("ngIf",s.loading),t.R7$(2),t.JRh(s.loading?"\u0110ang t\xednh to\xe1n...":"T\xednh Chi Ph\xed"),t.R7$(),t.Y8G("ngIf",s.showResults),t.R7$(),t.Y8G("ngIf",!s.showResults&&!s.loading),t.R7$(4),t.Y8G("ngIf",s.loading),t.R7$(),t.Y8G("ngIf",!s.showResults&&!s.loading),t.R7$(),t.Y8G("ngIf",s.showResults&&s.costBreakdown.length>0))},dependencies:[h.MD,h.Sq,h.bT,h.QX],encapsulation:2})}return o})()}}]);