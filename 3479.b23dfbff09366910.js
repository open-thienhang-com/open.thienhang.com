"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[3479],{3479:(A,C,g)=>{g.r(C),g.d(C,{CustomersComponent:()=>B});var p=g(2881),d=g(9417),y=g(5207),h=g(1141),v=g(491),M=g(8150),P=g(8559),f=g(6221),b=g(6150),O=g(7722),D=g(5716),E=g(935),_=g(5779),R=g(5545),e=g(1360);function k(o,l){if(1&o&&(e.j41(0,"p-card",16)(1,"div",17),e.nrm(2,"p-chart",18),e.k0s()()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("data",t.customerTrendChartData)("options",t.customerTrendChartOptions)}}function F(o,l){if(1&o&&(e.j41(0,"p-card",19)(1,"div",17),e.nrm(2,"p-chart",20),e.k0s()()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("data",t.segmentChartData)("options",t.segmentChartOptions)}}function w(o,l){1&o&&(e.j41(0,"tr")(1,"th"),e.EFF(2,"Segment"),e.k0s(),e.j41(3,"th"),e.EFF(4,"Number of Customers"),e.k0s(),e.j41(5,"th"),e.EFF(6,"Total Revenue"),e.k0s(),e.j41(7,"th"),e.EFF(8,"Average Rating"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Average Revenue per Customer"),e.k0s()())}function T(o,l){if(1&o&&(e.j41(0,"tr")(1,"td"),e.nrm(2,"p-tag",26),e.k0s(),e.j41(3,"td")(4,"span",27),e.EFF(5),e.k0s()(),e.j41(6,"td")(7,"span",28),e.EFF(8),e.nI1(9,"currency"),e.k0s()(),e.j41(10,"td")(11,"span",29),e.EFF(12),e.nI1(13,"number"),e.k0s()(),e.j41(14,"td")(15,"span",30),e.EFF(16),e.nI1(17,"currency"),e.k0s()()()),2&o){const t=l.$implicit,a=e.XpG(2);e.R7$(2),e.Y8G("value",t.segment)("severity",a.getSegmentSeverity(t.segment)),e.R7$(3),e.JRh(t.count),e.R7$(3),e.JRh(e.bMT(9,6,t.revenue)),e.R7$(4),e.JRh(e.i5U(13,8,t.averageRating,"1.1-1")),e.R7$(4),e.SpI(" ",e.bMT(17,11,a.getAverageRevenuePerCustomer(t))," ")}}function S(o,l){1&o&&(e.j41(0,"tr")(1,"td",31)(2,"div",32),e.nrm(3,"i",33),e.j41(4,"p"),e.EFF(5,"No customer data available"),e.k0s()()()())}function j(o,l){if(1&o&&(e.j41(0,"p-card",21)(1,"p-table",22),e.DNE(2,w,11,0,"ng-template",23)(3,T,18,13,"ng-template",24)(4,S,6,0,"ng-template",25),e.k0s()()),2&o){const t=e.XpG();e.R7$(),e.Y8G("value",t.customerSegments)("paginator",!0)("rows",10)}}function I(o,l){1&o&&(e.j41(0,"div",34),e.nrm(1,"p-skeleton",35),e.k0s())}let B=(()=>{class o{hotelService;messageService;bookings=[];reviews=[];ratings=[];loading=!1;selectedPeriod="month";periodOptions=[{label:"Last 7 Days",value:"week"},{label:"Last 30 Days",value:"month"},{label:"Last 3 Months",value:"quarter"},{label:"Last Year",value:"year"}];customerTrendChartData;customerTrendChartOptions;segmentChartData;segmentChartOptions;totalCustomers=0;newCustomers=0;returningCustomers=0;averageRating=0;customerSegments=[];constructor(t,a){this.hotelService=t,this.messageService=a}ngOnInit(){this.loadData()}loadData(){this.loading=!0,Promise.all([this.hotelService.getBookings().toPromise(),this.hotelService.getReviews().toPromise(),this.hotelService.getRatings().toPromise()]).then(([t,a,s])=>{this.bookings=t?.data||[],this.reviews=a?.data||[],this.ratings=s?.data||[],this.processCustomerData(),this.loading=!1}).catch(()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load customer data"}),this.loading=!1})}processCustomerData(){const t=this.getFilteredBookings();this.calculateCustomerMetrics(t),this.buildTrendChart(t),this.buildSegmentData(t)}getFilteredBookings(){const t=new Date;let a=new Date;switch(this.selectedPeriod){case"week":a.setDate(t.getDate()-7);break;case"month":a.setDate(t.getDate()-30);break;case"quarter":a.setMonth(t.getMonth()-3);break;case"year":a.setFullYear(t.getFullYear()-1)}return this.bookings.filter(s=>{const n=new Date(s.created);return n>=a&&n<=t})}calculateCustomerMetrics(t){const a=new Map;t.forEach(n=>{const i=a.get(n.account_id);if(i){i.bookings.push(n);const r=new Date(n.created);r<i.firstBooking&&(i.firstBooking=r)}else a.set(n.account_id,{firstBooking:new Date(n.created),bookings:[n]})}),this.totalCustomers=a.size;const s=this.getPeriodStart();this.newCustomers=Array.from(a.values()).filter(n=>n.firstBooking>=s).length,this.returningCustomers=this.totalCustomers-this.newCustomers,this.ratings.length>0&&(this.averageRating=this.ratings.reduce((n,i)=>n+i.avg_rating,0)/this.ratings.length)}getPeriodStart(){const t=new Date;let a=new Date;switch(this.selectedPeriod){case"week":a.setDate(t.getDate()-7);break;case"month":a.setDate(t.getDate()-30);break;case"quarter":a.setMonth(t.getMonth()-3);break;case"year":a.setFullYear(t.getFullYear()-1)}return a}buildTrendChart(t){const a=this.getPeriodStart(),s=new Map,n=new Map;t.forEach(r=>{if(n.has(r.account_id)){const c=n.get(r.account_id);new Date(r.created)<c&&n.set(r.account_id,new Date(r.created))}else n.set(r.account_id,new Date(r.created))}),t.forEach(r=>{const c=new Date(r.created).toISOString().split("T")[0],m=s.get(c)||{new:0,returning:0};n.get(r.account_id)>=a?m.new++:m.returning++,s.set(c,m)});const i=Array.from(s.keys()).sort();this.customerTrendChartData={labels:i.map(r=>new Date(r).toLocaleDateString("en-US","year"===this.selectedPeriod?{month:"short",year:"numeric"}:{month:"short",day:"numeric"})),datasets:[{label:"New Customers",data:i.map(r=>s.get(r).new),backgroundColor:"rgba(59, 130, 246, 0.5)",borderColor:"rgb(59, 130, 246)"},{label:"Returning Customers",data:i.map(r=>s.get(r).returning),backgroundColor:"rgba(34, 197, 94, 0.5)",borderColor:"rgb(34, 197, 94)"}]},this.customerTrendChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Customer Acquisition Trend"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Customers"}}}}}buildSegmentData(t){const a=new Map;t.forEach(n=>{const i=a.get(n.account_id)||{bookings:[],revenue:0};i.bookings.push(n),i.revenue+=n.total_price||0,a.set(n.account_id,i)});const s=[];a.forEach((n,i)=>{const r=n.bookings.length;let c="";c=r>=5?"VIP":r>=3?"Regular":r>=2?"Occasional":"One-time";const m=s.find(u=>u.segment===c);m?(m.count++,m.revenue+=n.revenue):s.push({segment:c,count:1,revenue:n.revenue,averageRating:0})}),s.forEach(n=>{const i=Array.from(a.keys()).filter(c=>{const u=a.get(c).bookings.length;return"VIP"===n.segment&&u>=5||"Regular"===n.segment&&u>=3&&u<5||"Occasional"===n.segment&&2===u||"One-time"===n.segment&&1===u}),r=this.ratings.filter(c=>i.includes(c.account_id));r.length>0&&(n.averageRating=r.reduce((c,m)=>c+m.avg_rating,0)/r.length)}),this.customerSegments=s.sort((n,i)=>i.revenue-n.revenue),this.segmentChartData={labels:this.customerSegments.map(n=>n.segment),datasets:[{label:"Number of Customers",data:this.customerSegments.map(n=>n.count),backgroundColor:["rgba(59, 130, 246, 0.5)","rgba(34, 197, 94, 0.5)","rgba(251, 191, 36, 0.5)","rgba(239, 68, 68, 0.5)"]}]},this.segmentChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Customer Segmentation"}}}}onPeriodChange(){this.processCustomerData()}getSegmentSeverity(t){return{VIP:"success",Regular:"info",Occasional:"warning","One-time":"secondary"}[t]||"secondary"}getAverageRevenuePerCustomer(t){return t.count>0?t.revenue/t.count:0}static \u0275fac=function(a){return new(a||o)(e.rXU(R.g),e.rXU(_.bg))};static \u0275cmp=e.VBU({type:o,selectors:[["app-hotel-customers"]],features:[e.Jv_([_.bg])],decls:44,vars:12,consts:[["loadingTemplate",""],[1,"customers-page"],[1,"page-header"],[1,"header-content"],[1,"subtitle"],[1,"header-actions"],["optionLabel","label","optionValue","value",1,"period-selector",3,"ngModelChange","onChange","options","ngModel"],["pButton","","type","button","label","Refresh","icon","pi pi-refresh",1,"p-button-secondary",3,"click"],[1,"summary-cards"],[1,"summary-stat"],[1,"stat-value"],[1,"stat-label"],[1,"charts-row"],["header","Customer Acquisition Trend",4,"ngIf"],["header","Customer Segmentation",4,"ngIf"],["header","Customer Segments Details",4,"ngIf"],["header","Customer Acquisition Trend"],[1,"chart-container"],["type","bar",3,"data","options"],["header","Customer Segmentation"],["type","doughnut",3,"data","options"],["header","Customer Segments Details"],["styleClass","p-datatable-sm",3,"value","paginator","rows"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"value","severity"],[1,"customer-count"],[1,"revenue-amount"],[1,"rating-value"],[1,"avg-revenue"],["colspan","5",1,"text-center"],[1,"empty-state"],[1,"pi","pi-users"],[1,"loading-container"],["height","400px"]],template:function(a,s){if(1&a){const n=e.RV6();e.j41(0,"div",1),e.nrm(1,"p-toast"),e.j41(2,"div",2)(3,"div",3)(4,"div")(5,"h1"),e.EFF(6,"Customer Analytics"),e.k0s(),e.j41(7,"p",4),e.EFF(8,"Analyze customer behavior and segmentation"),e.k0s()(),e.j41(9,"div",5)(10,"p-dropdown",6),e.mxI("ngModelChange",function(r){return e.eBV(n),e.DH7(s.selectedPeriod,r)||(s.selectedPeriod=r),e.Njj(r)}),e.bIt("onChange",function(){return e.eBV(n),e.Njj(s.onPeriodChange())}),e.k0s(),e.j41(11,"button",7),e.bIt("click",function(){return e.eBV(n),e.Njj(s.loadData())}),e.k0s()()()(),e.j41(12,"div",8)(13,"p-card")(14,"div",9)(15,"span",10),e.EFF(16),e.k0s(),e.j41(17,"span",11),e.EFF(18,"Total Customers"),e.k0s()()(),e.j41(19,"p-card")(20,"div",9)(21,"span",10),e.EFF(22),e.k0s(),e.j41(23,"span",11),e.EFF(24,"New Customers"),e.k0s()()(),e.j41(25,"p-card")(26,"div",9)(27,"span",10),e.EFF(28),e.k0s(),e.j41(29,"span",11),e.EFF(30,"Returning Customers"),e.k0s()()(),e.j41(31,"p-card")(32,"div",9)(33,"span",10),e.EFF(34),e.nI1(35,"number"),e.k0s(),e.j41(36,"span",11),e.EFF(37,"Average Rating"),e.k0s()()()(),e.j41(38,"div",12),e.DNE(39,k,3,2,"p-card",13)(40,F,3,2,"p-card",14),e.k0s(),e.DNE(41,j,5,3,"p-card",15)(42,I,2,0,"ng-template",null,0,e.C5r),e.k0s()}2&a&&(e.R7$(10),e.Y8G("options",s.periodOptions),e.R50("ngModel",s.selectedPeriod),e.R7$(6),e.JRh(s.totalCustomers),e.R7$(6),e.JRh(s.newCustomers),e.R7$(6),e.JRh(s.returningCustomers),e.R7$(6),e.JRh(e.i5U(35,9,s.averageRating,"1.1-1")),e.R7$(5),e.Y8G("ngIf",!s.loading),e.R7$(),e.Y8G("ngIf",!s.loading),e.R7$(),e.Y8G("ngIf",!s.loading))},dependencies:[p.MD,p.bT,p.QX,p.oe,d.YN,d.BC,d.vS,y.iI,h.tm,h._f,_.Ei,v.Dw,v.Zp,M.kr,M.ms,P.Fr,P.X9,f.bG,f.XI,b.EJ,O.MB,O.y8,D.k2,D.EA,E.$C,E.vw],styles:[".customers-page[_ngcontent-%COMP%]{padding:2rem}.customers-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;background:linear-gradient(135deg,var(--p-surface-0) 0%,rgba(var(--p-primary-500),.05) 100%);padding:2rem;border-radius:12px;border-bottom:2px solid rgba(var(--p-primary-500),.2)}.customers-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.customers-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:2rem;font-weight:700;color:var(--p-surface-900)}.customers-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.95rem;color:var(--p-surface-600)}.customers-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.customers-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .period-selector[_ngcontent-%COMP%]{min-width:180px}.customers-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;margin-bottom:2rem}.customers-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem}.customers-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--p-primary-600)}.customers-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--p-surface-600);margin-top:.5rem}.customers-page[_ngcontent-%COMP%]   .charts-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:2rem;margin-bottom:2rem}@media (max-width: 1024px){.customers-page[_ngcontent-%COMP%]   .charts-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.customers-page[_ngcontent-%COMP%]   .charts-row[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{height:350px;position:relative}.customers-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{padding:2rem}.customers-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{padding:3rem;text-align:center;color:var(--p-surface-600)}.customers-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem;color:var(--p-surface-400)}.customers-page[_ngcontent-%COMP%]   .customer-count[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-700)}.customers-page[_ngcontent-%COMP%]   .revenue-amount[_ngcontent-%COMP%]{font-weight:600;color:var(--p-primary-600)}.customers-page[_ngcontent-%COMP%]   .rating-value[_ngcontent-%COMP%]{font-weight:600;color:var(--p-warning-600)}.customers-page[_ngcontent-%COMP%]   .avg-revenue[_ngcontent-%COMP%]{font-weight:500;color:var(--p-surface-600)}"]})}return o})()}}]);