"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[6779],{6779:(O,l,n)=>{n.r(l),n.d(l,{FilesStatsComponent:()=>P});var t=n(1360),p=n(2881),c=n(5207),h=n(7468),d=n(1141),m=n(6221),u=n(8559),g=n(935),_=n(5716),F=n(4631),f=n(5779);const E=()=>["/files"],y=()=>["/files/list"];function v(o,a){1&o&&(t.j41(0,"div",11)(1,"div",12),t.nrm(2,"p-skeleton",13)(3,"p-skeleton",13)(4,"p-skeleton",13),t.k0s()())}function C(o,a){1&o&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"Provider"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Files"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Size"),t.k0s()())}function R(o,a){if(1&o&&(t.j41(0,"tr")(1,"td"),t.nrm(2,"p-tag",30),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s()()),2&o){const e=a.$implicit,s=t.XpG(2);t.R7$(2),t.Y8G("value",e.provider),t.R7$(2),t.JRh(e.files),t.R7$(2),t.JRh(s.formatBytes(e.size))}}function b(o,a){1&o&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"User"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Files"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Size"),t.k0s()())}function k(o,a){if(1&o&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s()()),2&o){const e=a.$implicit,s=t.XpG(2);t.R7$(2),t.JRh(e.user),t.R7$(2),t.JRh(e.files),t.R7$(2),t.JRh(s.formatBytes(e.size))}}function j(o,a){1&o&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"Type"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Count"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Size"),t.k0s()())}function x(o,a){if(1&o&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s()()),2&o){const e=a.$implicit,s=t.XpG(2);t.R7$(2),t.JRh(e.type),t.R7$(2),t.JRh(e.count),t.R7$(2),t.JRh(s.formatBytes(e.size))}}function S(o,a){if(1&o&&(t.qex(0),t.j41(1,"div",14)(2,"div",11)(3,"p",15),t.EFF(4,"Total Files"),t.k0s(),t.j41(5,"p",16),t.EFF(6),t.k0s()(),t.j41(7,"div",11)(8,"p",15),t.EFF(9,"Total Storage"),t.k0s(),t.j41(10,"p",17),t.EFF(11),t.k0s()(),t.j41(12,"div",11)(13,"p",15),t.EFF(14,"Weekly Growth"),t.k0s(),t.j41(15,"p",18),t.EFF(16),t.k0s()(),t.j41(17,"div",11)(18,"p",15),t.EFF(19,"Monthly Growth"),t.k0s(),t.j41(20,"p",19),t.EFF(21),t.k0s()()(),t.j41(22,"div",20)(23,"div",11)(24,"h2",21),t.EFF(25,"Daily Upload Count"),t.k0s(),t.nrm(26,"p-chart",22),t.k0s(),t.j41(27,"div",11)(28,"h2",21),t.EFF(29,"Provider Storage Split"),t.k0s(),t.nrm(30,"p-chart",23),t.k0s()(),t.j41(31,"div",20)(32,"div",24)(33,"div",25)(34,"h2",26),t.EFF(35,"Storage by Provider"),t.k0s()(),t.j41(36,"p-table",27),t.DNE(37,C,7,0,"ng-template",28)(38,R,7,3,"ng-template",29),t.k0s()(),t.j41(39,"div",24)(40,"div",25)(41,"h2",26),t.EFF(42,"Top Uploaders"),t.k0s()(),t.j41(43,"p-table",27),t.DNE(44,b,7,0,"ng-template",28)(45,k,7,3,"ng-template",29),t.k0s()()(),t.j41(46,"div",24)(47,"div",25)(48,"h2",26),t.EFF(49,"File Types"),t.k0s()(),t.j41(50,"p-table",27),t.DNE(51,j,7,0,"ng-template",28)(52,x,7,3,"ng-template",29),t.k0s()(),t.bVm()),2&o){const e=t.XpG();t.R7$(6),t.JRh(e.summary.total_files),t.R7$(5),t.JRh(e.formatBytes(e.summary.total_size)),t.R7$(5),t.SpI("",e.usage.storage_trends.weekly_growth,"%"),t.R7$(5),t.SpI("",e.usage.storage_trends.monthly_growth,"%"),t.R7$(5),t.Y8G("data",e.dailyUploadsChart)("options",e.lineChartOptions),t.R7$(4),t.Y8G("data",e.providerChart)("options",e.doughnutChartOptions),t.R7$(6),t.Y8G("value",e.providerRows),t.R7$(7),t.Y8G("value",e.usage.top_uploaders),t.R7$(7),t.Y8G("value",e.fileTypeRows)}}let P=(()=>{class o{filesService=(0,t.WQX)(F.F);loading=!1;summary=null;usage=null;providerRows=[];fileTypeRows=[];dailyUploadsChart;providerChart;lineChartOptions;doughnutChartOptions;ngOnInit(){this.initChartOptions(),this.loadStats()}loadStats(){this.loading=!0,(0,h.p)({summary:this.filesService.getStatsSummary(),usage:this.filesService.getStatsUsage()}).subscribe({next:({summary:e,usage:s})=>{this.summary=e,this.usage=s,this.buildRows(),this.buildCharts(),this.loading=!1},error:e=>{console.error("Error loading files stats",e),this.loading=!1}})}buildRows(){this.summary&&(this.providerRows=Object.entries(this.summary.storage_by_provider||{}).map(([e,s])=>({provider:e,files:s.files,size:s.size})),this.fileTypeRows=Object.entries(this.summary.file_types||{}).map(([e,s])=>({type:e,count:s.count,size:s.size})))}buildCharts(){if(!this.summary||!this.usage)return;const e=getComputedStyle(document.documentElement),s=this.usage.daily_uploads||[];this.dailyUploadsChart={labels:s.map(i=>i.date),datasets:[{label:"Uploads",data:s.map(i=>i.count),borderColor:e.getPropertyValue("--blue-500"),backgroundColor:e.getPropertyValue("--blue-200"),tension:.35,fill:!0}]},this.providerChart={labels:this.providerRows.map(i=>i.provider),datasets:[{data:this.providerRows.map(i=>i.size),backgroundColor:[e.getPropertyValue("--blue-500"),e.getPropertyValue("--cyan-500"),e.getPropertyValue("--green-500"),e.getPropertyValue("--orange-500")]}]}}initChartOptions(){const e=getComputedStyle(document.documentElement),s=e.getPropertyValue("--text-color"),i=e.getPropertyValue("--surface-border");this.lineChartOptions={plugins:{legend:{labels:{color:s}}},scales:{x:{ticks:{color:s},grid:{color:i}},y:{ticks:{color:s},grid:{color:i}}}},this.doughnutChartOptions={plugins:{legend:{labels:{color:s}}}}}formatBytes(e){if(!e)return"0 B";const i=Math.floor(Math.log(e)/Math.log(1024)),r=e/Math.pow(1024,i);return`${r.toFixed(r>=10?0:1)} ${["B","KB","MB","GB","TB"][i]}`}static \u0275fac=function(s){return new(s||o)};static \u0275cmp=t.VBU({type:o,selectors:[["app-files-stats"]],decls:14,vars:10,consts:[[1,"bg-gray-50","min-h-screen","p-6"],[1,"bg-white","rounded-lg","shadow-sm","p-6","mb-6"],[1,"flex","items-center","justify-between","flex-wrap","gap-4"],[1,"text-3xl","font-bold","text-gray-900","m-0"],[1,"text-gray-600","mt-2","mb-0"],[1,"flex","flex-wrap","gap-2"],["label","Dashboard","icon","pi pi-home","severity","secondary",3,"outlined","routerLink"],["label","Files","icon","pi pi-file","severity","secondary",3,"outlined","routerLink"],["icon","pi pi-refresh","severity","info",3,"onClick","outlined","rounded"],["class","bg-white rounded-lg shadow-sm p-6",4,"ngIf"],[4,"ngIf"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"space-y-4"],["height","4rem"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-4","gap-6","mb-6"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-3xl","font-bold","text-blue-600"],[1,"text-3xl","font-bold","text-green-600"],[1,"text-3xl","font-bold","text-orange-600"],[1,"grid","grid-cols-1","xl:grid-cols-2","gap-6","mb-6"],[1,"text-lg","font-semibold","text-gray-900","mt-0","mb-4"],["type","line",3,"data","options"],["type","doughnut",3,"data","options"],[1,"bg-white","rounded-lg","shadow-sm","overflow-hidden"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","m-0"],["styleClass","p-datatable-sm",3,"value"],["pTemplate","header"],["pTemplate","body"],["severity","info",3,"value"]],template:function(s,i){1&s&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),t.EFF(5,"Storage Analytics"),t.k0s(),t.j41(6,"p",4),t.EFF(7,"Provider distribution, file type split, growth and top uploaders"),t.k0s()(),t.j41(8,"div",5),t.nrm(9,"p-button",6)(10,"p-button",7),t.j41(11,"p-button",8),t.bIt("onClick",function(){return i.loadStats()}),t.k0s()()()(),t.DNE(12,v,5,0,"div",9)(13,S,53,11,"ng-container",10),t.k0s()),2&s&&(t.R7$(9),t.Y8G("outlined",!0)("routerLink",t.lJ4(8,E)),t.R7$(),t.Y8G("outlined",!0)("routerLink",t.lJ4(9,y)),t.R7$(),t.Y8G("outlined",!0)("rounded",!0),t.R7$(),t.Y8G("ngIf",i.loading),t.R7$(),t.Y8G("ngIf",!i.loading&&i.summary&&i.usage))},dependencies:[p.MD,p.bT,c.Wk,d.tm,d.$n,f.Ei,m.bG,m.XI,u.Fr,u.X9,g.$C,g.vw,_.k2,_.EA],encapsulation:2})}return o})()}}]);