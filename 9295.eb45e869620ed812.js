"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[9295],{9295:(A,m,s)=>{s.r(m),s.d(m,{RevenueComponent:()=>I});var p=s(2881),u=s(9417),k=s(5207),_=s(1141),v=s(491),h=s(8150),P=s(8559),C=s(6221),D=s(6150),M=s(7722),O=s(5716),R=s(935),d=s(5779),y=s(5545),e=s(1360);const b=()=>[10,25,50];function E(o,c){if(1&o&&(e.j41(0,"p-card",15)(1,"div",16),e.nrm(2,"p-chart",17),e.k0s()()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("data",t.revenueChartData)("options",t.revenueChartOptions)}}function F(o,c){1&o&&(e.j41(0,"tr")(1,"th"),e.EFF(2,"Rank"),e.k0s(),e.j41(3,"th"),e.EFF(4,"Apartment"),e.k0s(),e.j41(5,"th"),e.EFF(6,"Revenue"),e.k0s(),e.j41(7,"th"),e.EFF(8,"Bookings"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Average Price"),e.k0s(),e.j41(11,"th"),e.EFF(12,"Revenue Share"),e.k0s()())}function w(o,c){if(1&o&&(e.j41(0,"tr")(1,"td"),e.nrm(2,"p-tag",23),e.k0s(),e.j41(3,"td")(4,"span",24),e.EFF(5),e.k0s()(),e.j41(6,"td")(7,"span",25),e.EFF(8),e.nI1(9,"currency"),e.k0s()(),e.j41(10,"td")(11,"span",26),e.EFF(12),e.k0s()(),e.j41(13,"td")(14,"span",27),e.EFF(15),e.nI1(16,"currency"),e.k0s()(),e.j41(17,"td")(18,"div",28)(19,"div",29),e.nrm(20,"div",30),e.k0s(),e.j41(21,"span",31),e.EFF(22),e.nI1(23,"number"),e.k0s()()()()),2&o){const t=c.$implicit,a=c.rowIndex,n=e.XpG(2);e.R7$(2),e.Y8G("value","#"+(a+1))("severity",a<3?"success":"info"),e.R7$(3),e.JRh(t.apartment_name),e.R7$(3),e.JRh(e.bMT(9,9,t.revenue)),e.R7$(4),e.JRh(t.bookings),e.R7$(3),e.JRh(e.bMT(16,11,t.averagePrice)),e.R7$(5),e.xc7("width",n.getRevenueShare(t.revenue),"%"),e.R7$(2),e.SpI(" ",e.i5U(23,13,n.getRevenueShare(t.revenue),"1.1-1"),"% ")}}function B(o,c){1&o&&(e.j41(0,"tr")(1,"td",32)(2,"div",33),e.nrm(3,"i",34),e.j41(4,"p"),e.EFF(5,"No revenue data available"),e.k0s()()()())}function T(o,c){if(1&o&&(e.j41(0,"p-card",18)(1,"p-table",19),e.DNE(2,F,13,0,"ng-template",20)(3,w,24,16,"ng-template",21)(4,B,6,0,"ng-template",22),e.k0s()()),2&o){const t=e.XpG();e.R7$(),e.Y8G("value",t.apartmentRevenueData)("paginator",!0)("rows",10)("rowsPerPageOptions",e.lJ4(5,b))("showCurrentPageReport",!0)}}function j(o,c){1&o&&(e.j41(0,"div",35),e.nrm(1,"p-skeleton",36),e.k0s())}let I=(()=>{class o{hotelService;messageService;bookings=[];apartments=[];loading=!1;selectedPeriod="month";periodOptions=[{label:"Last 7 Days",value:"week"},{label:"Last 30 Days",value:"month"},{label:"Last 3 Months",value:"quarter"},{label:"Last Year",value:"year"}];revenueChartData;revenueChartOptions;apartmentRevenueData=[];totalRevenue=0;totalBookings=0;averageRevenue=0;growthRate=0;constructor(t,a){this.hotelService=t,this.messageService=a}ngOnInit(){this.loadData()}loadData(){this.loading=!0,Promise.all([this.hotelService.getBookings().toPromise(),this.hotelService.getApartments().toPromise()]).then(([t,a])=>{this.bookings=t?.data||[],this.apartments=a?.data||[],this.processRevenueData(),this.loading=!1}).catch(()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load revenue data"}),this.loading=!1})}processRevenueData(){const t=this.getFilteredBookings();this.calculateMetrics(t),this.buildChartData(t),this.buildApartmentRevenue(t)}getFilteredBookings(){const t=new Date;let a=new Date;switch(this.selectedPeriod){case"week":a.setDate(t.getDate()-7);break;case"month":a.setDate(t.getDate()-30);break;case"quarter":a.setMonth(t.getMonth()-3);break;case"year":a.setFullYear(t.getFullYear()-1)}return this.bookings.filter(n=>{const r=new Date(n.created);return r>=a&&r<=t&&"canceled"!==n.booking_status})}calculateMetrics(t){this.totalBookings=t.length,this.totalRevenue=t.reduce((r,g)=>r+(g.total_price||0),0),this.averageRevenue=this.totalBookings>0?this.totalRevenue/this.totalBookings:0;const n=this.getPreviousPeriodBookings().reduce((r,g)=>r+(g.total_price||0),0);this.growthRate=n>0?(this.totalRevenue-n)/n*100:this.totalRevenue>0?100:0}getPreviousPeriodBookings(){const t=new Date;let a=new Date,n=new Date;switch(this.selectedPeriod){case"week":a.setDate(t.getDate()-14),n.setDate(t.getDate()-7);break;case"month":a.setDate(t.getDate()-60),n.setDate(t.getDate()-30);break;case"quarter":a.setMonth(t.getMonth()-6),n.setMonth(t.getMonth()-3);break;case"year":a.setFullYear(t.getFullYear()-2),n.setFullYear(t.getFullYear()-1)}return this.bookings.filter(r=>{const g=new Date(r.created);return g>=a&&g<n&&"canceled"!==r.booking_status})}buildChartData(t){const a=new Map;t.forEach(i=>{const l=new Date(i.created).toISOString().split("T")[0],f=a.get(l)||{revenue:0,count:0};a.set(l,{revenue:f.revenue+(i.total_price||0),count:f.count+1})});const n=Array.from(a.keys()).sort(),r=n.map(i=>a.get(i).revenue),g=n.map(i=>a.get(i).count);this.revenueChartData={labels:n.map(i=>new Date(i).toLocaleDateString("en-US","year"===this.selectedPeriod?{month:"short",year:"numeric"}:{month:"short",day:"numeric"})),datasets:[{label:"Revenue",data:r,fill:!0,backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgb(59, 130, 246)",tension:.4},{label:"Bookings",data:g,fill:!1,backgroundColor:"rgba(34, 197, 94, 0.2)",borderColor:"rgb(34, 197, 94)",tension:.4,yAxisID:"y1"}]},this.revenueChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Revenue & Bookings Trend"}},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Revenue ($)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Number of Bookings"},grid:{drawOnChartArea:!1}}}}}buildApartmentRevenue(t){const a=new Map;t.forEach(n=>{const r=a.get(n.apartment_id)||{revenue:0,bookings:0};a.set(n.apartment_id,{revenue:r.revenue+(n.total_price||0),bookings:r.bookings+1})}),this.apartmentRevenueData=Array.from(a.entries()).map(([n,r])=>({apartment_id:n,apartment_name:this.getApartmentName(n),revenue:r.revenue,bookings:r.bookings,averagePrice:r.bookings>0?r.revenue/r.bookings:0})).sort((n,r)=>r.revenue-n.revenue)}onPeriodChange(){this.processRevenueData()}getApartmentName(t){const a=this.apartments.find(n=>(n.id||n._id)===t);return a?a.title:t}getGrowthColor(){return this.growthRate>=0?"success":"danger"}getRevenueShare(t){return 0===this.totalRevenue?0:t/this.totalRevenue*100}getOccupancyRate(){const t="week"===this.selectedPeriod?7:"month"===this.selectedPeriod?30:"quarter"===this.selectedPeriod?90:365,a=this.totalBookings>0?this.bookings.reduce((g,i)=>g+(i.count_of_days||0),0)/this.totalBookings:0,r=this.apartments.length*t;return r>0?this.totalBookings*a/r*100:0}static \u0275fac=function(a){return new(a||o)(e.rXU(y.g),e.rXU(d.bg))};static \u0275cmp=e.VBU({type:o,selectors:[["app-hotel-revenue"]],features:[e.Jv_([d.bg])],decls:48,vars:24,consts:[["loadingTemplate",""],[1,"revenue-page"],[1,"page-header"],[1,"header-content"],[1,"subtitle"],[1,"header-actions"],["optionLabel","label","optionValue","value",1,"period-selector",3,"ngModelChange","onChange","options","ngModel"],["pButton","","type","button","label","Refresh","icon","pi pi-refresh",1,"p-button-secondary",3,"click"],[1,"summary-cards"],[1,"summary-stat"],[1,"stat-value"],[1,"stat-label"],[1,"stat-change",3,"ngClass"],["header","Revenue & Bookings Trend",4,"ngIf","ngIfElse"],["header","Revenue by Apartment",4,"ngIf"],["header","Revenue & Bookings Trend"],[1,"chart-container"],["type","line",3,"data","options"],["header","Revenue by Apartment"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} apartments","styleClass","p-datatable-sm",3,"value","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"value","severity"],[1,"apartment-name"],[1,"revenue-amount"],[1,"booking-count"],[1,"avg-price"],[1,"revenue-share"],[1,"share-bar"],[1,"share-fill"],[1,"share-percent"],["colspan","6",1,"text-center"],[1,"empty-state"],[1,"pi","pi-chart-line"],[1,"loading-container"],["height","400px"]],template:function(a,n){if(1&a){const r=e.RV6();e.j41(0,"div",1),e.nrm(1,"p-toast"),e.j41(2,"div",2)(3,"div",3)(4,"div")(5,"h1"),e.EFF(6,"Revenue Analytics"),e.k0s(),e.j41(7,"p",4),e.EFF(8,"Track revenue performance and booking trends"),e.k0s()(),e.j41(9,"div",5)(10,"p-dropdown",6),e.mxI("ngModelChange",function(i){return e.eBV(r),e.DH7(n.selectedPeriod,i)||(n.selectedPeriod=i),e.Njj(i)}),e.bIt("onChange",function(){return e.eBV(r),e.Njj(n.onPeriodChange())}),e.k0s(),e.j41(11,"button",7),e.bIt("click",function(){return e.eBV(r),e.Njj(n.loadData())}),e.k0s()()()(),e.j41(12,"div",8)(13,"p-card")(14,"div",9)(15,"span",10),e.EFF(16),e.nI1(17,"currency"),e.k0s(),e.j41(18,"span",11),e.EFF(19,"Total Revenue"),e.k0s(),e.j41(20,"span",12),e.nrm(21,"i"),e.EFF(22),e.nI1(23,"number"),e.k0s()()(),e.j41(24,"p-card")(25,"div",9)(26,"span",10),e.EFF(27),e.k0s(),e.j41(28,"span",11),e.EFF(29,"Total Bookings"),e.k0s()()(),e.j41(30,"p-card")(31,"div",9)(32,"span",10),e.EFF(33),e.nI1(34,"currency"),e.k0s(),e.j41(35,"span",11),e.EFF(36,"Average Revenue per Booking"),e.k0s()()(),e.j41(37,"p-card")(38,"div",9)(39,"span",10),e.EFF(40),e.nI1(41,"number"),e.k0s(),e.j41(42,"span",11),e.EFF(43,"Occupancy Rate"),e.k0s()()()(),e.DNE(44,E,3,2,"p-card",13)(45,T,5,6,"p-card",14)(46,j,2,0,"ng-template",null,0,e.C5r),e.k0s()}if(2&a){const r=e.sdS(47);e.R7$(10),e.Y8G("options",n.periodOptions),e.R50("ngModel",n.selectedPeriod),e.R7$(6),e.JRh(e.bMT(17,14,n.totalRevenue)),e.R7$(4),e.Y8G("ngClass","text-"+n.getGrowthColor()),e.R7$(),e.HbH(n.growthRate>=0?"pi pi-arrow-up":"pi pi-arrow-down"),e.R7$(),e.Lme(" ",n.growthRate>=0?"+":"","",e.i5U(23,16,n.growthRate,"1.1-1"),"% "),e.R7$(5),e.JRh(n.totalBookings),e.R7$(6),e.JRh(e.bMT(34,19,n.averageRevenue)),e.R7$(7),e.SpI("",e.i5U(41,21,n.getOccupancyRate(),"1.1-1"),"%"),e.R7$(4),e.Y8G("ngIf",!n.loading)("ngIfElse",r),e.R7$(),e.Y8G("ngIf",!n.loading)}},dependencies:[p.MD,p.YU,p.bT,p.QX,p.oe,u.YN,u.BC,u.vS,k.iI,_.tm,_._f,d.Ei,v.Dw,v.Zp,h.kr,h.ms,P.Fr,P.X9,C.bG,C.XI,D.EJ,M.MB,M.y8,O.k2,O.EA,R.$C,R.vw],styles:[".revenue-page[_ngcontent-%COMP%]{padding:2rem}.revenue-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;background:linear-gradient(135deg,var(--p-surface-0) 0%,rgba(var(--p-primary-500),.05) 100%);padding:2rem;border-radius:12px;border-bottom:2px solid rgba(var(--p-primary-500),.2)}.revenue-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.revenue-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:2rem;font-weight:700;color:var(--p-surface-900)}.revenue-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.95rem;color:var(--p-surface-600)}.revenue-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.revenue-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .period-selector[_ngcontent-%COMP%]{min-width:180px}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;margin-bottom:2rem}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--p-primary-600);margin-bottom:.5rem}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--p-surface-600);margin-bottom:.5rem}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-change[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;display:flex;align-items:center;gap:.25rem}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-change.text-success[_ngcontent-%COMP%]{color:var(--p-success-600)}.revenue-page[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   p-card[_ngcontent-%COMP%]   .summary-stat[_ngcontent-%COMP%]   .stat-change.text-danger[_ngcontent-%COMP%]{color:var(--p-danger-600)}.revenue-page[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{height:400px;position:relative}.revenue-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{padding:2rem}.revenue-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{padding:3rem;text-align:center;color:var(--p-surface-600)}.revenue-page[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem;color:var(--p-surface-400)}.revenue-page[_ngcontent-%COMP%]   .apartment-name[_ngcontent-%COMP%]{font-weight:500}.revenue-page[_ngcontent-%COMP%]   .revenue-amount[_ngcontent-%COMP%]{font-weight:600;color:var(--p-primary-600);font-size:1.1rem}.revenue-page[_ngcontent-%COMP%]   .booking-count[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-700)}.revenue-page[_ngcontent-%COMP%]   .avg-price[_ngcontent-%COMP%]{font-weight:500;color:var(--p-surface-600)}.revenue-page[_ngcontent-%COMP%]   .revenue-share[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.revenue-page[_ngcontent-%COMP%]   .revenue-share[_ngcontent-%COMP%]   .share-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:var(--p-surface-200);border-radius:4px;overflow:hidden}.revenue-page[_ngcontent-%COMP%]   .revenue-share[_ngcontent-%COMP%]   .share-bar[_ngcontent-%COMP%]   .share-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,var(--p-primary-500),var(--p-primary-300));transition:width .3s ease}.revenue-page[_ngcontent-%COMP%]   .revenue-share[_ngcontent-%COMP%]   .share-percent[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-700);min-width:50px;text-align:right}"]})}return o})()}}]);