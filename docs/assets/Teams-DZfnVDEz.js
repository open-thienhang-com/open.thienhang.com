import{y as te,r as i,E as G,n as W,j as e,z as N,A as T,l as q,B as D,e as o,D as ce,F as J}from"./index-CZxwAXbl.js";import{a as x}from"./index.esm-BOhZrsQ0.js";import{C as m,a as d}from"./CRow-BFihry9H.js";import{C as de,a as he,b as K,c as _,d as xe,e as j}from"./CTable-CY1aV83v.js";import{a as c}from"./DefaultLayout-DoGqnKgH.js";import{c as O}from"./cil-trash-CBbKHhHb.js";import{C as Q,a as V,b as X,c as Y,d as Z}from"./CModalTitle-cZnrg16x.js";import{c as me,a as je}from"./cil-phone-DE2e6Wm2.js";import"./cil-user-Dlmw-Gem.js";const De=()=>{var P,k,F,M,B,I,$,R,H,L;const p=te(),[g,w]=i.useState([]),[ee,U]=i.useState(!0),[S,u]=i.useState(null),[s,pe]=i.useState(null),[se,E]=i.useState(!1),[re,y]=i.useState(!1),[l,f]=i.useState(null),[C,A]=i.useState(!1);i.useEffect(()=>{v()},[]);const v=async()=>{var r,n;U(!0),u(null);try{let a;try{console.log("üè® Fetching Teams via proxy..."),a=await G.get("/governance/groups")}catch{console.log("‚ö†Ô∏è Proxy failed, trying direct API..."),a=await W.get("/governance/groups")}console.log("‚úÖ Teams API response:",a.data),a.data&&a.data.data?w(a.data.data):u("Invalid response format")}catch(a){console.error("‚ùå Error fetching Teams:",a),u(((n=(r=a.response)==null?void 0:r.data)==null?void 0:n.message)||a.message||"Failed to fetch Teams")}finally{U(!1)}},le=r=>{p(`/teams/${r}`)},ae=r=>{f(r),y(!0)},ne=async()=>{var r,n,a,b;if(l){A(!0);try{let t;try{console.log("üóëÔ∏è Deleting User via proxy...",l._id),t=await G.delete(`/services/User/apartment/apartment/${l._id}`)}catch{console.log("‚ö†Ô∏è Proxy failed, trying direct API..."),t=await W.delete(`/governance/team/${l._id}`)}console.log("‚úÖ User deleted successfully:",t.data),J.success(t.data.message||`User "${l.title}" deleted successfully!`),w(h=>h.filter(oe=>oe._id!==l._id)),y(!1),f(null)}catch(t){console.error("‚ùå Error deleting User:",t);const h=((n=(r=t.response)==null?void 0:r.data)==null?void 0:n.message)||((b=(a=t.response)==null?void 0:a.data)==null?void 0:b.error)||`Failed to delete User "${l.title}". Please try again.`;J.error(h)}finally{A(!1)}}},z=()=>{y(!1),f(null)},ie=(r,n="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:n}).format(r);return ee?e.jsx(m,{children:e.jsx(d,{xs:12,children:e.jsx(N,{children:e.jsxs(T,{className:"text-center py-5",children:[e.jsx(q,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Teams..."})]})})})}):S?e.jsx(m,{children:e.jsx(d,{xs:12,children:e.jsx(N,{children:e.jsx(T,{children:e.jsxs(D,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",S,e.jsx("div",{className:"mt-2",children:e.jsx(o,{color:"primary",size:"sm",onClick:v,children:"Retry"})})]})})})})}):e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(d,{xs:12,children:e.jsxs(N,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"üè® Teams"}),e.jsxs("small",{className:"ms-2",children:["Total: ",g.length," teams"]})]}),e.jsxs("div",{children:[e.jsx(o,{color:"success",size:"sm",className:"me-2",onClick:()=>p("/team/create"),children:"Create User"}),e.jsx(o,{color:"primary",size:"sm",onClick:v,children:"Refresh"})]})]})}),e.jsx(T,{children:g.length===0?e.jsx(D,{color:"info",children:"No accounts found."}):e.jsxs(de,{hover:!0,responsive:!0,children:[e.jsx(he,{children:e.jsxs(K,{children:[e.jsx(_,{children:"Name"}),e.jsx(_,{children:"Type"}),e.jsx(_,{children:"Description"})]})}),e.jsx(xe,{children:g.map(r=>e.jsxs(K,{children:[e.jsx(j,{children:r.group_name}),e.jsx(j,{children:e.jsx(c,{color:"secondary",children:r.group_type})}),e.jsx(j,{children:r.group_description}),e.jsx(j,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(o,{color:"success",size:"sm",onClick:()=>le(r.identify),children:"Details"}),e.jsx(o,{color:"warning",variant:"outline",size:"sm",onClick:()=>p(`/team/${r.identify}/edit`),children:"Edit"}),e.jsx(o,{color:"danger",variant:"outline",size:"sm",onClick:()=>ae(r),children:e.jsx(x,{icon:O,size:"sm"})})]})})]},r._id))})]})})]})})}),e.jsxs(Q,{visible:se,onClose:()=>E(!1),size:"lg",children:[e.jsx(V,{children:e.jsx(X,{children:"üè® User Details"})}),e.jsx(Y,{children:s&&e.jsxs(m,{children:[e.jsxs(d,{md:6,children:[e.jsx("h5",{children:s.title}),e.jsx("p",{className:"text-muted",children:s.description}),e.jsx("h6",{className:"mt-4",children:"üìç Address"}),e.jsxs("p",{children:[(P=s.address)==null?void 0:P.street," ",(k=s.address)==null?void 0:k.house_number,e.jsx("br",{}),(F=s.address)==null?void 0:F.city,", ",(M=s.address)==null?void 0:M.country]}),e.jsx("h6",{className:"mt-3",children:"üìû Contact"}),e.jsxs("p",{children:[e.jsx(x,{icon:me,className:"me-2"}),s.hotline||"N/A",e.jsx("br",{}),e.jsx(x,{icon:je,className:"me-2"}),s.email||"N/A"]})]}),e.jsxs(d,{md:6,children:[e.jsx("h6",{children:"üè¢ Property Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",(B=s.property)==null?void 0:B.name,e.jsx("br",{}),e.jsx("strong",{children:"Description:"})," ",(I=s.property)==null?void 0:I.description,e.jsx("br",{}),e.jsx("strong",{children:"Total Apartments:"})," ",($=s.property)==null?void 0:$.total_apartments]}),e.jsx("h6",{className:"mt-3",children:"üí∞ Pricing & Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price per day:"})," ",ie(s.price_per_day,s.currency),e.jsx("br",{}),e.jsx("strong",{children:"Total area:"})," ",s.total_area,"m¬≤",e.jsx("br",{}),e.jsx("strong",{children:"Bedrooms:"})," ",s.bedrooms,e.jsx("br",{}),e.jsx("strong",{children:"Bathrooms:"})," ",s.bathrooms]}),e.jsx("h6",{className:"mt-3",children:"‚ú® Amenities"}),e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[((R=s.property)==null?void 0:R.has_pool)&&e.jsx(c,{color:"info",children:"Pool"}),((H=s.property)==null?void 0:H.has_elevator)&&e.jsx(c,{color:"secondary",children:"Elevator"}),s.is_furnished&&e.jsx(c,{color:"primary",children:"Furnished"}),s.is_garage&&e.jsx(c,{color:"success",children:"Garage"}),(L=s.amenities)==null?void 0:L.map((r,n)=>r.is_available&&e.jsx(c,{color:"warning",children:r.name},n))]})]})]})}),e.jsx(Z,{children:e.jsx(o,{color:"secondary",onClick:()=>E(!1),children:"Close"})})]}),e.jsxs(Q,{visible:re,onClose:z,size:"sm",children:[e.jsx(V,{children:e.jsx(X,{children:"üóëÔ∏è Confirm Delete"})}),e.jsx(Y,{children:l&&e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete this User?"}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsx("strong",{children:l.title}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["ID: ",l._id]}),l.address&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:["üìç ",l.address.city,", ",l.address.country]})})]}),e.jsxs(D,{color:"warning",className:"mt-3 mb-0",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone!"]})]})}),e.jsxs(Z,{children:[e.jsx(o,{color:"secondary",onClick:z,disabled:C,children:"Cancel"}),e.jsx(o,{color:"danger",onClick:ne,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:"sm",className:"me-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{icon:O,className:"me-2"}),"Delete User"]})})]})]})]})};export{De as default};
