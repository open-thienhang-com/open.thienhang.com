import{y as S,G as D,r as p,E as f,n as A,j as e,z as k,D as B,e as j,A as I,l as L,F as b}from"./index-CZxwAXbl.js";import{C as $,a as P}from"./index.esm-BOhZrsQ0.js";import{C,a as m}from"./CRow-BFihry9H.js";import{c as q}from"./cil-arrow-left-D66Kb3Zq.js";import{C as z}from"./CForm-Di4mrq4y.js";import{C as F}from"./CFormLabel-9KOKoO1t.js";import{C as R}from"./CFormInput-CXlsoodv.js";import{C as U}from"./CFormTextarea-DLIgUf--.js";import{c as G}from"./cil-save-CHBg7z_U.js";import"./CFormControlWrapper-DAJd-i6P.js";import"./CFormControlValidation-DSYTCUKV.js";const _=()=>{const x=S(),{id:i}=D(),[h,d]=p.useState(!1),[H,g]=p.useState(null),[l,y]=p.useState({code:"",name:"",description:""});p.useEffect(()=>{i&&N(i)},[i]);const N=async r=>{var n,o,t,c,a;d(!0),g(null);try{let s;try{console.log("🏨 Fetching permission detail via proxy...",r),s=await f.get(`/governance/permission/${r}`)}catch{console.log("⚠️ Proxy failed, trying direct API..."),s=await A.get(`/governance/permission/${r}`)}console.log("✅ Permission detail API response:",s.data),(n=s.data)!=null&&n.data?y(s.data.data):g("Permission not found")}catch(s){console.error("❌ Error fetching permission detail:",s),g(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||((a=(c=s.response)==null?void 0:c.data)==null?void 0:a.error)||s.message||"Failed to fetch permission details")}finally{d(!1)}},v=r=>{const{name:n,value:o,type:t,checked:c,multiple:a,selectedOptions:s}=r.target,E=t==="checkbox"?c:t==="number"?parseFloat(o)||0:a?Array.from(s,u=>u.value):o;y(u=>({...u,[n]:E}))},w=async r=>{var n,o,t,c;r.preventDefault(),d(!0);try{const a={code:l.code,name:l.name,description:l.description};console.log("Creating permission with payload:",a);const s=i?await f.patch(`/governance/permission/${i}`,a):await f.post("/governance/permission",a);b.success(s.data.message||"Successfully!"),x("/governance/permissions")}catch(a){console.error("Error creating permission:",a);const s=((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.message)||((c=(t=a.response)==null?void 0:t.data)==null?void 0:c.error)||"Error. Please try again.";b.error(s)}finally{d(!1)}};return e.jsx($,{children:e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsxs(k,{children:[e.jsx(B,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:i?"Permisison Detail":"Create New Permisison"}),e.jsxs(j,{color:"secondary",variant:"outline",onClick:()=>x("/governance/permissions"),children:[e.jsx(P,{icon:q,className:"me-2"}),"Back to Permisisons"]})]})}),e.jsx(I,{children:e.jsxs(z,{onSubmit:w,children:[e.jsxs(C,{className:"mb-4",children:[e.jsx(m,{xs:12,children:e.jsx("h5",{className:"text-primary border-bottom pb-2",children:"Basic Information"})}),[{id:"code",label:"Code *",required:!0},{id:"name",label:"Name *",required:!0}].map(({id:r,label:n,required:o})=>e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(F,{htmlFor:r,children:n}),e.jsx(R,{type:"text",id:r,name:r,value:l[r],onChange:v,required:o})]})},r)),e.jsx(m,{xs:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(F,{htmlFor:"description",children:"Description"}),e.jsx(U,{id:"description",name:"description",rows:3,value:l.description,onChange:v})]})})]}),e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(j,{color:"secondary",onClick:()=>x("/governance/permissions"),disabled:h,children:"Cancel"}),e.jsx(j,{color:"primary",type:"submit",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",className:"me-2"}),i?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:G,className:"me-2"}),i?"Update Permisison":"Create Permisison"]})})]})})})]})})]})})})})};export{_ as default};
