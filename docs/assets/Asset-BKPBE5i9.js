import{y as D,G as k,r as d,E as u,n as q,j as e,z as B,D as I,e as j,A as L,l as O,F as w}from"./index-CZxwAXbl.js";import{C as $,a as F}from"./index.esm-BOhZrsQ0.js";import{C,a as m}from"./CRow-BFihry9H.js";import{c as z}from"./cil-arrow-left-D66Kb3Zq.js";import{C as R}from"./CForm-Di4mrq4y.js";import{C as v}from"./CFormLabel-9KOKoO1t.js";import{C as T}from"./CFormInput-CXlsoodv.js";import{C as U}from"./CFormSelect-B1Z3Q_xs.js";import{C as _}from"./CFormTextarea-DLIgUf--.js";import{c as G}from"./cil-save-CHBg7z_U.js";import"./CFormControlWrapper-DAJd-i6P.js";import"./CFormControlValidation-DSYTCUKV.js";const te=()=>{const x=D(),{id:c}=k(),[y,h]=d.useState(!1),[A,N]=d.useState([]),[H,p]=d.useState(null),[i,b]=d.useState({name:"",type:"",source:"",location:"",owner:"",sensitivity:"",description:"",policies:[]});d.useEffect(()=>{(async()=>{var r;try{const t=await u.get("/governance/policies");(r=t.data)!=null&&r.data?N(t.data.data.map(n=>({label:n.policy_name,value:n.policy_name}))):p("Policy not found")}catch{p("Failed to load policies")}})()},[]),d.useEffect(()=>{c&&S(c)},[c]);const S=async a=>{var r,t,n,l,o;h(!0),p(null);try{let s;try{console.log("🏨 Fetching asset detail via proxy...",a),s=await u.get(`/governance/asset/${a}`)}catch{console.log("⚠️ Proxy failed, trying direct API..."),s=await q.get(`/governance/asset/${a}`)}console.log("✅ Asset detail API response:",s.data),(r=s.data)!=null&&r.data?b(s.data.data):p("Asset not found")}catch(s){console.error("❌ Error fetching asset detail:",s),p(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.error)||s.message||"Failed to fetch asset details")}finally{h(!1)}},f=a=>{const{name:r,value:t,type:n,checked:l,multiple:o,selectedOptions:s}=a.target,E=n==="checkbox"?l:n==="number"?parseFloat(t)||0:o?Array.from(s,g=>g.value):t;b(g=>({...g,[r]:E}))},P=async a=>{var r,t,n,l;a.preventDefault(),h(!0);try{const o={name:i.name,type:i.type,source:i.source,owner:i.owner,description:i.description,location:i.location,sensitivity:i.sensitivity,policies:i.policies};console.log("Creating asset with payload:",o);const s=c?await u.patch(`/governance/asset/${c}`,o):await u.post("/governance/asset",o);w.success(s.data.message||"Successfully!"),x("/governance/assets")}catch(o){console.error("Error creating asset:",o);const s=((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.message)||((l=(n=o.response)==null?void 0:n.data)==null?void 0:l.error)||"Error. Please try again.";w.error(s)}finally{h(!1)}};return e.jsx($,{children:e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:c?"Asset Detail":"Create New Asset"}),e.jsxs(j,{color:"secondary",variant:"outline",onClick:()=>x("/governance/assets"),children:[e.jsx(F,{icon:z,className:"me-2"}),"Back to Assets"]})]})}),e.jsx(L,{children:e.jsxs(R,{onSubmit:P,children:[e.jsxs(C,{className:"mb-4",children:[e.jsx(m,{xs:12,children:e.jsx("h5",{className:"text-primary border-bottom pb-2",children:"Basic Information"})}),[{id:"name",label:"Name *",required:!0},{id:"type",label:"Type *",required:!0},{id:"source",label:"Source *",required:!0},{id:"location",label:"Location"},{id:"owner",label:"Owner"},{id:"sensitivity",label:"Sensitivity"}].map(({id:a,label:r,required:t})=>e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:a,children:r}),e.jsx(T,{type:"text",id:a,name:a,value:i[a],onChange:f,required:t})]})},a)),e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"policies",children:"Policies *"}),e.jsx(U,{multiple:!0,id:"policies",name:"policies",value:i.policies,options:A,onChange:f,required:!0})]})}),e.jsx(m,{xs:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"description",children:"Description"}),e.jsx(_,{id:"description",name:"description",rows:3,value:i.description,onChange:f})]})})]}),e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(j,{color:"secondary",onClick:()=>x("/governance/assets"),disabled:y,children:"Cancel"}),e.jsx(j,{color:"primary",type:"submit",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"sm",className:"me-2"}),c?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{icon:G,className:"me-2"}),c?"Update Asset":"Create Asset"]})})]})})})]})})]})})})})};export{te as default};
