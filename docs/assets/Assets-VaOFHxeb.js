import{v as te,r as i,A as V,B as G,j as e,w as U,x as D,C as W,y as w,z as oe,D as q}from"./index-JbP_4Lsp.js";import{a as c,c as m}from"./index.esm-CyKLJB-2.js";import{C as p,a as d}from"./CRow-VH0aKeGn.js";import{C as de,a as he,b as J,c as h,d as xe,e as x}from"./CTable-DN3UWjCh.js";import{a as t}from"./DefaultLayout-RO6sj_XT.js";import{c as K}from"./cil-trash-CBbKHhHb.js";import{C as O,a as Q,b as X,c as Y,d as Z}from"./CModalTitle-DQi2nAew.js";import{c as je,a as me}from"./cil-phone-DE2e6Wm2.js";import"./cil-user-Dlmw-Gem.js";const De=()=>{var P,k,F,M,B,I,$,R,H,L;const g=te(),[u,_]=i.useState([]),[ee,A]=i.useState(!0),[T,f]=i.useState(null),[r,pe]=i.useState(null),[se,S]=i.useState(!1),[re,y]=i.useState(!1),[l,C]=i.useState(null),[v,E]=i.useState(!1);i.useEffect(()=>{b()},[]);const b=async()=>{var s,n;A(!0),f(null);try{let a;try{console.log("🏨 Fetching Users via proxy..."),a=await V.get("/governance/assets")}catch{console.log("⚠️ Proxy failed, trying direct API..."),a=await G.get("/governance/assets")}console.log("✅ Users API response:",a.data),a.data&&a.data.data?_(a.data.data):f("Invalid response format")}catch(a){console.error("❌ Error fetching Users:",a),f(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.message)||a.message||"Failed to fetch Users")}finally{A(!1)}},le=s=>{g(`/users/${s}`)},ae=s=>{C(s),y(!0)},ne=async()=>{var s,n,a,N;if(l){E(!0);try{let o;try{console.log("🗑️ Deleting User via proxy...",l._id),o=await V.delete(`/services/User/apartment/apartment/${l._id}`)}catch{console.log("⚠️ Proxy failed, trying direct API..."),o=await G.delete(`/governance/user/${l._id}`)}console.log("✅ User deleted successfully:",o.data),q.success(o.data.message||`User "${l.title}" deleted successfully!`),_(j=>j.filter(ce=>ce._id!==l._id)),y(!1),C(null)}catch(o){console.error("❌ Error deleting User:",o);const j=((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.message)||((N=(a=o.response)==null?void 0:a.data)==null?void 0:N.error)||`Failed to delete User "${l.title}". Please try again.`;q.error(j)}finally{E(!1)}}},z=()=>{y(!1),C(null)},ie=(s,n="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:n}).format(s);return ee?e.jsx(p,{children:e.jsx(d,{xs:12,children:e.jsx(U,{children:e.jsxs(D,{className:"text-center py-5",children:[e.jsx(W,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Users..."})]})})})}):T?e.jsx(p,{children:e.jsx(d,{xs:12,children:e.jsx(U,{children:e.jsx(D,{children:e.jsxs(w,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",T,e.jsx("div",{className:"mt-2",children:e.jsx(c,{color:"primary",size:"sm",onClick:b,children:"Retry"})})]})})})})}):e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(d,{xs:12,children:e.jsxs(U,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"🏨 Accounts"}),e.jsxs("small",{className:"ms-2",children:["Total: ",u.length," accounts"]})]}),e.jsxs("div",{children:[e.jsx(c,{color:"success",size:"sm",className:"me-2",onClick:()=>g("/user/create"),children:"Create User"}),e.jsx(c,{color:"primary",size:"sm",onClick:b,children:"Refresh"})]})]})}),e.jsx(D,{children:u.length===0?e.jsx(w,{color:"info",children:"No accounts found."}):e.jsxs(de,{hover:!0,responsive:!0,children:[e.jsx(he,{children:e.jsxs(J,{children:[e.jsx(h,{children:"Full Name"}),e.jsx(h,{children:"Email"}),e.jsx(h,{children:"Active"}),e.jsx(h,{children:"Verified"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(xe,{children:u.map(s=>e.jsxs(J,{children:[e.jsx(x,{children:s.full_name}),e.jsx(x,{children:s.email}),e.jsx(x,{children:s.is_active?e.jsx(t,{color:"success",children:"Active"}):e.jsx(t,{color:"secondary",children:"Inactive"})}),e.jsx(x,{children:s.is_verified?e.jsx(t,{color:"primary",children:"Verified"}):e.jsx(t,{color:"warning",children:"Unverified"})}),e.jsx(x,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(c,{color:"success",size:"sm",onClick:()=>le(s.identify),children:"Details"}),e.jsx(c,{color:"warning",variant:"outline",size:"sm",onClick:()=>g(`/user/${s.identify}/edit`),children:"Edit"}),e.jsx(c,{color:"danger",variant:"outline",size:"sm",onClick:()=>ae(s),children:e.jsx(m,{icon:K,size:"sm"})})]})})]},s.identify))})]})})]})})}),e.jsxs(O,{visible:se,onClose:()=>S(!1),size:"lg",children:[e.jsx(Q,{children:e.jsx(X,{children:"🏨 User Details"})}),e.jsx(Y,{children:r&&e.jsxs(p,{children:[e.jsxs(d,{md:6,children:[e.jsx("h5",{children:r.title}),e.jsx("p",{className:"text-muted",children:r.description}),e.jsx("h6",{className:"mt-4",children:"📍 Address"}),e.jsxs("p",{children:[(P=r.address)==null?void 0:P.street," ",(k=r.address)==null?void 0:k.house_number,e.jsx("br",{}),(F=r.address)==null?void 0:F.city,", ",(M=r.address)==null?void 0:M.country]}),e.jsx("h6",{className:"mt-3",children:"📞 Contact"}),e.jsxs("p",{children:[e.jsx(m,{icon:je,className:"me-2"}),r.hotline||"N/A",e.jsx("br",{}),e.jsx(m,{icon:me,className:"me-2"}),r.email||"N/A"]})]}),e.jsxs(d,{md:6,children:[e.jsx("h6",{children:"🏢 Property Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",(B=r.property)==null?void 0:B.name,e.jsx("br",{}),e.jsx("strong",{children:"Description:"})," ",(I=r.property)==null?void 0:I.description,e.jsx("br",{}),e.jsx("strong",{children:"Total Apartments:"})," ",($=r.property)==null?void 0:$.total_apartments]}),e.jsx("h6",{className:"mt-3",children:"💰 Pricing & Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price per day:"})," ",ie(r.price_per_day,r.currency),e.jsx("br",{}),e.jsx("strong",{children:"Total area:"})," ",r.total_area,"m²",e.jsx("br",{}),e.jsx("strong",{children:"Bedrooms:"})," ",r.bedrooms,e.jsx("br",{}),e.jsx("strong",{children:"Bathrooms:"})," ",r.bathrooms]}),e.jsx("h6",{className:"mt-3",children:"✨ Amenities"}),e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[((R=r.property)==null?void 0:R.has_pool)&&e.jsx(t,{color:"info",children:"Pool"}),((H=r.property)==null?void 0:H.has_elevator)&&e.jsx(t,{color:"secondary",children:"Elevator"}),r.is_furnished&&e.jsx(t,{color:"primary",children:"Furnished"}),r.is_garage&&e.jsx(t,{color:"success",children:"Garage"}),(L=r.amenities)==null?void 0:L.map((s,n)=>s.is_available&&e.jsx(t,{color:"warning",children:s.name},n))]})]})]})}),e.jsx(Z,{children:e.jsx(c,{color:"secondary",onClick:()=>S(!1),children:"Close"})})]}),e.jsxs(O,{visible:re,onClose:z,size:"sm",children:[e.jsx(Q,{children:e.jsx(X,{children:"🗑️ Confirm Delete"})}),e.jsx(Y,{children:l&&e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete this User?"}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsx("strong",{children:l.title}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["ID: ",l._id]}),l.address&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:["📍 ",l.address.city,", ",l.address.country]})})]}),e.jsxs(w,{color:"warning",className:"mt-3 mb-0",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone!"]})]})}),e.jsxs(Z,{children:[e.jsx(c,{color:"secondary",onClick:z,disabled:v,children:"Cancel"}),e.jsx(c,{color:"danger",onClick:ne,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"sm",className:"me-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:K,className:"me-2"}),"Delete User"]})})]})]})]})};export{De as default};
