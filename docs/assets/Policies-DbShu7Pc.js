import{v as w,r as i,A as N,B as S,j as e,w as x,x as j,C as T,y as f,z as D}from"./index-B0tKwzjh.js";import{a as l,c as b}from"./index.esm-K9u9fo5J.js";import{C as m,a as u}from"./CRow-BCx5Pu7f.js";import{C as z,a as E,b as y,c as a,d as _,e as o}from"./CTable-BjeKGvus.js";import{a as n}from"./DefaultLayout-3qL1Ic3U.js";import{c as k}from"./cil-trash-CBbKHhHb.js";import"./cil-user-Dlmw-Gem.js";const X=()=>{const g=w(),[t,v]=i.useState([]),[P,p]=i.useState(!0),[C,d]=i.useState(null),[R,A]=i.useState(null),[B,I]=i.useState(!1),[M,U]=i.useState(!1),[F,H]=i.useState(null),[L,V]=i.useState(!1);i.useEffect(()=>{h()},[]);const h=async()=>{var s,c;p(!0),d(null);try{let r;try{console.log("🏨 Fetching Policies via proxy..."),r=await N.get("/governance/policies")}catch{console.log("⚠️ Proxy failed, trying direct API..."),r=await S.get("/governance/policies")}console.log("✅ Policies API response:",r.data),r.data&&r.data.data?v(r.data.data):d("Invalid response format")}catch(r){console.error("❌ Error fetching Policies:",r),d(((c=(s=r.response)==null?void 0:s.data)==null?void 0:c.message)||r.message||"Failed to fetch Policies")}finally{p(!1)}};return P?e.jsx(m,{children:e.jsx(u,{xs:12,children:e.jsx(x,{children:e.jsxs(j,{className:"text-center py-5",children:[e.jsx(T,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Policies..."})]})})})}):C?e.jsx(m,{children:e.jsx(u,{xs:12,children:e.jsx(x,{children:e.jsx(j,{children:e.jsxs(f,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",C,e.jsx("div",{className:"mt-2",children:e.jsx(l,{color:"primary",size:"sm",onClick:h,children:"Retry"})})]})})})})}):e.jsx(e.Fragment,{children:e.jsx(m,{children:e.jsx(u,{xs:12,children:e.jsxs(x,{children:[e.jsx(D,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"📜 Policies"}),e.jsxs("small",{className:"ms-2",children:["Total: ",t.length," policy(ies)"]})]}),e.jsxs("div",{children:[e.jsx(l,{color:"success",size:"sm",className:"me-2",onClick:()=>g("/policy/create"),children:"Create Policy"}),e.jsx(l,{color:"primary",size:"sm",onClick:h,children:"Refresh"})]})]})}),e.jsx(j,{children:t.length===0?e.jsx(f,{color:"info",children:"No policies found."}):e.jsxs(z,{hover:!0,responsive:!0,children:[e.jsx(E,{children:e.jsxs(y,{children:[e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Description"}),e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Resources"}),e.jsx(a,{children:"Role ID"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(_,{children:t.map((s,c)=>e.jsxs(y,{children:[e.jsx(o,{children:s.policy_name}),e.jsx(o,{children:s.policy_description}),e.jsx(o,{children:e.jsx(n,{color:"secondary",children:s.policy_type})}),e.jsx(o,{children:s.resource_id&&s.resource_id.length>0?s.resource_id.map(r=>e.jsxs(n,{color:"info",className:"me-1",children:["#",r]},r)):e.jsx(n,{color:"light",children:"None"})}),e.jsx(o,{children:e.jsxs(n,{color:"dark",children:["#",s.role_id]})}),e.jsx(o,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(l,{color:"primary",size:"sm",variant:"outline",onClick:()=>handleViewPolicy(s),children:"View"}),e.jsx(l,{color:"warning",size:"sm",variant:"outline",onClick:()=>g(`/policy/${s._id}/edit`),children:"Edit"}),e.jsx(l,{color:"danger",size:"sm",variant:"outline",onClick:()=>handleDeletePolicy(s),children:e.jsx(b,{icon:k,size:"sm"})})]})})]},c))})]})})]})})})})};export{X as default};
