import{y as I,r as i,E as z,n as S,j as e,z as C,A as g,l as A,B as p,e as n,D as $,F as M}from"./index-CZxwAXbl.js";import{a as P}from"./index.esm-BOhZrsQ0.js";import{C as u,a as f}from"./CRow-BFihry9H.js";import{C as L,a as q,b as E,c,d as G,e as t}from"./CTable-CY1aV83v.js";import{c as F}from"./cil-trash-CBbKHhHb.js";import{C as J,a as K,b as O,c as Q,d as U}from"./CModalTitle-cZnrg16x.js";import"./DefaultLayout-DoGqnKgH.js";import"./cil-user-Dlmw-Gem.js";const le=()=>{const y=I(),[h,v]=i.useState([]),[_,b]=i.useState(!0),[w,D]=i.useState(null),[r,N]=i.useState(null),[R,T]=i.useState(!1),[x,k]=i.useState(!1);i.useEffect(()=>{j()},[]);const j=async()=>{var s,o,l;b(!0),D(null);try{let a;try{a=await z.get("/governance/policies")}catch{a=await S.get("/governance/policies")}const d=(s=a.data)==null?void 0:s.data;if(Array.isArray(d))v(d);else throw new Error("Invalid response format")}catch(a){D(((l=(o=a.response)==null?void 0:o.data)==null?void 0:l.message)||a.message||"Failed to fetch policies")}finally{b(!1)}},B=s=>{N(s),T(!0)},H=async()=>{var s,o;if(r){k(!0);try{let l;try{l=await z.delete(`/governance/policy/${r._id}`)}catch{l=await S.delete(`/governance/policy/${r._id}`)}M.success(l.data.message||`Deleted: "${r.name}"`),v(a=>a.filter(d=>d._id!==r._id)),m()}catch(l){M.error(((o=(s=l.response)==null?void 0:s.data)==null?void 0:o.message)||"Delete failed")}finally{k(!1)}}},m=()=>{T(!1),N(null)};return _?e.jsx(u,{children:e.jsx(f,{xs:12,children:e.jsx(C,{children:e.jsxs(g,{className:"text-center py-5",children:[e.jsx(A,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Policies..."})]})})})}):w?e.jsx(u,{children:e.jsx(f,{xs:12,children:e.jsx(C,{children:e.jsx(g,{children:e.jsxs(p,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",w,e.jsx("div",{className:"mt-2",children:e.jsx(n,{color:"primary",size:"sm",onClick:j,children:"Retry"})})]})})})})}):e.jsxs(e.Fragment,{children:[e.jsx(u,{children:e.jsx(f,{xs:12,children:e.jsxs(C,{children:[e.jsxs($,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"üè® Policies"}),e.jsxs("small",{className:"ms-2",children:["Total: ",h.length]})]}),e.jsxs("div",{children:[e.jsx(n,{color:"success",size:"sm",className:"me-2",onClick:()=>y("/governance/policy/create"),children:"Create Policy"}),e.jsx(n,{color:"primary",size:"sm",onClick:j,children:"Refresh"})]})]}),e.jsx(g,{children:h.length===0?e.jsx(p,{color:"info",children:"No policies found."}):e.jsxs(L,{hover:!0,responsive:!0,children:[e.jsx(q,{children:e.jsxs(E,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Assets"}),e.jsx(c,{children:"Role ID"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(G,{children:h.map(s=>e.jsxs(E,{children:[e.jsx(t,{children:s.name}),e.jsx(t,{children:s.description}),e.jsx(t,{children:s.type}),e.jsx(t,{children:s.assets.join(", ")}),e.jsx(t,{children:s.roles}),e.jsx(t,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(n,{color:"success",size:"sm",onClick:()=>y(`/governance/policy/${s._id}`),children:"Details"}),e.jsx(n,{color:"danger",variant:"outline",size:"sm",onClick:()=>B(s),children:e.jsx(P,{icon:F,size:"sm"})})]})})]},s._id))})]})})]})})}),e.jsxs(J,{visible:R,onClose:m,size:"sm",children:[e.jsx(K,{children:e.jsx(O,{children:"üóëÔ∏è Confirm Delete"})}),e.jsx(Q,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Are you sure you want to delete this policy?"}),e.jsxs("div",{className:"bg-dark text-white p-3 rounded",children:[e.jsx("strong",{children:r.name}),e.jsx("br",{}),e.jsxs("small",{children:["ID: ",r._id]})]}),e.jsx(p,{color:"warning",className:"mt-3 mb-0",children:"This action cannot be undone."})]})}),e.jsxs(U,{children:[e.jsx(n,{color:"secondary",onClick:m,disabled:x,children:"Cancel"}),e.jsx(n,{color:"danger",onClick:H,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:"sm",className:"me-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:F,className:"me-2"}),"Delete"]})})]})]})]})};export{le as default};
