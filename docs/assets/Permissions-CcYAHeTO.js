import{v as P,r as i,A as w,B as S,j as e,w as d,x as h,C as N,y as u,z as T}from"./index-JbP_4Lsp.js";import{a as n,c as b}from"./index.esm-CyKLJB-2.js";import{C as x,a as m}from"./CRow-VH0aKeGn.js";import{C as z,a as D,b as f,c as a,d as E,e as l}from"./CTable-DN3UWjCh.js";import{a as k}from"./DefaultLayout-RO6sj_XT.js";import{c as A}from"./cil-trash-CBbKHhHb.js";import"./cil-user-Dlmw-Gem.js";const X=()=>{const j=P(),[o,v]=i.useState([]),[y,C]=i.useState(!0),[g,t]=i.useState(null),[B,R]=i.useState(null),[I,M]=i.useState(!1),[U,F]=i.useState(!1),[H,L]=i.useState(null),[V,_]=i.useState(!1);i.useEffect(()=>{c()},[]);const c=async()=>{var s,p;C(!0),t(null);try{let r;try{console.log("🏨 Fetching Permissions via proxy..."),r=await w.get("/governance/permissions")}catch{console.log("⚠️ Proxy failed, trying direct API..."),r=await S.get("/governance/permissions")}console.log("✅ Permissions API response:",r.data),r.data&&r.data.data?v(r.data.data):t("Invalid response format")}catch(r){console.error("❌ Error fetching Permissions:",r),t(((p=(s=r.response)==null?void 0:s.data)==null?void 0:p.message)||r.message||"Failed to fetch Permissions")}finally{C(!1)}};return y?e.jsx(x,{children:e.jsx(m,{xs:12,children:e.jsx(d,{children:e.jsxs(h,{className:"text-center py-5",children:[e.jsx(N,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Permissions..."})]})})})}):g?e.jsx(x,{children:e.jsx(m,{xs:12,children:e.jsx(d,{children:e.jsx(h,{children:e.jsxs(u,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",g,e.jsx("div",{className:"mt-2",children:e.jsx(n,{color:"primary",size:"sm",onClick:c,children:"Retry"})})]})})})})}):e.jsx(e.Fragment,{children:e.jsx(x,{children:e.jsx(m,{xs:12,children:e.jsxs(d,{children:[e.jsx(T,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"🔐 Permissions"}),e.jsxs("small",{className:"ms-2",children:["Total: ",o.length," permission(s)"]})]}),e.jsxs("div",{children:[e.jsx(n,{color:"success",size:"sm",className:"me-2",onClick:()=>j("/permission/create"),children:"Create Permission"}),e.jsx(n,{color:"primary",size:"sm",onClick:c,children:"Refresh"})]})]})}),e.jsx(h,{children:o.length===0?e.jsx(u,{color:"info",children:"No permissions found."}):e.jsxs(z,{hover:!0,responsive:!0,children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Code"}),e.jsx(a,{children:"Description"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(E,{children:o.map(s=>e.jsxs(f,{children:[e.jsx(l,{children:s.name}),e.jsx(l,{children:e.jsx(k,{color:"secondary",children:s.code})}),e.jsx(l,{children:s.description}),e.jsx(l,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(n,{color:"primary",variant:"outline",size:"sm",onClick:()=>handleViewPermission(s),children:"View"}),e.jsx(n,{color:"warning",variant:"outline",size:"sm",onClick:()=>j(`/permission/${s._id}/edit`),children:"Edit"}),e.jsx(n,{color:"danger",variant:"outline",size:"sm",onClick:()=>handleDeletePermission(s),children:e.jsx(b,{icon:A,size:"sm"})})]})})]},s._id))})]})})]})})})})};export{X as default};
