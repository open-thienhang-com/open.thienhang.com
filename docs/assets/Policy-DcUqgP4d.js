import{y as A,G as k,r as d,E as h,n as q,j as e,z as B,D as I,e as j,A as L,l as O,F as P}from"./index-CZxwAXbl.js";import{C as $,a as F}from"./index.esm-BOhZrsQ0.js";import{C,a as m}from"./CRow-BFihry9H.js";import{c as z}from"./cil-arrow-left-D66Kb3Zq.js";import{C as R}from"./CForm-Di4mrq4y.js";import{C as v}from"./CFormLabel-9KOKoO1t.js";import{C as T}from"./CFormInput-CXlsoodv.js";import{C as U}from"./CFormSelect-B1Z3Q_xs.js";import{C as _}from"./CFormTextarea-DLIgUf--.js";import{c as G}from"./cil-save-CHBg7z_U.js";import"./CFormControlWrapper-DAJd-i6P.js";import"./CFormControlValidation-DSYTCUKV.js";const oe=()=>{const u=A(),{id:c}=k(),[x,y]=d.useState(!1),[w,N]=d.useState([]),[H,p]=d.useState(null),[t,b]=d.useState({name:"",type:"",description:"",role:""});d.useEffect(()=>{(async()=>{var i;try{const o=await h.get("/governance/policies");(i=o.data)!=null&&i.data?N(o.data.data.map(n=>({label:n.policy_name,value:n.policy_name}))):p("Policy not found")}catch{p("Failed to load policies")}})()},[]),d.useEffect(()=>{c&&S(c)},[c]);const S=async a=>{var i,o,n,l,r;y(!0),p(null);try{let s;try{console.log("ðŸ¨ Fetching policy detail via proxy...",a),s=await h.get(`/governance/policy/${a}`)}catch{console.log("âš ï¸ Proxy failed, trying direct API..."),s=await q.get(`/governance/policy/${a}`)}console.log("âœ… Policy detail API response:",s.data),(i=s.data)!=null&&i.data?b(s.data.data):p("Policy not found")}catch(s){console.error("âŒ Error fetching policy detail:",s),p(((n=(o=s.response)==null?void 0:o.data)==null?void 0:n.message)||((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.error)||s.message||"Failed to fetch policy details")}finally{y(!1)}},f=a=>{const{name:i,value:o,type:n,checked:l,multiple:r,selectedOptions:s}=a.target,D=n==="checkbox"?l:n==="number"?parseFloat(o)||0:r?Array.from(s,g=>g.value):o;b(g=>({...g,[i]:D}))},E=async a=>{var i,o,n,l;a.preventDefault(),y(!0);try{const r={name:t.name,type:t.type,source:t.source,owner:t.owner,description:t.description,location:t.location,sensitivity:t.sensitivity,policies:t.policies};console.log("Creating policy with payload:",r);const s=c?await h.patch(`/governance/policy/${c}`,r):await h.post("/governance/policy",r);P.success(s.data.message||"Successfully!"),u("/governance/policies")}catch(r){console.error("Error creating policy:",r);const s=((o=(i=r.response)==null?void 0:i.data)==null?void 0:o.message)||((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.error)||"Error. Please try again.";P.error(s)}finally{y(!1)}};return e.jsx($,{children:e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:c?"Policy Detail":"Create New Policy"}),e.jsxs(j,{color:"secondary",variant:"outline",onClick:()=>u("/governance/policies"),children:[e.jsx(F,{icon:z,className:"me-2"}),"Back to Policys"]})]})}),e.jsx(L,{children:e.jsxs(R,{onSubmit:E,children:[e.jsxs(C,{className:"mb-4",children:[e.jsx(m,{xs:12,children:e.jsx("h5",{className:"text-primary border-bottom pb-2",children:"Basic Information"})}),[{id:"name",label:"Name *",required:!0},{id:"type",label:"Type *",required:!0},{id:"source",label:"Source *",required:!0},{id:"location",label:"Location"},{id:"owner",label:"Owner"},{id:"sensitivity",label:"Sensitivity"}].map(({id:a,label:i,required:o})=>e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:a,children:i}),e.jsx(T,{type:"text",id:a,name:a,value:t[a],onChange:f,required:o})]})},a)),e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"policies",children:"Policies *"}),e.jsx(U,{multiple:!0,id:"policies",name:"policies",value:t.policies,options:w,onChange:f,required:!0})]})}),e.jsx(m,{xs:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"description",children:"Description"}),e.jsx(_,{id:"description",name:"description",rows:3,value:t.description,onChange:f})]})})]}),e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(j,{color:"secondary",onClick:()=>u("/governance/policies"),disabled:x,children:"Cancel"}),e.jsx(j,{color:"primary",type:"submit",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"sm",className:"me-2"}),c?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{icon:G,className:"me-2"}),c?"Update Policy":"Create Policy"]})})]})})})]})})]})})})})};export{oe as default};
