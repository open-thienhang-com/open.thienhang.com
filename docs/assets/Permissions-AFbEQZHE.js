import{y as $,r as i,E as z,n as S,j as e,z as C,A as g,l as M,B as p,e as l,D as I,F as P}from"./index-CZxwAXbl.js";import{a as A}from"./index.esm-BOhZrsQ0.js";import{C as u,a as f}from"./CRow-BFihry9H.js";import{C as L,a as q,b as E,c as o,d as G,e as d}from"./CTable-CY1aV83v.js";import{c as F}from"./cil-trash-CBbKHhHb.js";import{C as J,a as K,b as O,c as Q,d as U}from"./CModalTitle-cZnrg16x.js";import"./DefaultLayout-DoGqnKgH.js";import"./cil-user-Dlmw-Gem.js";const ae=()=>{const y=$(),[m,v]=i.useState([]),[_,b]=i.useState(!0),[w,D]=i.useState(null),[r,N]=i.useState(null),[B,T]=i.useState(!1),[h,k]=i.useState(!1);i.useEffect(()=>{x()},[]);const x=async()=>{var s,c,a;b(!0),D(null);try{let n;try{n=await z.get("/governance/permissions")}catch{n=await S.get("/governance/permissions")}const t=(s=n.data)==null?void 0:s.data;if(Array.isArray(t))v(t);else throw new Error("Invalid response format")}catch(n){D(((a=(c=n.response)==null?void 0:c.data)==null?void 0:a.message)||n.message||"Failed to fetch permissions")}finally{b(!1)}},R=s=>{N(s),T(!0)},H=async()=>{var s,c;if(r){k(!0);try{let a;try{a=await z.delete(`/governance/permission/${r._id}`)}catch{a=await S.delete(`/governance/permission/${r._id}`)}P.success(a.data.message||`Deleted: "${r.name}"`),v(n=>n.filter(t=>t._id!==r._id)),j()}catch(a){P.error(((c=(s=a.response)==null?void 0:s.data)==null?void 0:c.message)||"Delete failed")}finally{k(!1)}}},j=()=>{T(!1),N(null)};return _?e.jsx(u,{children:e.jsx(f,{xs:12,children:e.jsx(C,{children:e.jsxs(g,{className:"text-center py-5",children:[e.jsx(M,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Permissions..."})]})})})}):w?e.jsx(u,{children:e.jsx(f,{xs:12,children:e.jsx(C,{children:e.jsx(g,{children:e.jsxs(p,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",w,e.jsx("div",{className:"mt-2",children:e.jsx(l,{color:"primary",size:"sm",onClick:x,children:"Retry"})})]})})})})}):e.jsxs(e.Fragment,{children:[e.jsx(u,{children:e.jsx(f,{xs:12,children:e.jsxs(C,{children:[e.jsxs(I,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"üè® Permissions"}),e.jsxs("small",{className:"ms-2",children:["Total: ",m.length]})]}),e.jsxs("div",{children:[e.jsx(l,{color:"success",size:"sm",className:"me-2",onClick:()=>y("/governance/permission/create"),children:"Create Permission"}),e.jsx(l,{color:"primary",size:"sm",onClick:x,children:"Refresh"})]})]}),e.jsx(g,{children:m.length===0?e.jsx(p,{color:"info",children:"No permissions found."}):e.jsxs(L,{hover:!0,responsive:!0,children:[e.jsx(q,{children:e.jsxs(E,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Code"}),e.jsx(o,{children:"Description"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(G,{children:m.map(s=>e.jsxs(E,{children:[e.jsx(d,{children:s.name}),e.jsx(d,{children:s.code}),e.jsx(d,{children:s.description}),e.jsx(d,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(l,{color:"success",size:"sm",onClick:()=>y(`/governance/permission/${s._id}`),children:"Details"}),e.jsx(l,{color:"danger",variant:"outline",size:"sm",onClick:()=>R(s),children:e.jsx(A,{icon:F,size:"sm"})})]})})]},s._id))})]})})]})})}),e.jsxs(J,{visible:B,onClose:j,size:"sm",children:[e.jsx(K,{children:e.jsx(O,{children:"üóëÔ∏è Confirm Delete"})}),e.jsx(Q,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Are you sure you want to delete this permission?"}),e.jsxs("div",{className:"bg-dark text-white p-3 rounded",children:[e.jsx("strong",{children:r.name}),e.jsx("br",{}),e.jsxs("small",{children:["ID: ",r._id]})]}),e.jsx(p,{color:"warning",className:"mt-3 mb-0",children:"This action cannot be undone."})]})}),e.jsxs(U,{children:[e.jsx(l,{color:"secondary",onClick:j,disabled:h,children:"Cancel"}),e.jsx(l,{color:"danger",onClick:H,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm",className:"me-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:F,className:"me-2"}),"Delete"]})})]})]})]})};export{ae as default};
