import{v as ie,r as i,A as V,B as G,j as e,w as v,x as N,C as W,y as b,z as oe,D as q}from"./index-B0tKwzjh.js";import{a as o,c as m}from"./index.esm-K9u9fo5J.js";import{C as p,a as d}from"./CRow-BCx5Pu7f.js";import{C as ce,a as te,b as J,c as h,d as de,e as x}from"./CTable-BjeKGvus.js";import{a as t}from"./DefaultLayout-3qL1Ic3U.js";import{c as K}from"./cil-trash-CBbKHhHb.js";import{C as O,a as Q,b as X,c as Y,d as Z}from"./CModalTitle-CI7zroAJ.js";import{c as he,a as xe}from"./cil-phone-DE2e6Wm2.js";import"./cil-user-Dlmw-Gem.js";const be=()=>{var P,z,M,k,F,B,I,$,H,L;const _=ie(),[g,w]=i.useState([]),[ee,D]=i.useState(!0),[R,u]=i.useState(null),[s,je]=i.useState(null),[se,U]=i.useState(!1),[re,T]=i.useState(!1),[l,A]=i.useState(null),[y,S]=i.useState(!1);i.useEffect(()=>{f()},[]);const f=async()=>{var r,n;D(!0),u(null);try{let a;try{console.log("🏨 Fetching Roles via proxy..."),a=await V.get("/governance/roles")}catch{console.log("⚠️ Proxy failed, trying direct API..."),a=await G.get("/governance/roles")}console.log("✅ Roles API response:",a.data),a.data&&a.data.data?w(a.data.data):u("Invalid response format")}catch(a){console.error("❌ Error fetching Roles:",a),u(((n=(r=a.response)==null?void 0:r.data)==null?void 0:n.message)||a.message||"Failed to fetch Roles")}finally{D(!1)}},le=async()=>{var r,n,a,C;if(l){S(!0);try{let c;try{console.log("🗑️ Deleting User via proxy...",l._id),c=await V.delete(`/services/User/apartment/apartment/${l._id}`)}catch{console.log("⚠️ Proxy failed, trying direct API..."),c=await G.delete(`/governance/user/${l._id}`)}console.log("✅ User deleted successfully:",c.data),q.success(c.data.message||`User "${l.title}" deleted successfully!`),w(j=>j.filter(ne=>ne._id!==l._id)),T(!1),A(null)}catch(c){console.error("❌ Error deleting User:",c);const j=((n=(r=c.response)==null?void 0:r.data)==null?void 0:n.message)||((C=(a=c.response)==null?void 0:a.data)==null?void 0:C.error)||`Failed to delete User "${l.title}". Please try again.`;q.error(j)}finally{S(!1)}}},E=()=>{T(!1),A(null)},ae=(r,n="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:n}).format(r);return ee?e.jsx(p,{children:e.jsx(d,{xs:12,children:e.jsx(v,{children:e.jsxs(N,{className:"text-center py-5",children:[e.jsx(W,{color:"primary",variant:"grow"}),e.jsx("div",{className:"mt-3",children:"Loading Roles..."})]})})})}):R?e.jsx(p,{children:e.jsx(d,{xs:12,children:e.jsx(v,{children:e.jsx(N,{children:e.jsxs(b,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",R,e.jsx("div",{className:"mt-2",children:e.jsx(o,{color:"primary",size:"sm",onClick:f,children:"Retry"})})]})})})})}):e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(d,{xs:12,children:e.jsxs(v,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"🏨 Accounts"}),e.jsxs("small",{className:"ms-2",children:["Total: ",g.length," accounts"]})]}),e.jsxs("div",{children:[e.jsx(o,{color:"success",size:"sm",className:"me-2",onClick:()=>_("/user/create"),children:"Create User"}),e.jsx(o,{color:"primary",size:"sm",onClick:f,children:"Refresh"})]})]})}),e.jsx(N,{children:g.length===0?e.jsx(b,{color:"info",children:"No roles found."}):e.jsxs(ce,{hover:!0,responsive:!0,children:[e.jsx(te,{children:e.jsxs(J,{children:[e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Description"}),e.jsx(h,{children:"Type"}),e.jsx(h,{children:"Permissions"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(de,{children:g.map(r=>e.jsxs(J,{children:[e.jsx(x,{children:r.role_name}),e.jsx(x,{children:r.role_description}),e.jsx(x,{children:e.jsx(t,{color:"secondary",children:r.role_type})}),e.jsx(x,{children:r.permission_id&&r.permission_id.length>0?r.permission_id.map(n=>e.jsxs(t,{color:"info",className:"me-1",children:["#",n]},n)):e.jsx(t,{color:"light",children:"None"})}),e.jsx(x,{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx(o,{color:"primary",size:"sm",variant:"outline",onClick:()=>handleViewRole(r),children:"View"}),e.jsx(o,{color:"warning",size:"sm",variant:"outline",onClick:()=>_(`/role/${r._id}/edit`),children:"Edit"}),e.jsx(o,{color:"danger",size:"sm",variant:"outline",onClick:()=>handleDeleteRole(r),children:e.jsx(m,{icon:K,size:"sm"})})]})})]},r._id))})]})})]})})}),e.jsxs(O,{visible:se,onClose:()=>U(!1),size:"lg",children:[e.jsx(Q,{children:e.jsx(X,{children:"🏨 User Details"})}),e.jsx(Y,{children:s&&e.jsxs(p,{children:[e.jsxs(d,{md:6,children:[e.jsx("h5",{children:s.title}),e.jsx("p",{className:"text-muted",children:s.description}),e.jsx("h6",{className:"mt-4",children:"📍 Address"}),e.jsxs("p",{children:[(P=s.address)==null?void 0:P.street," ",(z=s.address)==null?void 0:z.house_number,e.jsx("br",{}),(M=s.address)==null?void 0:M.city,", ",(k=s.address)==null?void 0:k.country]}),e.jsx("h6",{className:"mt-3",children:"📞 Contact"}),e.jsxs("p",{children:[e.jsx(m,{icon:he,className:"me-2"}),s.hotline||"N/A",e.jsx("br",{}),e.jsx(m,{icon:xe,className:"me-2"}),s.email||"N/A"]})]}),e.jsxs(d,{md:6,children:[e.jsx("h6",{children:"🏢 Property Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",(F=s.property)==null?void 0:F.name,e.jsx("br",{}),e.jsx("strong",{children:"Description:"})," ",(B=s.property)==null?void 0:B.description,e.jsx("br",{}),e.jsx("strong",{children:"Total Apartments:"})," ",(I=s.property)==null?void 0:I.total_apartments]}),e.jsx("h6",{className:"mt-3",children:"💰 Pricing & Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price per day:"})," ",ae(s.price_per_day,s.currency),e.jsx("br",{}),e.jsx("strong",{children:"Total area:"})," ",s.total_area,"m²",e.jsx("br",{}),e.jsx("strong",{children:"Bedrooms:"})," ",s.bedrooms,e.jsx("br",{}),e.jsx("strong",{children:"Bathrooms:"})," ",s.bathrooms]}),e.jsx("h6",{className:"mt-3",children:"✨ Amenities"}),e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[(($=s.property)==null?void 0:$.has_pool)&&e.jsx(t,{color:"info",children:"Pool"}),((H=s.property)==null?void 0:H.has_elevator)&&e.jsx(t,{color:"secondary",children:"Elevator"}),s.is_furnished&&e.jsx(t,{color:"primary",children:"Furnished"}),s.is_garage&&e.jsx(t,{color:"success",children:"Garage"}),(L=s.amenities)==null?void 0:L.map((r,n)=>r.is_available&&e.jsx(t,{color:"warning",children:r.name},n))]})]})]})}),e.jsx(Z,{children:e.jsx(o,{color:"secondary",onClick:()=>U(!1),children:"Close"})})]}),e.jsxs(O,{visible:re,onClose:E,size:"sm",children:[e.jsx(Q,{children:e.jsx(X,{children:"🗑️ Confirm Delete"})}),e.jsx(Y,{children:l&&e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete this User?"}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsx("strong",{children:l.title}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["ID: ",l._id]}),l.address&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:["📍 ",l.address.city,", ",l.address.country]})})]}),e.jsxs(b,{color:"warning",className:"mt-3 mb-0",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone!"]})]})}),e.jsxs(Z,{children:[e.jsx(o,{color:"secondary",onClick:E,disabled:y,children:"Cancel"}),e.jsx(o,{color:"danger",onClick:le,disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"sm",className:"me-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:K,className:"me-2"}),"Delete User"]})})]})]})]})};export{be as default};
